<!--
================================================================================
    SYSMON CONFIGURATION FOR WAZUH SIEM
    GOLINE SA - Enterprise Security Configuration
    
    Organization: GOLINE SA
    Address: Via Croce Campagna 2
             6855 Stabio - Switzerland
    Phone: +41 91 2607650
    Website: https://goline.ch
    
    Author: Paolo Caparrelli - Security Specialist
    Version: 2.0
    Last Updated: August 2025
    
    PURPOSE:
    This configuration is specifically optimized for integration with Wazuh SIEM
    to provide comprehensive Windows endpoint monitoring while minimizing false
    positives in enterprise environments.
    
    SECURITY PHILOSOPHY:
    - Defense in depth through multi-layered event monitoring
    - Balance between detection coverage and performance impact
    - Focus on high-fidelity indicators of compromise
    - Reduction of alert fatigue through intelligent filtering
    
    STRUCTURE:
    1. Process Creation (Event ID 1) - Monitor suspicious process launches
    2. File Creation Time (Event ID 2) - Detect timestomping attempts
    3. Network Connections (Event ID 3) - Track network communications
    4. Sysmon Service State (Event ID 4) - Service status changes
    5. Process Termination (Event ID 5) - Process end events
    6. Driver Load (Event ID 6) - Kernel driver loading
    7. Image/DLL Load (Event ID 7) - DLL injection detection
    8. CreateRemoteThread (Event ID 8) - Remote thread creation
    9. RawAccessRead (Event ID 9) - Direct disk access
    10. ProcessAccess (Event ID 10) - Process memory access
    11. FileCreate (Event ID 11) - File creation monitoring
    12. Registry Events (Event IDs 12-14) - Registry monitoring
    13. FileCreateStreamHash (Event ID 15) - ADS creation
    14. PipeEvent (Event IDs 17-18) - Named pipe monitoring
    15. WmiEvent (Event IDs 19-21) - WMI activity
    16. DnsQuery (Event ID 22) - DNS resolution monitoring
    17. FileDelete (Event IDs 23,26) - File deletion tracking
    
    INTEGRATION WITH WAZUH:
    - Events are forwarded to Wazuh Manager for correlation
    - Custom rules in Wazuh process these events for threat detection
    - Integration with MITRE ATT&CK framework for threat mapping
    - Automatic incident response triggers based on severity
    
    PERFORMANCE CONSIDERATIONS:
    - Exclusions for known legitimate high-volume processes
    - Careful balance of include/exclude rules to minimize overhead
    - Regular review and tuning based on environment specifics
    
    FALSE POSITIVE REDUCTION:
    - Extensive whitelist for legitimate Windows operations
    - Environment-specific exclusions for enterprise software
    - Regular updates based on observed false positives
    
    MAINTENANCE:
    - Review monthly for new threats and false positives
    - Update exclusions based on newly deployed software
    - Coordinate with Wazuh rule updates
    - Test changes in non-production environment first
    
    COMPLIANCE:
    - Meets requirements for PCI-DSS, HIPAA, GDPR logging
    - Provides audit trail for forensic investigations
    - Supports incident response procedures
    
    CONTACT:
    For questions or improvements, contact:
    GOLINE SA Security Team
    Paolo Caparrelli - Security Specialist
    Email: soc@goline.ch
    Phone: +41 91 2607650
    Address: Via Croce Campagna 2, 6855 Stabio - Switzerland
    Website: https://goline.ch
    
================================================================================
-->

<Sysmon schemaversion="4.90">
  <HashAlgorithms>*</HashAlgorithms>
  <!-- This now also determines the file names of the files preserved (String) -->
  <CheckRevocation>False</CheckRevocation>
  <!-- Setting this to true might impact performance -->
  <DnsLookup>False</DnsLookup>
  <!-- Disables lookup behavior, default is True (Boolean) -->
  <ArchiveDirectory>Sysmon</ArchiveDirectory>
  <!-- Sets the name of the directory in the C:\ root where preserved files will be saved (String)-->
  <EventFiltering>
    <!-- Event ID 1 == Process Creation - Includes -->
    <RuleGroup groupRelation="or">
      <ProcessCreate onmatch="include">
        <ParentImage name="technique_id=T1546.008,technique_name=Accessibility Features" condition="contains">sethc.exe</ParentImage>
        <ParentImage name="technique_id=T1546.008,technique_name=Accessibility Features" condition="contains">utilman.exe</ParentImage>
        <ParentImage name="technique_id=T1546.008,technique_name=Accessibility Features" condition="contains">osk.exe</ParentImage>
        <ParentImage name="technique_id=T1546.008,technique_name=Accessibility Features" condition="contains">Magnify.exe</ParentImage>
        <ParentImage name="technique_id=T1546.008,technique_name=Accessibility Features" condition="contains">DisplaySwitch.exe</ParentImage>
        <ParentImage name="technique_id=T1546.008,technique_name=Accessibility Features" condition="contains">Narrator.exe</ParentImage>
        <ParentImage name="technique_id=T1546.008,technique_name=Accessibility Features" condition="contains">AtBroker.exe</ParentImage>
        <OriginalFileName name="technique_id=T1546.011,technique_name=Application Shimming" condition="is">sdbinst.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1197,technique_name=BITS Jobs" condition="is">bitsadmin.exe</OriginalFileName>
        <Rule name="Eventviewer Bypass UAC" groupRelation="and">
          <ParentImage name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="contains">eventvwr.exe</ParentImage>
          <Image condition="is not">c:\windows\system32\mmc.exe</Image>
        </Rule>
        <ParentImage name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="contains">fodhelper.exe</ParentImage>
        <Rule name="technique_id=T1021.003,technique_name=Distributed Component Object Model" groupRelation="and">
          <ParentCommandLine condition="contains">-Embedding</ParentCommandLine>
          <ParentImage condition="is">c:\windows\system32\mmc.exe</ParentImage>
        </Rule>
        <Rule groupRelation="and">
          <CommandLine condition="contains">Set-MpPreference</CommandLine>
          <CommandLine condition="contains any">-DisableRealTimeMonitoring $true;-DisableBehaviorMonitoring $true;-DisableBlockAtFirstSeen $true;-DisableIOAVProtection $true;-DisablePrivacyMode $true;-SignatureDisableUpdateOnStartupWithoutEngine $true;-DisableArchiveScanning $true;-DisableIntrusionPreventionSystem $true;-DisableScriptScanning $true</CommandLine>
        </Rule>
        <CommandLine name="technique_id=T1027,technique_name=Obfuscated Files or Information" condition="contains">^</CommandLine>
        <CommandLine name="technique_id=T1027,technique_name=Obfuscated Files or Information" condition="contains">../../</CommandLine>
        <ParentCommandLine name="technique_id=T1204,technique_name=User Execution" condition="is">C:\Windows\explorer.exe</ParentCommandLine>
        <ParentImage name="technique_id=T1204,technique_name=User Execution" condition="is">C:\Windows\explorer.exe</ParentImage>
        <Rule name="Fltmc" groupRelation="and">
          <OriginalFileName name="technique_id=T1562.006,technique_name=Indicator Blocking" condition="is">fltMC.exe</OriginalFileName>
          <CommandLine name="technique_id=T1562.006,technique_name=Indicator Blocking" condition="contains any">unload;detach</CommandLine>
        </Rule>
        <Rule name="Security Software Discovery" groupRelation="and">
          <OriginalFileName name="technique_id=T1518.001,technique_name=Security Software Discovery" condition="is">fltMC.exe</OriginalFileName>
          <CommandLine name="technique_id=T1518.001,technique_name=Security Software Discovery" condition="contains">misc::mflt</CommandLine>
        </Rule>
        <Rule name="InstallUtil" groupRelation="and">
          <OriginalFileName name="technique_id=T1218.004,technique_name=InstallUtil" condition="is">InstallUtil.exe</OriginalFileName>
          <CommandLine name="technique_id=T1218.004,technique_name=InstallUtil" condition="contains all">/logfile=;/LogToConsole=false;/U</CommandLine>
        </Rule>
        <OriginalFileName name="technique_id=T1546.008,technique_name=Windows Error Reporting" condition="contains">werfault.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1574.002,technique_name=DLL Side-Loading" condition="is">odbcconf.exe</OriginalFileName>
        <Rule name="technique_id=T1027.004,technique_name=Compile After Delivery" groupRelation="and">
          <ParentImage condition="is">csc.exe</ParentImage>
          <CommandLine condition="contains">-target:library</CommandLine>
          <CommandLine condition="contains">.cs</CommandLine>
        </Rule>
        <Rule name="technique_id=T1027.004,technique_name=Compile After Delivery" groupRelation="and">
          <ParentImage condition="is">csc.exe</ParentImage>
          <CommandLine condition="contains">-out:</CommandLine>
          <CommandLine condition="contains">.cs</CommandLine>
        </Rule>
        <OriginalFileName name="technique_id=T1564.001,technique_name=Hidden Files and Directories" condition="is">attrib.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1543.003,technique_name=Windows Service" condition="is">sc.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1569.002,technique_name=Service Execution" condition="is">dnscmd.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1489,technique_name=Service Stop" condition="is">taskkill.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1074,technique_name=Data Staged" condition="is">xcopy.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1074,technique_name=Data Staged" condition="is">robocopy.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1105,technique_name=Remote File Copy" condition="is">GfxDownloadWrapper.exe</OriginalFileName>
        <CommandLine name="technique_id=T1105,technique_name=Remote File Copy" condition="contains all">update;--download</CommandLine>
        <CommandLine name="technique_id=T1105,technique_name=Remote File Copy" condition="contains all">squirrel;--download</CommandLine>
        <OriginalFileName name="technique_id=T1105,technique_name=Remote File Copy" condition="is">expand.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1564.001,technique_name=Hidden Files and Directories" condition="is">attrib.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1543.003,technique_name=Windows Service" condition="is">sc.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1040,technique_name=Network Sniffing" condition="is">PktMon.exe</OriginalFileName>
        <Rule name="technique_id=T1003,technique_name=Credential Dumping" groupRelation="and">
          <OriginalFileName condition="is">esentutl.exe</OriginalFileName>
          <CommandLine condition="contains all">/y;/vss/d</CommandLine>
        </Rule>
        <OriginalFileName name="technique_id=T1003,technique_name=Credential Dumping" condition="is">TTTracer.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1003,technique_name=Credential Dumping" condition="is">sqldumper.exe</OriginalFileName>
        <Rule name="technique_id=T1003,technique_name=Credential Dumping" groupRelation="and">
          <OriginalFileName condition="is">ntdsutil.exe</OriginalFileName>
          <CommandLine condition="contains">ifm</CommandLine>
        </Rule>
        <ParentImage name="technique_id=T1003,technique_name=Credential Dumping" condition="is">diskshadow.exe</ParentImage>
        <Rule name="technique_id=T1003,technique_name=Credential Dumping (Likely)" groupRelation="and">
          <OriginalFileName condition="is">rpcping.exe</OriginalFileName>
          <CommandLine condition="contains any">\s;-s</CommandLine>
          <CommandLine condition="contains any">-u;\u;-t;\t</CommandLine>
          <CommandLine condition="contains any">NTLM;ncacn_np</CommandLine>
        </Rule>
        <OriginalFileName name="technique_id=T1003,technique_name=Credential Dumping" condition="is">rpcping.exe</OriginalFileName>
        <Rule name="Ingress Tool Transfer" groupRelation="or">
          <OriginalFileName name="technique_id=T1105,technique_name=Ingress Tool Transfer" condition="is">expand</OriginalFileName>
          <OriginalFileName name="technique_id=T1105,technique_name=Ingress Tool Transfer" condition="is">IEExec.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1105,technique_name=Ingress Tool Transfer" condition="is">Print.Exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1105,technique_name=Ingress Tool Transfer" condition="is">curl.exe</OriginalFileName>
          <ParentImage name="technique=T1105,technique_name=Ingress Tool Transfer" condition="is">ftp.exe</ParentImage>
        </Rule>
        <Rule name="technique_id=T1564.004,technique_name=NTFS File Attributes" groupRelation="and">
          <OriginalFileName condition="is">print.exe</OriginalFileName>
          <CommandLine condition="contains">:</CommandLine>
        </Rule>
        <Rule name="technique_id=T1564.004,technique_name=NTFS File Attributes" groupRelation="and">
          <OriginalFileName condition="is">regedit.exe</OriginalFileName>
          <CommandLine condition="contains">:</CommandLine>
        </Rule>
        <Rule name="NTFS File Attributes" groupRelation="or">
          <OriginalFileName name="technique_id=T1564.004,technique_name=NTFS File Attributes" condition="is">esentutl.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1564.004,technique_name=NTFS File Attributes" condition="is">extrac32.exe</OriginalFileName>
        </Rule>
        <Rule name="Scheduled Task/Job" groupRelation="or">
          <OriginalFileName name="technique_id=T1053.005,technique_name=Scheduled Task/Job" condition="contains any">schtasks.exe;sctasks.exe</OriginalFileName>
          <OriginalFileName name="technique=T1053.002,technique_name=At" condition="contains any">at.exe;At.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1053,technique_name=Scheduled Task/Job" condition="is">taskeng.exe</OriginalFileName>
        </Rule>
        <Rule name="File Permissions Modification" groupRelation="or">
          <OriginalFileName name="technique_id=T1222.001,technique_name=File Permissions Modification" condition="is">takeown.exe</OriginalFileName>
          <Image name="technique_id=T1222.001,technique_name=File Permissions Modification" condition="contains">forfiles.exe</Image>
          <OriginalFileName name="technique_id=T1222.001,technique_name=File Permissions Modification" condition="contains any">icacls.exe;cacls.exe;xcacls.exe</OriginalFileName>
        </Rule>
        <Rule name="Access Token Manipulation" groupRelation="or">
          <OriginalFileName name="technique_id=T1134,technique_name=Access Token Manipulation" condition="is">runas.exe</OriginalFileName>
          <CommandLine name="technique_id=T1134,technique_name=Access Token Manipulation" condition="contains">runas</CommandLine>
        </Rule>
        <Rule name="Bypass User Access Control" groupRelation="or">
          <OriginalFileName name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="is">WSReset.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="is">xwizard.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="is">computerdefaults.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="is">dism.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="is">fodhelper.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1548.002,technique_name=Bypass User Account Control" condition="is">computerdefaults.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1548.002,technique_name=Bypass User Account Control" condition="is">dism.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1548.002,technique_name=Bypass User Account Control" condition="is">fodhelper.exe</OriginalFileName>
        </Rule>
        <Rule name="technique_id=T1490,technique_name=Inhibit System Recovery" groupRelation="and">
          <OriginalFileName condition="contains any">vssadmin.exe;wbadmin.exe</OriginalFileName>
          <CommandLine condition="contains">delete</CommandLine>
        </Rule>
        <Rule name="technique_id=T1490,technique_name=Inhibit System Recovery" groupRelation="and">
          <OriginalFileName condition="is">bcdedit.exe</OriginalFileName>
          <CommandLine condition="contains">/set</CommandLine>
        </Rule>
        <Rule name="Inhibit System Recovery" groupRelation="or">
          <OriginalFileName name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="is">vssadmin.exe</OriginalFileName>
          <CommandLine name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="contains all">vssadmin;delete</CommandLine>
          <CommandLine name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="contains all">wbadmin;delete</CommandLine>
          <CommandLine name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="contains all">bcedit;set</CommandLine>
          <CommandLine name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="contains all">wmic;delete</CommandLine>
        </Rule>
        <Rule name="Windows Management Instrumentation" groupRelation="or">
          <OriginalFileName name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="is">mofcomp.exe</OriginalFileName>
          <Image name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="begin with">C:\WINDOWS\system32\wbem\scrcons.exe</Image>
          <OriginalFileName name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="is">ScrCons</OriginalFileName>
          <ParentImage name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains">wmiprvse.exe</ParentImage>
          <OriginalFileName name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="is">wmiprvse.exe</OriginalFileName>
        </Rule>
        <Rule name="Account Discovery" groupRelation="or">
          <OriginalFileName name="technique_id=T1087,technique_name=Account Discovery" condition="is">klist.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1087,technique_name=Account Discovery" condition="is">cmdkey.exe</OriginalFileName>
          <CommandLine name="technique_id=T1087.001,technique_name=Local Account" condition="contains any">net localgroup;net user;net group</CommandLine>
          <CommandLine name="technique_id=T1087.001,technique_name=Local Account" condition="contains any">dir C:\users;ls C:\users;dir C:\Users;ls C:\Users</CommandLine>
          <OriginalFileName name="technique_id=T1078.002,technique_name=Domain Accounts" condition="is">djoin.exe</OriginalFileName>
        </Rule>
        <Rule name="System Owner/User Discovery" groupRelation="or">
          <OriginalFileName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="contains any">systeminfo.exe;sysinfo.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">whoami.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">quser.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="contains any">nltest.exe;nltestk.exe</OriginalFileName>
        </Rule>
        <Rule name="System Network Configuration Discovery" groupRelation="or">
          <OriginalFileName name="technique_id=T1016,technique_name=System Network Configuration Discovery" condition="is">ipconfig.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1016,technique_name=System Network Configuration Discovery" condition="is">nslookup.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1016,technique_name=System Network Configuration Discovery" condition="is">tracert.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1016,technique_name=System Network Configuration Discovery" condition="is">route.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1016,technique_name=System Network Configuration Discovery" condition="contains any">nbtstat.exe;nbtinfo.exe</OriginalFileName>
        </Rule>
        <Rule name="Security Software Discovery" groupRelation="or">
          <OriginalFileName name="technique_id=T1518.001,technique_name=Security Software Discovery" condition="is">netsh.exe</OriginalFileName>
          <CommandLine name="technique_id=T1518.001,technique_name=Security Software Discovery" condition="contains">netsh advfirewall</CommandLine>
        </Rule>
        <Rule name="Remote System Discovery" groupRelation="or">
          <OriginalFileName name="technique_id=T1018,technique_name=Remote System Discovery" condition="contains any">net.exe;net1.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1018,technique_name=Remote System Discovery" condition="contains any">ping.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1018,technique_name=Remote System Discovery" condition="contains any">dsquery.exe</OriginalFileName>
          <CommandLine name="technique_id=T1018,technique_name=Remote System Discovery" condition="contains any">net view;net group</CommandLine>
        </Rule>
        <Rule name="Process Discovery" groupRelation="or">
          <OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">tasklist.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">qprocess.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">query.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">qwinsta.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">rwinsta.exe</OriginalFileName>
        </Rule>
        <Rule name="File and Directory Discovery" groupRelation="or">
          <OriginalFileName name="technique_id=T1083,technique_name=File and Directory Discovery" condition="contains any">tree.com;findstr.exe;where.exe</OriginalFileName>
          <CommandLine name="technique_id=T1083,technique_name=File and Directory Discovery" condition="contains any">ls;dir</CommandLine>
        </Rule>
        <Rule name="System Network Connections Discovery" groupRelation="or">
          <OriginalFileName name="technique_id=T1049,technique_name=System Network Connections Discovery" condition="is">netstat.exe</OriginalFileName>
        </Rule>
        <Rule name="technique_id=T1482,technique_name=Domain Trust Discovery" groupRelation="and">
          <OriginalFileName condition="is">nltestrk.exe</OriginalFileName>
          <CommandLine condition="contains">/domain_trusts</CommandLine>
        </Rule>
        <Rule name="Domain Trust Discovery" groupRelation="or">
          <OriginalFileName name="technique_id=T1482,technique_name=Domain Trust Discovery" condition="is">nltest.exe</OriginalFileName>
        </Rule>
        <Rule name="Query Registry" groupRelation="or">
          <OriginalFileName name="technique_id=T1012,technique_name=Query Registry" condition="contains any">reg.exe;regedit.exe</OriginalFileName>
        </Rule>
        <Rule name="technique_id=T1070.001,technique_name=Clear Windows Event Logs" groupRelation="and">
          <OriginalFileName condition="is">wevtutil.exe</OriginalFileName>
          <CommandLine condition="contains any">cl;clear-log</CommandLine>
        </Rule>
        <Rule name="Indicator Removal" groupRelation="or">
          <OriginalFileName name="Event Log Access" condition="is">wevtutil.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1070,technique_name=Indicator Removal" condition="is">fsutil.exe</OriginalFileName>
        </Rule>
        <Rule name="technique_id=T1112,technique_name=Modify Registry" groupRelation="and">
          <OriginalFileName condition="contains any">reg.exe;regedit.exe</OriginalFileName>
          <CommandLine condition="contains any">/i;.reg</CommandLine>
        </Rule>
        <Rule name="technique_id=T1112,technique_name=Modify Registry" groupRelation="and">
          <OriginalFileName condition="contains any">reg.exe;regedit.exe</OriginalFileName>
          <CommandLine condition="contains any">hklm;HKLM;hkey_local_machine</CommandLine>
          <CommandLine condition="contains any">\system;\sam;\security</CommandLine>
        </Rule>
        <Rule name="technique_id=T1202,technique_name=Indirect Command Execution" groupRelation="and">
          <ParentImage condition="is">hh.exe</ParentImage>
          <CommandLine condition="contains">.exe</CommandLine>
        </Rule>
        <Rule name="Indirect Command Execution" groupRelation="or">
          <OriginalFileName name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">pcalua.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">cscript.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">wscript.exe</OriginalFileName>
          <ParentImage name="technique_id=T1202,technique_name=Indirect Command Execution" condition="contains">pcalua.exe</ParentImage>
          <ParentImage name="technique_id=T1202,technique_name=Indirect Command Execution" condition="contains">cscript.exe</ParentImage>
          <ParentImage name="technique_id=T1202,technique_name=Indirect Command Execution" condition="contains">wscript.exe</ParentImage>
          <OriginalFileName name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">bash.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">certutil.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">winrs.exe</OriginalFileName>
          <ParentImage name="technique_id=T1202,technique_name=Indirect Command Execution" condition="contains">control.exe</ParentImage>
          <OriginalFileName name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">desktopimgdownldr.exe</OriginalFileName>
          <ParentImage name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">wsl.exe</ParentImage>
        </Rule>
        <Rule name="System Script Proxy Execution" groupRelation="or">
          <CommandLine name="technique_id=T1216.001,technique_name=PubPrn" condition="contains">pubprn</CommandLine>
          <CommandLine name="technique_id=T1216,technique_name=System Script Proxy Execution" condition="contains">slmgr</CommandLine>
          <CommandLine name="technique_id=T1216,technique_name=System Script Proxy Execution" condition="contains">manage-bde</CommandLine>
          <CommandLine name="technique_id=T1216,technique_name=System Script Proxy Execution" condition="contains">CL_Invocation</CommandLine>
          <CommandLine name="technique_id=T1216,technique_name=System Script Proxy Execution" condition="contains">CL_Mutexverifiers</CommandLine>
          <CommandLine name="technique_id=T1216,technique_name=System Script Proxy Execution" condition="contains">winrm</CommandLine>
        </Rule>
        <Rule name="technique_id=T1216,technique_name=System Script Proxy Execution" groupRelation="and">
          <OriginalFileName condition="is">cscript.exe</OriginalFileName>
          <CommandLine condition="contains">.js</CommandLine>
        </Rule>
        <OriginalFileName name="technique_id=T1218.001,technique_name=Compiled HTML File" condition="is">hh.exe</OriginalFileName>
        <ParentImage name="technique_id=T1218.001,technique_name=Compiled HTML File" condition="is">hh.exe</ParentImage>
        <OriginalFileName name="technique_id=T1218.004,technique_name=InstallUtil" condition="is">installutil.exe</OriginalFileName>
        <ParentImage name="technique_id=T1218.005,technique_name=Mshta" condition="contains">mshta.exe</ParentImage>
        <OriginalFileName name="technique_id=T1218.005,technique_name=Mshta" condition="is">mshta.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1218.010,technique_name=Regsvr32" condition="is">regsvr32.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1218.011,technique_name=rundll32.exe" condition="contains">rundll32.exe</OriginalFileName>
        <Rule name="System Binary Proxy Execution" groupRelation="or">
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">InfDefaultInstall.EXE</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">extexport.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">msconfig.EXE</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">msiexec.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">odbcconf.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">PresentationHost.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">rasdlui.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">RegisterCimProvider2.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">RegisterCimProvider.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">ScriptRunner.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">verclsid.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">wab.exe</OriginalFileName>
          <ParentImage name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">wab.exe</ParentImage>
          <ParentImage name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">wsreset.exe</ParentImage>
          <CommandLine name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">xwizard RunWizard</CommandLine>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">Appvlp.exe</OriginalFileName>
          <CommandLine name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">bginfo</CommandLine>
          <ParentCommandLine name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">bginfo</ParentCommandLine>
          <CommandLine name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">cbd</CommandLine>
          <ParentCommandLine name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">csi.exe</ParentCommandLine>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">csi.exe</OriginalFileName>
          <ParentCommandLine name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">devtoolslauncher.exe LaunchForDeploy</ParentCommandLine>
          <ParentImage name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">devtoolslauncher.exe</ParentImage>
          <CommandLine name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">runscripthelper.exe surfacecheck</CommandLine>
          <CommandLine name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">Scriptrunner.exe -appvscript</CommandLine>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">Scriptrunner.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">tttracer.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">msdt.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">rasautou.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">Register-cimprovider.exe</OriginalFileName>
          <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">diskshadow.exe</Image>
          <CommandLine name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains all">diskshadow.exe;/s</CommandLine>
          <CommandLine name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains all">diskshadow.exe;-s</CommandLine>
          <OriginalFileName name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">replace.exe</OriginalFileName>
          <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">jjs.exe</Image>
          <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">appcmd.exe</Image>
          <CommandLine name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">ieexec.exe http</CommandLine>
        </Rule>
        <Rule name="Trusted Developer Utilities Proxy Execution" groupRelation="or">
          <CommandLine name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains">vbc.exe /target:exe</CommandLine>
          <OriginalFileName name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains">vbc.exe</OriginalFileName>
          <CommandLine name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains">dnx.exe</CommandLine>
          <OriginalFileName name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">csc.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">dfsvc.exe</OriginalFileName>
          <CommandLine name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains">msdeploy.exe -verb:sync -source:RunCommand</CommandLine>
          <ParentImage name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">mftrace.exe</ParentImage>
          <ParentImage name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">dxcap.exe</ParentImage>
          <CommandLine name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains all">dxcap.exe;-c</CommandLine>
          <CommandLine name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains all">dxcap.exe;/c</CommandLine>
          <OriginalFileName name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">ilasm.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">jsc.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">vbc.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">Microsoft.Workflow.Compiler.exe</OriginalFileName>
          <ParentImage name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">vsjitdebugger.exe</ParentImage>
          <CommandLine name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains">vsjitdebugger</CommandLine>
          <CommandLine name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains all">update.exe;--update</CommandLine>
          <CommandLine name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains all">update.exe;--ProcessStart</CommandLine>
          <OriginalFileName name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">tracker.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">te.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">rcsi.exe</OriginalFileName>
          <CommandLine name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains all">squirrel.exe;--update</CommandLine>
          <OriginalFileName name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">Microsoft.Workflow.Compiler.exe</OriginalFileName>
          <CommandLine name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains">rundll32.exe dfshim.dll,ShOpenVerbApplication http://</CommandLine>
          <CommandLine name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains">ilasm</CommandLine>
          <OriginalFileName name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">jsc.exe</OriginalFileName>
        </Rule>
        <Rule name="Mavinject" groupRelation="and">
          <OriginalFileName name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains any">Mavinject.exe;mavinject64.exe</OriginalFileName>
          <CommandLine name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains">/INJECTRUNNING</CommandLine>
        </Rule>
        <Rule name="CMSTP" groupRelation="and">
          <OriginalFileName name="technique_id=T1218.003,technique_name=CMSTP" condition="is">CMSTP.exe</OriginalFileName>
          <CommandLine name="technique_id=T1218.003,technique_name=CMSTP" condition="contains all">/ni;/s</CommandLine>
        </Rule>
        <OriginalFileName name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">MSBuild.exe</OriginalFileName>
        <ParentImage name="technique_id=T1137,technique_name=Office Application Startup" condition="contains">excel.exe</ParentImage>
        <ParentImage name="technique_id=T1137,technique_name=Office Application Startup" condition="contains">winword.exe</ParentImage>
        <ParentImage name="technique_id=T1137,technique_name=Office Application Startup" condition="contains">powerpnt.exe</ParentImage>
        <ParentImage name="technique_id=T1137,technique_name=Office Application Startup" condition="contains">outlook.exe</ParentImage>
        <ParentImage name="technique_id=T1137,technique_name=Office Application Startup" condition="contains">msaccess.exe</ParentImage>
        <ParentImage name="technique_id=T1137,technique_name=Office Application Startup" condition="contains">mspub.exe</ParentImage>
        <OriginalFileName name="technique_id=T1218.009,technique_name=Regsvcs/Regasm" condition="contains any">regsvcs.exe;regasm.exe</OriginalFileName>
        <Rule name="Windows Command Shell" groupRelation="or">
          <OriginalFileName name="technique_id=T1059.003,technique_name=Windows Command Shell" condition="is">cmd.exe</OriginalFileName>
          <Image name="technique_id=T1059.003,technique_name=Windows Command Shell" condition="contains">cmd.exe</Image>
        </Rule>
        <Rule name="PowerShell" groupRelation="or">
          <OriginalFileName name="technique_id=T1059.001,technique_name=PowerShell" condition="contains">powershell.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1059.001,technique_name=PowerShell" condition="contains">powershell_ise.exe</OriginalFileName>
          <OriginalFileName name="technique_id=T1059.001,technique_name=PowerShell" condition="contains">Sqlps.exe</OriginalFileName>
          <CommandLine name="technique_id=T1059.001,technique_name=PowerShell" condition="contains">pester</CommandLine>
        </Rule>
        <Rule name="technique_id=T1218,technique_name=System Binary Proxy Execution" groupRelation="and">
          <OriginalFileName condition="is">ATBroker.exe</OriginalFileName>
          <CommandLine condition="contains">start</CommandLine>
        </Rule>
        <CommandLine name="technique_id=T1027,technique_name=Obfuscated Files or Information" condition="contains">FromBase64</CommandLine>
        <CommandLine name="technique_id=T1027,technique_name=Obfuscated Files or Information" condition="contains">gzip</CommandLine>
        <CommandLine name="technique_id=T1027,technique_name=Obfuscated Files or Information" condition="contains">decompress</CommandLine>
        <CommandLine name="technique_id=T1027,technique_name=Obfuscated Files or Information" condition="contains">http</CommandLine>
        <CommandLine name="technique_id=T1027,technique_name=Obfuscated Files or Information" condition="contains">replace</CommandLine>
        <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains">SyncAppvPublishingServer.exe</Image>
        <OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">PsList.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1007,technique_name=System Service Discovery" condition="is">PsService.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1569.002,technique_name=Service Execution" condition="is">PsExec.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1569.002,technique_name=Service Execution" condition="is">PsExec.c</OriginalFileName>
        <OriginalFileName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">PsGetSID.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="is">PsKill.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="is">PKill.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1003,technique_name=Credential Dumping" condition="contains">ProcDump</OriginalFileName>
        <OriginalFileName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">PsLoggedOn.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1105,technique_name=Ingress Tool Transfer" condition="is">PsFile.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="contains">ShellRunas</OriginalFileName>
        <OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">PipeList.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1083,technique_name=File and Directory Discovery" condition="is">AccessChk.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1083,technique_name=File and Directory Discovery" condition="is">AccessEnum.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="is">LogonSessions.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1005,technique_name=Data from Local System" condition="is">PsLogList.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1057,technique_name=Process Discovery" condition="is">PsInfo.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1007,technique_name=System Service Discovery" condition="contains">LoadOrd</OriginalFileName>
        <OriginalFileName name="technique_id=T1098,technique_name=Account Manipulation" condition="is">PsPasswd.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1012,technique_name=Query Registry" condition="is">ru.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1012,technique_name=Query Registry" condition="contains">Regsize</OriginalFileName>
        <OriginalFileName name="technique_id=T1003,technique_name=Credential Dumping" condition="is">ProcDump</OriginalFileName>
        <CommandLine name="technique_id=T1003,technique_name=Credential Dumping" condition="contains">-ma lsass.exe</CommandLine>
        <CommandLine name="technique_id=T1036,technique_name=Process Evasion" condition="contains">-accepteula -ma</CommandLine>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="is">vssadmin.exe</OriginalFileName>
          <CommandLine name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="contains all">delete;shadow</CommandLine>
        </Rule>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="is">vssadmin.exe</OriginalFileName>
          <CommandLine name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="contains all">resize;shadowstorage</CommandLine>
        </Rule>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="is">wmic.exe</OriginalFileName>
          <CommandLine name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="contains all">delete;shadowcopy</CommandLine>
        </Rule>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="is">wbadmin.exe</OriginalFileName>
          <CommandLine name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="contains all">delete;catalog</CommandLine>
        </Rule>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="is">bcdedit.exe</OriginalFileName>
          <CommandLine name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="contains all">recoveryenabled;no</CommandLine>
        </Rule>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="is">bcdedit.exe</OriginalFileName>
          <CommandLine name="technique_id=T1490,technique_name=Inhibit System Recovery" condition="contains all">bootstatuspolicy;ignoreallfailures</CommandLine>
        </Rule>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\PerfLogs\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\$Recycle.bin\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Intel\Logs\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\Default\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\Public\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\NetworkService\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Fonts\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Debug\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Media\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Help\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\addins\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\repair\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\security\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\system32\config\systemprofile\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="contains">VolumeShadowCopy</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="contains">\htdocs\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="contains">\wwwroot\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="contains">\Temp\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="contains">\Downloads\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="contains">\Desktop\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="contains">\Appdata\Local\</Image>
        <Rule name="Control Panel Items" groupRelation="or">
          <CommandLine name="technique_id=T1218.002,technique_name=Control Panel Items" condition="contains all">control;/name</CommandLine>
          <CommandLine name="technique_id=T1218.002,technique_name=Control Panel Items" condition="contains all">rundll32.exe;shell32.dll;Control_RunDLL</CommandLine>
        </Rule>
        <Rule name="Windows Defender tampering" groupRelation="and">
          <Image name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="contains">MpCmdRun.exe</Image>
          <CommandLine name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="contains any">Add-MpPreference;RemoveDefinitions;DisableIOAVProtection</CommandLine>
        </Rule>
        <OriginalFileName name="technique_id=T1021.006,technique_name=Windows Remote Management" condition="is">wsmprovhost.exe</OriginalFileName>
        <OriginalFileName name="technique_id=T1021.006,technique_name=Windows Remote Management" condition="is">winrshost.exe</OriginalFileName>
        <Image name="technique_id=T1021.006,technique_name=Windows Remote Management" condition="contains">winrm.cmd</Image>
        <ParentImage name="technique_id=T1218,technique_name=Trusted Binary Proxy Execution" condition="is">wsl.exe</ParentImage>
        <ParentCommandLine name="technique_id=T1218,technique_name=Trusted Binary Proxy Execution" condition="contains all">wsl.exe;-e</ParentCommandLine>
        <ParentCommandLine name="technique_id=T1218,technique_name=Trusted Binary Proxy Execution" condition="contains all">wsl.exe;/e</ParentCommandLine>
        <CommandLine name="technique_id=T1218,technique_name=Trusted Binary Proxy Execution" condition="contains all">wsl.exe;-e</CommandLine>
        <CommandLine name="technique_id=T1218,technique_name=Trusted Binary Proxy Execution" condition="contains all">wsl.exe;/e</CommandLine>
        <CommandLine name="technique_id=T1218,technique_name=Trusted Binary Proxy Execution" condition="contains all">wsl.exe;-u root</CommandLine>
        <CommandLine name="technique_id=T1218,technique_name=Trusted Binary Proxy Execution" condition="contains all">wsl.exe;/u root</CommandLine>
        <CommandLine name="technique_id=T1218,technique_name=Trusted Binary Proxy Execution" condition="contains all">wsl.exe;--exec bash</CommandLine>
        <Rule name="Remote Copy via wsl" groupRelation="and">
          <CommandLine name="technique_id=T1202,technique_name=Remote File Copy" condition="contains all">wsl.exe;--exec bash</CommandLine>
          <CommandLine name="technique_id=T1202,technique_name=Remote File Copy" condition="contains all">/dev/tcp</CommandLine>
        </Rule>
      </ProcessCreate>
    </RuleGroup>
    <!-- Event ID 1 == Process Creation - Excludes -->
    <RuleGroup groupRelation="or">
      <ProcessCreate onmatch="exclude">
        <!-- Windows csrss.exe - Client Server Runtime Process - processo critico di Windows -->
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\System32\csrss.exe</Image>
          <CommandLine condition="contains all">csrss.exe ObjectDirectory=\Windows;ServerDll=</CommandLine>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
          <IntegrityLevel condition="is">System</IntegrityLevel>
        </Rule>
        <!-- Windows TPM Tool diagnostica legittima -->
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Windows\System32\TpmTool.exe</ParentImage>
          <ParentCommandLine condition="contains">gatherlogs</ParentCommandLine>
          <Image condition="is">C:\Windows\System32\cmd.exe</Image>
          <CommandLine condition="contains all">reg.exe query;Microsoft\Diagnosis\Temp\DiagTrack</CommandLine>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- Office ClickToRun - Esclusione ampia per tutte le operazioni di Integrator.exe -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">\Microsoft Office\root\Integration\Integrator.exe</ParentImage>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- Office ClickToRun Telemetry - schtasks.exe per qualsiasi task Office -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">\Microsoft Office\root\Integration\Integrator.exe</ParentImage>
          <Image condition="end with">\schtasks.exe</Image>
          <CommandLine condition="contains">Microsoft\Office\</CommandLine>
        </Rule>
        <!-- Adobe Reader - Esclusione più sicura -->
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files (x86)\Adobe\Acrobat Reader DC\Reader\AcroRd32.exe</Image>
          <CommandLine condition="contains any">/CR;channel=</CommandLine>
          <ParentImage condition="contains any">C:\Program Files (x86)\Adobe\;explorer.exe</ParentImage>
        </Rule>
            <!-- ManageEngine ADSelfService Plus - Software legittimo per gestione password AD -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\ManageEngine\ADSelfService Plus\</ParentImage>
            <ParentImage condition="end with">\java.exe</ParentImage>
            <Image condition="is">C:\Windows\System32\cmd.exe</Image>
            <CommandLine condition="contains">RemoteExecM2.exe</CommandLine>
            <User condition="contains any">svc_dc;\svc_</User>
        </Rule>
        <!-- Esclusione più generica per tutti i processi ManageEngine -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\ManageEngine\</ParentImage>
            <Image condition="contains any">cmd.exe;powershell.exe</Image>
            <CurrentDirectory condition="contains">\ManageEngine\</CurrentDirectory>
        </Rule>
        <!-- Esclusione specifica per ADSelfService Plus sync -->
        <Rule groupRelation="and">
            <CommandLine condition="contains all">RemoteExecM2.exe;ZDSync</CommandLine>
        </Rule>
        <!-- ADSelfService Plus Enrollment via Group Policy -->
        <Rule groupRelation="and">
            <Image condition="end with">\mshta.exe</Image>
            <CommandLine condition="contains">ADSelfService_Enroll.hta</CommandLine>
            <ParentImage condition="end with">\mshta.exe</ParentImage>
            <ParentCommandLine condition="contains all">SysVol;Policies;User\Scripts\Logon\ADSelfService_Enroll.hta</ParentCommandLine>
        </Rule>
        <!-- ADSelfServicePlus - Esclusione ampia per tutti gli script eseguiti via GPO -->
        <Rule groupRelation="and">
            <ParentImage condition="is">C:\Windows\System32\gpscript.exe</ParentImage>
            <CommandLine condition="contains">ADSelfServicePlus</CommandLine>
        </Rule>
    <!-- Script di login aziendale - Esclusione per evitare falsi positivi durante il login utenti -->
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Windows\System32\userinit.exe</ParentImage>
          <Image condition="is">C:\Windows\System32\cmd.exe</Image>
          <CommandLine condition="contains">\netlogon\Logon_BAG_User.bat</CommandLine>
        </Rule>
    <!-- Evernote updater - Esclusione per PowerShell eseguito durante aggiornamenti -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">\evernote-client-updater\</ParentImage>
          <Image condition="end with">\powershell.exe</Image>
          <CommandLine condition="contains any">Evernote;Uninstall</CommandLine>
        </Rule>
    <!-- Windows Application Compatibility - sdbinst.exe con parametro -mm -->
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\System32\sdbinst.exe</Image>
          <CommandLine condition="contains"> -mm</CommandLine>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
    <!-- TeamViewer - Esclusione totale per qualsiasi processo creato -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">\TeamViewer\</ParentImage>
        </Rule>
    <!-- Veeam - Esclusione totale per qualsiasi processo creato (software critico di backup) -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">\Veeam\</ParentImage>
        </Rule>
    <!-- Dropbox - regsvr32.exe per registrazione/deregistrazione DLL durante aggiornamenti -->
        <Rule groupRelation="and">
          <Image condition="end with">\regsvr32.exe</Image>
          <CommandLine condition="contains">Dropbox\Client\DropboxExt</CommandLine>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
    <!-- Postman - Esclusione per primo avvio con Squirrel Framework -->
    <!-- Postman usa Squirrel per installazione/aggiornamento e durante il primo avvio esegue comandi di discovery -->
    <Rule groupRelation="and">
          <ParentImage condition="contains">\Postman.exe</ParentImage>
          <ParentCommandLine condition="contains">--squirrel-firstrun</ParentCommandLine>
          <Image condition="is">C:\Windows\System32\cmd.exe</Image>
          <CommandLine condition="contains any">icacls;dir;fsutil</CommandLine>
        </Rule>
    <!-- Eccezione 1: AXIS Camera Station - Esclusione ampia per cmd.exe che esegue PowerShell scripts -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">Axis Communications\AXIS Camera Station\Core\Server</ParentImage>
          <ParentImage condition="end with">AcsService.exe</ParentImage>
          <Image condition="is">C:\Windows\System32\cmd.exe</Image>
          <CommandLine condition="contains">powershell.exe</CommandLine>
          <CurrentDirectory condition="contains">Axis Communications\AXIS Camera Station Server</CurrentDirectory>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- Windows Session Manager (smss.exe) che crea sessioni speciali - comportamento normale -->
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\System32\smss.exe</Image>
          <CommandLine condition="contains all">smss.exe;WinLogon.exe;-SpecialSession</CommandLine>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
          <IntegrityLevel condition="is">System</IntegrityLevel>
        </Rule>
        <!-- Windows Session Manager (smss.exe) con SystemRoot - variante con percorso SystemRoot -->
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\System32\smss.exe</Image>
          <CommandLine condition="contains all">\SystemRoot\System32\smss.exe;WinLogon.exe;-SpecialSession</CommandLine>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
          <IntegrityLevel condition="is">System</IntegrityLevel>
        </Rule>
        <!-- Windows Session Manager (smss.exe) - esclusione più generica per tutte le sessioni speciali -->
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\System32\smss.exe</Image>
          <OriginalFileName condition="is">smss.exe</OriginalFileName>
          <CommandLine condition="contains">-SpecialSession</CommandLine>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
          <IntegrityLevel condition="is">System</IntegrityLevel>
        </Rule>
        <!-- Eccezione 2: AXIS Camera Station - cmd.exe che esegue comandi di gestione componenti -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">Axis Communications\AXIS Camera Station\Core\Server</ParentImage>
          <ParentImage condition="end with">AcsService.exe</ParentImage>
          <Image condition="is">C:\Windows\System32\cmd.exe</Image>
          <CurrentDirectory condition="contains">Axis Communications\AXIS Camera Station Server</CurrentDirectory>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- Eccezione 3: AXIS Camera Station - PowerShell.exe eseguito da componenti Axis -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">Axis Communications\AXIS Camera Station</ParentImage>
          <Image condition="contains">powershell.exe</Image>
          <CurrentDirectory condition="contains">Axis Communications\AXIS Camera Station</CurrentDirectory>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- Eccezione 4: PowerShell.exe lanciato da cmd.exe per script Axis -->
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Windows\System32\cmd.exe</ParentImage>
          <Image condition="contains">powershell.exe</Image>
          <CommandLine condition="contains">Axis Communications\AXIS Camera Station</CommandLine>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- Eccezione 5: PowerShell.exe per script in directory Axis -->
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Windows\System32\cmd.exe</ParentImage>
          <Image condition="contains">powershell.exe</Image>
          <CurrentDirectory condition="contains">Axis Communications\AXIS Camera Station</CurrentDirectory>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- Native Instruments NTKDaemon che esegue ping per verificare connettività -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">\Native Instruments\NTK\NTKDaemon.exe</ParentImage>
          <Image condition="is">C:\Windows\System32\cmd.exe</Image>
          <CommandLine condition="contains all">cmd.exe /c ping;8.8.8.8</CommandLine>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- NinjaRMM - Esclusione ampia per processi creati dai componenti NinjaRMM -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">\NinjaRMMAgent\</ParentImage>
          <Image condition="contains any">cmd.exe;powershell.exe</Image>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>

        <!-- Eccezione 5: AXIS SecureEntry - Verifica processo durante installazione -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">AXISSecureEntry_</ParentImage>
          <ParentImage condition="end with">.tmp</ParentImage>
          <Image condition="contains any">cmd.exe;SysWOW64\cmd.exe</Image>
          <CommandLine condition="contains all">tasklist;ImageName eq SecureEntry.exe</CommandLine>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- Eccezione 6: AXIS Camera Station - Installazione automatica di componenti -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">Axis Communications\AXIS Camera Station\Core\Server</ParentImage>
          <ParentImage condition="end with">AcsService.exe</ParentImage>
          <Image condition="contains any">cmd.exe;System32\cmd.exe</Image>
          <CommandLine condition="contains all">AXISSecureEntry_;/VERYSILENT;/SUPPRESSMSGBOXES</CommandLine>
          <CurrentDirectory condition="contains">Axis Communications\AXIS Camera Station Server\Components</CurrentDirectory>
          <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Eccezione 7: AXIS Camera Station - msiexec esegue cmd per copiare log di installazione -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">msiexec.exe</ParentImage>
          <Image condition="contains">cmd.exe</Image>
          <CommandLine condition="contains all">xcopy;Axis Communications\AXIS Camera Station\;Installation_</CommandLine>
          <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Eccezione 8: AXIS Data Insights Dashboard - cmd.exe esegue ver per controllo versione Windows -->
        <Rule groupRelation="and">
          <ParentImage condition="contains any">Axis Communications\AXIS Camera Station\Components\AXIS Data Insights Dashboard;Axis Site Controller</ParentImage>
          <Image condition="is">C:\Windows\System32\cmd.exe</Image>
          <CommandLine condition="contains any">cmd /c "ver";"ver"</CommandLine>
          <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>

        <!-- OpenVPN Connect - Controllo interfacce di rete legittimo -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">\OpenVPN Connect\OpenVPNConnect.exe</ParentImage>
          <Image condition="is">C:\Windows\System32\cmd.exe</Image>
          <CommandLine condition="contains all">netsh wlan show interfaces;findstr;SSID</CommandLine>
        </Rule>
        <!-- NinjaRMM/NinjaOne - Software di gestione remota legittimo -->
    <!-- Esclude script di manutenzione eseguiti da NinjaRMM -->
    <Rule groupRelation="and">
      <ParentImage condition="contains any">\NinjaRMMAgent.exe;\NinjaOne\</ParentImage>
      <Image condition="is">C:\Windows\System32\cmd.exe</Image>
      <CommandLine condition="contains">\NinjaRMMAgent\uscripting\</CommandLine>
      <ParentUser condition="is">NT AUTHORITY\SYSTEM</ParentUser>
    </Rule>
    <!-- Esclusione più generica per tutti i processi figli di NinjaRMM -->
    <Rule groupRelation="and">
      <ParentImage condition="contains">\NinjaRMMAgent.exe</ParentImage>
      <Image condition="contains any">cmd.exe;powershell.exe;wscript.exe;cscript.exe</Image>
      <ParentUser condition="is">NT AUTHORITY\SYSTEM</ParentUser>
    </Rule>
    <!-- Esclusione per script NinjaRMM - SINTASSI CORRETTA -->
    <Rule groupRelation="and">
      <CommandLine condition="contains all">\ProgramData\NinjaRMMAgent\;ninjascript</CommandLine>
    </Rule>
    <!-- NinjaRMM Patch Management - Exclude all installers executed by patching component -->
    <Rule groupRelation="and">
      <ParentImage condition="contains">\NinjaRMMAgent\components\app-patching-ops\</ParentImage>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- NinjaRMM Patch Management - Exclude msiexec launched by NinjaRMM -->
    <Rule groupRelation="and">
      <ParentImage condition="contains">\NinjaRMMAgent\</ParentImage>
      <Image condition="contains">msiexec.exe</Image>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- NinjaRMM Patch Management - Exclude any executable in patches folder -->
    <Rule groupRelation="and">
      <Image condition="contains">\NinjaRMMAgent\components\app-patching-ops\content\patches\</Image>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- NinjaRMM Patch Management - Exclude child processes of patch installers -->
    <Rule groupRelation="and">
      <ParentImage condition="contains">\NinjaRMMAgent\components\app-patching-ops\content\patches\</ParentImage>
    </Rule>
    <!-- Intel Driver Support Assistant - Explorer launched to open URLs -->
    <Rule groupRelation="and">
      <ParentImage condition="contains">\Intel\Driver and Support Assistant\</ParentImage>
      <Image condition="contains">explorer.exe</Image>
      <CommandLine condition="contains">http</CommandLine>
    </Rule>
    <!-- Claude Code CLI - All legitimate activities -->
    <Rule groupRelation="and">
      <ParentImage condition="contains">node.exe</ParentImage>
      <ParentCommandLine condition="contains">claude-code</ParentCommandLine>
    </Rule>
    <!-- Claude Code CLI - Any child process from Claude -->
    <Rule groupRelation="and">
      <ParentCommandLine condition="contains">claude-code</ParentCommandLine>
    </Rule>
    <!-- PowerShell - Benign Get-CimInstance queries for process information -->
    <Rule groupRelation="and">
      <Image condition="end with">\powershell.exe</Image>
      <CommandLine condition="contains all">-NoProfile;-Command;Get-CimInstance Win32_Process;ParentProcessId</CommandLine>
    </Rule>
    <!-- PowerShell - Alternative pattern for process queries via cmd.exe -->
    <Rule groupRelation="and">
      <ParentImage condition="end with">\cmd.exe</ParentImage>
      <Image condition="end with">\powershell.exe</Image>
      <CommandLine condition="contains all">Get-CimInstance Win32_Process -Filter;ProcessId=;ParentProcessId</CommandLine>
    </Rule>
    <!-- ===== ESCLUSIONI PROCESSCREATE PER WINDOWS UPDATE ===== -->
    <!-- TiWorker esecuzione legittima -->
    <Rule groupRelation="and">
      <Image condition="is">C:\Windows\System32\TiWorker.exe</Image>
      <ParentImage condition="is">C:\Windows\servicing\TrustedInstaller.exe</ParentImage>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Update service host -->
    <Rule groupRelation="and">
      <CommandLine condition="contains">svchost.exe -k wusvcs</CommandLine>
      <ParentImage condition="is">C:\Windows\System32\services.exe</ParentImage>
    </Rule>
    <!-- DISM/dismhost esecuzione legittima -->
    <Rule groupRelation="and">
      <Image condition="contains">dismhost.exe</Image>
      <ParentImage condition="contains any">TiWorker.exe;dism.exe;svchost.exe</ParentImage>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Installer MSI che disabilita cipher suite TLS insicure durante installazione -->
    <Rule groupRelation="and">
      <ParentImage condition="is">C:\Windows\System32\rundll32.exe</ParentImage>
      <ParentCommandLine condition="contains all">Installer\MSI;zzzzInvokeManagedCustomActionOutOfProc;DisableInsecureCipherSuites</ParentCommandLine>
      <Image condition="end with">\powershell.exe</Image>
      <CommandLine condition="contains">Disable-TlsCipherSuite</CommandLine>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- ManageEngine OpManager network discovery - versione aggiornata -->
    <Rule groupRelation="and">
      <ParentImage condition="contains">ManageEngine\OpManager\jre\bin\java.exe</ParentImage>
      <Image condition="is">C:\Windows\System32\cmd.exe</Image>
      <CommandLine condition="contains all">nmap;ManageEngine\OpManager\Nmap</CommandLine>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- VMware vSphere CLI - Script Perl per backup configurazioni ESXi -->
    <Rule groupRelation="and">
      <ParentImage condition="contains">VMware\VMware vSphere CLI\Perl\bin\perl.exe</ParentImage>
      <ParentCommandLine condition="contains">vicfg-cfgbackup.pl</ParentCommandLine>
      <Image condition="contains">cmd.exe</Image>
      <CommandLine condition="contains">chcp</CommandLine>
      <User condition="contains">svc_dc</User>
    </Rule>
    <!-- Windows Compatibility Telemetry - PowerShell per verifiche Hyper-V/Network -->
    <Rule groupRelation="and">
      <ParentImage condition="is">C:\Windows\System32\CompatTelRunner.exe</ParentImage>
      <Image condition="is">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Image>
      <CommandLine condition="contains any">get-vmswitch;Get-NetLbfoTeamNic</CommandLine>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Compatibility Telemetry - PowerShell generico con ExecutionPolicy Restricted -->
    <Rule groupRelation="and">
      <ParentImage condition="is">C:\Windows\System32\CompatTelRunner.exe</ParentImage>
      <Image condition="is">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Image>
      <CommandLine condition="contains">-ExecutionPolicy Restricted</CommandLine>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
        <!-- Adobe - Esclusioni più sicure con verifica percorso completo -->
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\AcroCEF\AcroCEF.exe</Image>
          <ParentImage condition="contains">C:\Program Files (x86)\Adobe\</ParentImage>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files (x86)\Adobe\Acrobat Reader DC\Reader\AcroCEF\RdrCEF.exe</Image>
          <ParentImage condition="contains">C:\Program Files (x86)\Adobe\</ParentImage>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\LogTransport2.exe</Image>
          <ParentImage condition="contains">C:\Program Files (x86)\Adobe\</ParentImage>
        </Rule>
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Program Files (x86)\Common Files\Adobe\AdobeGCClient\AGSService.exe</ParentImage>
          <Image condition="contains">C:\Program Files (x86)\Adobe\</Image>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files (x86)\Adobe\Adobe Creative Cloud\ACC\Creative Cloud.exe</Image>
          <ParentImage condition="contains any">C:\Program Files (x86)\Adobe\;C:\Windows\System32\services.exe</ParentImage>
        </Rule>
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Program Files (x86)\Adobe\Adobe Creative Cloud\ACC\Creative Cloud.exe</ParentImage>
          <Image condition="contains">C:\Program Files (x86)\Adobe\</Image>
        </Rule>
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Program Files (x86)\Adobe\Adobe Creative Cloud\CCXProcess\CCXProcess.exe</ParentImage>
          <Image condition="contains">C:\Program Files (x86)\Adobe\</Image>
        </Rule>
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Program Files (x86)\Adobe\Adobe Creative Cloud\CoreSync\CoreSync.exe</ParentImage>
          <Image condition="contains">C:\Program Files (x86)\Adobe\</Image>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\SysWOW64\Macromed\Flash\FlashPlayerUpdateService.exe</Image>
          <ParentImage condition="is">C:\Windows\System32\services.exe</ParentImage>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files (x86)\Common Files\Adobe\ARM\1.0\AdobeARM.exe</Image>
          <ParentImage condition="contains any">C:\Program Files (x86)\Adobe\;C:\Windows\System32\svchost.exe</ParentImage>
        </Rule>
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Program Files (x86)\Common Files\Adobe\ARM\1.0\AdobeARM.exe</ParentImage>
          <Image condition="contains">C:\Program Files (x86)\Adobe\</Image>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files (x86)\Common Files\Adobe\ARM\1.0\armsvc.exe</Image>
          <ParentImage condition="is">C:\Windows\System32\services.exe</ParentImage>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\AdobeCollabSync.exe</Image>
          <ParentImage condition="contains">C:\Program Files (x86)\Adobe\</ParentImage>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files (x86)\Common Files\Adobe\Adobe Desktop Common\HEX\Adobe CEF Helper.exe</Image>
          <ParentImage condition="contains">C:\Program Files (x86)\Adobe\</ParentImage>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files (x86)\Common Files\Adobe\AdobeGCClient\AdobeGCClient.exe</Image>
          <ParentImage condition="contains any">C:\Windows\System32\services.exe;C:\Program Files (x86)\Adobe\</ParentImage>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\P6\adobe_licutil.exe</Image>
          <ParentImage condition="contains">C:\Program Files (x86)\Adobe\</ParentImage>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\P7\adobe_licutil.exe</Image>
          <ParentImage condition="contains">C:\Program Files (x86)\Adobe\</ParentImage>
        </Rule>
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\P7\adobe_licutil.exe</ParentImage>
          <Image condition="contains">C:\Program Files (x86)\Adobe\</Image>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\UWA\updaterstartuputility.exe</Image>
          <ParentImage condition="contains any">C:\Windows\System32\svchost.exe;C:\Program Files (x86)\Adobe\</ParentImage>
        </Rule>
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\UWA\updaterstartuputility.exe</ParentImage>
          <Image condition="contains">C:\Program Files (x86)\Adobe\</Image>
        </Rule>
        <ParentCommandLine condition="is">"C:\Program Files\Microsoft Monitoring Agent\Agent\MonitoringHost.exe" -Embedding</ParentCommandLine>
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Program Files\Microsoft Monitoring Agent\Agent\MonitoringHost.exe</ParentImage>
          <CommandLine condition="is">"C:\Windows\system32\cscript.exe" /nologo "MonitorKnowledgeDiscovery.vbs"</CommandLine>
        </Rule>
        <ParentImage condition="end with">C:\Program Files (x86)\Cisco\Cisco AnyConnect Secure Mobility Client\vpnagent.exe</ParentImage>
        <Image condition="begin with">C:\program files (x86)\desktopcentral_agent\bin\</Image>
        <Image condition="begin with">C:\program files\desktopcentral_server\bin\</Image>
        <CommandLine condition="begin with">C:\Windows\Microsoft.NET\Framework\v4.0.30319\ngen.exe</CommandLine>
        <Image condition="is">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorsvw.exe</Image>
        <Image condition="is">C:\Windows\Microsoft.NET\Framework\v4.0.30319\mscorsvw.exe</Image>
        <Image condition="is">C:\Windows\Microsoft.Net\Framework64\v3.0\WPF\PresentationFontCache.exe</Image>
        <ParentCommandLine condition="contains">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\ngentask.exe</ParentCommandLine>
        <ParentImage condition="is">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorsvw.exe</ParentImage>
        <ParentImage condition="is">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\ngentask.exe</ParentImage>
        <ParentImage condition="is">C:\Windows\Microsoft.NET\Framework\v4.0.30319\mscorsvw.exe</ParentImage>
        <ParentImage condition="is">C:\Windows\Microsoft.NET\Framework\v4.0.30319\ngentask.exe</ParentImage>
        <Image condition="begin with">C:\Program Files\NVIDIA Corporation\</Image>
        <Image condition="begin with">C:\Program Files\Realtek\</Image>
        <ParentImage condition="end with">C:\Program Files\Realtek\Audio\HDA\RtkAudioService64.exe</ParentImage>
        <Image condition="end with">C:\Program Files (x86)\Dropbox\Update\DropboxUpdate.exe</Image>
        <ParentImage condition="end with">C:\Program Files (x86)\Dropbox\Update\DropboxUpdate.exe</ParentImage>
        <!-- Dropbox installer che usa regsvr32 per registrare/deregistrare shell extensions -->
        <Rule groupRelation="and">
            <Image condition="contains">regsvr32.exe</Image>
            <CommandLine condition="contains all">regsvr32.exe;Dropbox\Client\DropboxExt</CommandLine>
            <ParentImage condition="contains">Dropbox.exe</ParentImage>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Dropbox installer che usa regsvr32 per deregistrare shell extensions durante update -->
        <Rule groupRelation="and">
            <Image condition="contains">regsvr32.exe</Image>
            <CommandLine condition="contains all">regsvr32.exe;/u;DropboxExt</CommandLine>
            <ParentImage condition="contains all">chrome_Unpacker_BeginUnzipping;Dropbox.exe</ParentImage>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Dropbox installer che usa regsvr32 - versione più generica -->
        <Rule groupRelation="and">
            <Image condition="contains">regsvr32.exe</Image>
            <CommandLine condition="contains">DropboxExt</CommandLine>
            <ParentImage condition="contains">chrome_Unpacker_BeginUnzipping</ParentImage>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Dropbox installer che usa regsvr32 per DropboxOfficeAddin -->
        <Rule groupRelation="and">
            <Image condition="contains">regsvr32.exe</Image>
            <CommandLine condition="contains">DropboxOfficeAddin</CommandLine>
            <ParentImage condition="contains">chrome_Unpacker_BeginUnzipping</ParentImage>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Dropbox installer che usa cmd.exe per verificare la versione -->
        <Rule groupRelation="and">
            <Image condition="is">C:\Windows\System32\cmd.exe</Image>
            <CommandLine condition="contains">/c "ver"</CommandLine>
            <ParentImage condition="contains">chrome_Unpacker_BeginUnzipping</ParentImage>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Dropbox installer che usa PowerShell per rimuovere DropboxOEM -->
        <Rule groupRelation="and">
            <Image condition="contains">powershell.exe</Image>
            <CommandLine condition="contains all">Remove-AppxPackage;DropboxOEM</CommandLine>
            <ParentImage condition="contains">chrome_Unpacker_BeginUnzipping</ParentImage>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <Image condition="is">C:\Program Files\ESET\ESET Nod32 Antivirus\ekrn.exe</Image>
        <!-- ESET Security eServiceHost.exe che controlla utenti disconnessi -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\ESET\ESET Security\eServiceHost.exe</ParentImage>
            <Image condition="is">C:\Windows\System32\cmd.exe</Image>
            <CommandLine condition="contains all">query.exe;user;find;Disc</CommandLine>
        </Rule>
        <CommandLine condition="begin with">"C:\Program Files (x86)\Google\Chrome\Application\chrome.exe" --type=</CommandLine>
        <CommandLine condition="begin with">"C:\Program Files\Google\Chrome\Application\chrome.exe" --type=</CommandLine>
        <Image condition="begin with">C:\Program Files (x86)\Google\Update\</Image>
        <ParentImage condition="begin with">C:\Program Files (x86)\Google\Update\</ParentImage>
        <ParentImage condition="is">C:\Program Files (x86)\RES Software\Workspace Manager\pfwsmgr.exe</ParentImage>
        <ParentImage condition="is">C:\Program Files (x86)\RES Software\Workspace Manager\respesvc64.exe</ParentImage>
        <ParentImage condition="is">C:\Program Files (x86)\Ivanti\Workspace Control\pfwsmgr.exe</ParentImage>
        <ParentImage condition="is">C:\Program Files (x86)\RES Software\Workspace Manager\ResPesvc64.exe</ParentImage>
        <ParentImage condition="is">C:\Program Files\RES Software\Workspace Manager\respesvc.exe</ParentImage>
        <ParentImage condition="is">C:\Program Files\Ivanti\Workspace Control\ResPesvc.exe</ParentImage>
        <Image condition="is">C:\Program Files\Malwarebytes\Anti-Malware\mbam.exe</Image>
        <Image condition="is">C:\Program Files\Malwarebytes\Anti-Malware\mbamservice.exe</Image>
        <Image condition="is">C:\Program Files\Malwarebytes\Anti-Malware\mbamtray.exe</Image>
        <Image condition="is">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeC2RClient.exe</Image>
        <ParentImage condition="end with">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeClickToRun.exe</ParentImage>
        <ParentImage condition="is">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeC2RClient.exe</ParentImage>
        <Image condition="is">C:\Program Files (x86)\Microsoft Office\Office16\MSOSYNC.EXE</Image>
        <Image condition="is">C:\Program Files\Common Files\Microsoft Shared\OfficeSoftwareProtectionPlatform\OSPPSVC.EXE</Image>
        <CommandLine condition="begin with">"C:\Program Files\Mozilla Firefox\plugin-container.exe" --channel</CommandLine>
        <CommandLine condition="begin with">"C:\Program Files (x86)\Mozilla Firefox\plugin-container.exe" --channel</CommandLine>
        <Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Sophos\Sophos Anti-Virus\Web Intelligence\swi_service.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Sophos\Sophos Anti-Virus\Web Control\swc_service.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Sophos\Sophos System Protection\ssp.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Sophos\Remote Management System\RouterNT.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Sophos\AutoUpdate\ALsvc.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Sophos\Sophos Anti-Virus\SAVAdminService.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Sophos\Remote Management System\ManagementAgentNT.exe</Image>
        <Image condition="begin with">C:\Program Files\Splunk\bin\</Image>
        <ParentImage condition="is">C:\Program Files\Splunk\bin\splunkd.exe</ParentImage>
        <ParentImage condition="is">C:\Program Files\Splunk\bin\splunk.exe</ParentImage>
        <Image condition="begin with">D:\Program Files\Splunk\bin\</Image>
        <ParentImage condition="is">D:\Program Files\Splunk\bin\splunkd.exe</ParentImage>
        <ParentImage condition="is">D:\Program Files\Splunk\bin\splunk.exe</ParentImage>
        <Image condition="begin with">C:\Program Files\SplunkUniversalForwarder\bin\</Image>
        <ParentImage condition="is">C:\Program Files\SplunkUniversalForwarder\bin\splunkd.exe</ParentImage>
        <ParentImage condition="is">C:\Program Files\SplunkUniversalForwarder\bin\splunk.exe</ParentImage>
        <Image condition="begin with">D:\Program Files\SplunkUniversalForwarder\bin\</Image>
        <ParentImage condition="is">D:\Program Files\SplunkUniversalForwarder\bin\splunkd.exe</ParentImage>
        <ParentImage condition="is">D:\Program Files\SplunkUniversalForwarder\bin\splunk.exe</ParentImage>
        <ParentCommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted</ParentCommandLine>
        <Rule groupRelation="or">
          <Image condition="contains">svchost.exe</Image>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k appmodel -s StateRepository</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k appmodel</CommandLine>
          <CommandLine condition="is">C:\WINDOWS\system32\svchost.exe -k appmodel -p -s tiledatamodelsvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k camera -s FrameServer</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k dcomlaunch -s LSM</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k dcomlaunch -s PlugPlay</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k defragsvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k devicesflow -s DevicesFlowUserSvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k imgsvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localService -s EventSystem</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localService -s bthserv</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localService -s nsi</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localService -s w32Time</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceAndNoImpersonation</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s Dhcp</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s EventLog</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s TimeBrokerSvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s WFDSConMgrSvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceAndNoImpersonation -s SensrSvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceNoNetwork</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -p -s WPDBusEnum</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -p -s fhsvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s DeviceAssociationService</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s NcbService</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s SensorService</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s TabletInputService</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s UmRdpService</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s WPDBusEnum</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s WdiSystemHost</CommandLine>
          <CommandLine condition="is">C:\WINDOWS\System32\svchost.exe -k LocalSystemNetworkRestricted -p -s WdiSystemHost</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted</CommandLine>
          <CommandLine condition="is">C:\WINDOWS\system32\svchost.exe -k netsvcs -p -s wlidsvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -p -s ncaSvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s BDESVC</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s BITS</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s CertPropSvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s DsmSvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s Gpsvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s ProfSvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s SENS</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s SessionEnv</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s Themes</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s Winmgmt</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k networkService -p -s DoSvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k networkService -s Dnscache</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k networkService -s LanmanWorkstation</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k networkService -s NlaSvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k networkService -s TermService</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k networkService</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k networkServiceNetworkRestricted</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k rPCSS</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k secsvcs</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k swprv</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k unistackSvcGroup</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k utcsvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k wbioSvcGroup</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k werSvcGroup</CommandLine>
          <CommandLine condition="is">C:\WINDOWS\System32\svchost.exe -k wsappx -p -s ClipSVC</CommandLine>
          <CommandLine condition="is">C:\WINDOWS\system32\svchost.exe -k wsappx -p -s AppXSvc</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k wsappx -s ClipSVC</CommandLine>
          <CommandLine condition="is">C:\Windows\system32\svchost.exe -k wsappx</CommandLine>
        </Rule>
        <Image condition="is">C:\Program Files\Trend Micro\Deep Security Agent\ds_monitor.exe</Image>
        <Image condition="is">C:\Program Files\Trend Micro\Deep Security Agent\dsa.exe</Image>
        <Image condition="is">C:\Program Files\Trend Micro\Deep Security Agent\dsuam.exe</Image>
        <Image condition="is">C:\Program Files\Trend Micro\Deep Security Agent\Notifier.exe</Image>
        <Image condition="is">C:\Program Files\Trend Micro\Deep Security Agent\lib\Patch.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Trend Micro\BM\TMBMSRV.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Trend Micro\OfficeScan Client\TmopExtIns32.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Trend Micro\OfficeScan Client\TmExtIns.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Trend Micro\OfficeScan Client\TmListen.exe</Image>
        <Image condition="begin with">C:\Program Files\Windows Defender\</Image>
        <Image condition="is">C:\Windows\system32\MpSigStub.exe</Image>
        <Image condition="begin with">C:\Windows\SoftwareDistribution\Download\Install\AM_</Image>
        <Image condition="is">C:\Program Files\Microsoft Security Client\MpCmdRun.exe</Image>
        <CommandLine condition="begin with">C:\Windows\system32\DllHost.exe /Processid</CommandLine>
        <CommandLine condition="is">C:\Windows\system32\SearchIndexer.exe /Embedding</CommandLine>
        <Image condition="end with">C:\Windows\System32\CompatTelRunner.exe</Image>
        <Image condition="is">C:\Windows\System32\MusNotification.exe</Image>
        <Image condition="is">C:\Windows\System32\MusNotificationUx.exe</Image>
        <Image condition="is">C:\Windows\System32\audiodg.exe</Image>
        <Image condition="is">C:\Windows\System32\conhost.exe</Image>
        <Image condition="is">C:\Windows\System32\powercfg.exe</Image>
        <Image condition="is">C:\Windows\System32\wbem\WmiApSrv.exe</Image>
        <Image condition="is">C:\Windows\System32\wermgr.exe</Image>
        <Image condition="is">C:\Windows\SysWOW64\wermgr.exe</Image>
        <Image condition="is">C:\Windows\system32\sppsvc.exe</Image>
        <!-- Intel Arc Control - AGSRunner che esegue PowerShell per rilevare giochi -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\Intel\AGS\Libs\AGSRunner.bin</ParentImage>
            <Image condition="end with">\powershell.exe</Image>
            <CommandLine condition="contains">Get-AppxPackage</CommandLine>
        </Rule>
        <!-- Intel Graphics Command Center - Rilevamento giochi e app -->
        <Rule groupRelation="and">
            <ParentImage condition="contains all">C:\Users\;\AppData\Local\Intel\AGS\</ParentImage>
            <Image condition="end with">\powershell.exe</Image>
            <CommandLine condition="contains any">Get-AppxPackage;Get-Package;Get-ItemProperty</CommandLine>
        </Rule>
        <!-- Explorer che avvia nuova istanza di Explorer - comportamento normale Windows -->
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Windows\explorer.exe</ParentImage>
          <Image condition="is">C:\Windows\explorer.exe</Image>
        </Rule>
        <!-- PsShutdown - Sysinternals tool per spegnimento programmato PC aziendali -->
        <Image condition="is">C:\Windows\PSSDNSVC.EXE</Image>
        <Image condition="contains">psshutdown.exe</Image>
        <OriginalFileName condition="is">psshutdown.exe</OriginalFileName>
        <!-- PsShutdown eseguito da qualsiasi percorso con qualsiasi parametro -->
        <Rule groupRelation="and">
            <Image condition="end with">\psshutdown.exe</Image>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- PsShutdown.exe case insensitive da qualsiasi percorso -->
        <Image condition="end with">\PsShutdown.exe</Image>
        <!-- PsShutdown eseguito da script o GPO per spegnimento alle 22:00 -->
        <Rule groupRelation="and">
            <Image condition="contains">psshutdown.exe</Image>
            <CommandLine condition="contains any">-t 22:00;-accepteula;-f;shutdown</CommandLine>
        </Rule>
        <IntegrityLevel condition="is">AppContainer</IntegrityLevel>
        <ParentCommandLine condition="begin with">%%SystemRoot%%\system32\csrss.exe ObjectDirectory=\Windows</ParentCommandLine>
        <ParentImage condition="is">C:\Windows\system32\SearchIndexer.exe</ParentImage>
        <!-- Dell TechHub Instrumentation - Query hardware legittime -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\Dell\DTP\InstrumentationSubAgent\Dell.TechHub.Instrumentation.SubAgent.exe</ParentImage>
            <Image condition="is">C:\Windows\System32\cmd.exe</Image>
            <CommandLine condition="contains all">reg query;HKLM\HARDWARE\DESCRIPTION\System\CentralProcessor</CommandLine>
            <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- Dell UpdateService Inventory Collection - Controllo directory e inventario hardware -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\Dell\UpdateService\Service\InvColPC\invcol.exe</ParentImage>
            <Image condition="contains">cmd.exe</Image>
            <CommandLine condition="contains any">cd bin//Dell;echo %%ERRORLEVEL%%;dir /b;wmic;systeminfo;cd bin//Dell &amp;&amp; echo %%ERRORLEVEL%%</CommandLine>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Dell UpdateService generico - Tutti i processi figli legittimi -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\Dell\UpdateService\</ParentImage>
            <Image condition="contains any">cmd.exe;wmic.exe;powershell.exe</Image>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Dell SupportAssist SRE.exe che esegue expand per estrarre file CAB -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\Dell\SupportAssistAgent\SRE\SRE.exe</ParentImage>
            <Image condition="end with">\cmd.exe</Image>
            <CommandLine condition="contains all">expand;SupportAssist</CommandLine>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Dell SupportAssist SRE.exe che esegue query user per verificare sessioni utente -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\Dell\SupportAssistAgent\SRE\SRE.exe</ParentImage>
            <Image condition="end with">\cmd.exe</Image>
            <CommandLine condition="contains">query user</CommandLine>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Dell SupportAssist TechnicianToolkit - estrazione file CAB diagnostici -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\Dell\SupportAssistAgent\SRE\SRE.exe</ParentImage>
            <Image condition="contains any">cmd.exe;SysWOW64\cmd.exe</Image>
            <CommandLine condition="contains all">expand;TechnicianToolkit</CommandLine>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Lenovo UDC diagnostics - PowerShell per copiare log di diagnostica -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\Lenovo\udc\Service\UDClientService.exe</ParentImage>
            <Image condition="end with">\powershell.exe</Image>
            <CommandLine condition="contains all">copy-item;Lenovo\Udc\Log;Lenovo\Udc\diagnostics</CommandLine>
            <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- Lenovo UDC diagnostics - PowerShell per eliminare file zip di diagnostica -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\Lenovo\udc\Service\UDClientService.exe</ParentImage>
            <Image condition="end with">\powershell.exe</Image>
            <CommandLine condition="contains all">Get-ChildItem;Lenovo\Udc\diagnostics;*.zip;Delete()</CommandLine>
            <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- Lenovo UDC - Esclusione AMPIA per QUALSIASI PowerShell lanciato da UDClientService -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\Lenovo\udc\Service\UDClientService.exe</ParentImage>
            <Image condition="end with">\powershell.exe</Image>
            <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- Wacom Tablet Service - Monitor detection for pen display calibration -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\WTabletServiceISD.exe</ParentImage>
            <Image condition="end with">\powershell.exe</Image>
            <CommandLine condition="contains all">Get-WmiObject WmiMonitorID;UserFriendlyName</CommandLine>
        </Rule>
        <!-- NinjaOne WPM - Windows update package discovery using DISM -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\NinjaOne\NinjaWPM\NinjaWPM.exe</ParentImage>
            <Image condition="end with">\cmd.exe</Image>
            <CommandLine condition="contains all">DISM.exe /online;/get-packages;findstr.exe Update</CommandLine>
            <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- Wazuh Agent upgrade process - PowerShell script do_upgrade.ps1 -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\ossec-agent\</ParentImage>
            <ParentImage condition="end with">\powershell.exe</ParentImage>
            <ParentCommandLine condition="contains">do_upgrade.ps1</ParentCommandLine>
            <Image condition="end with">\powershell.exe</Image>
            <CommandLine condition="contains">-encodedCommand</CommandLine>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- VS Code installer - PowerShell per verificare pacchetti installati -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">CodeSetup-stable-</ParentImage>
            <Image condition="end with">\powershell.exe</Image>
            <CommandLine condition="contains all">ExecutionPolicy Bypass;Get-AppxPackage;Microsoft.VisualStudioCode</CommandLine>
        </Rule>
        <!-- VS Code installer generico - Pattern alternativo -->
        <Rule groupRelation="and">
            <ParentImage condition="contains all">\Temp\;CodeSetup</ParentImage>
            <Image condition="end with">\powershell.exe</Image>
            <CommandLine condition="contains">Get-AppxPackage -Name 'Microsoft.VisualStudioCode'</CommandLine>
        </Rule>
        <!-- VS Code che verifica WSL installato - integrazione legittima -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">Microsoft VS Code\Code.exe</ParentImage>
            <Image condition="is">C:\Windows\System32\cmd.exe</Image>
            <CommandLine condition="contains">wsl.exe -l -q</CommandLine>
        </Rule>
        <!-- Cursor IDE (fork di VS Code) che esegue comandi git legittimi -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\cursor\Cursor.exe</ParentImage>
            <Image condition="is">C:\Windows\System32\cmd.exe</Image>
            <CommandLine condition="contains">git</CommandLine>
        </Rule>
        <!-- Windsurf IDE (fork di VS Code) che esegue PowerShell per terminal integrato -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\Windsurf\Windsurf.exe</ParentImage>
            <Image condition="end with">\powershell.exe</Image>
            <CommandLine condition="contains all">-NoProfile;-ExecutionPolicy Unrestricted;-Command</CommandLine>
        </Rule>
        <!-- Duo Security Authentication Proxy - Verifica versione Windows legittima -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\Duo Security Authentication Proxy\</ParentImage>
            <Image condition="is">C:\Windows\System32\cmd.exe</Image>
            <CommandLine condition="contains">cmd.exe /c "ver"</CommandLine>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- ESET Security Auto-Exclusions - Query IIS legittime -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\ESET\ESET Security\eAutoExclusions.exe</ParentImage>
            <Image condition="is">C:\Windows\System32\inetsrv\appcmd.exe</Image>
            <CommandLine condition="contains">appcmd.exe</CommandLine>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- VMware Tools - Script poweron legittimo -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\VMware\VMware Tools\vmtoolsd.exe</ParentImage>
            <Image condition="is">C:\Windows\System32\cmd.exe</Image>
            <CommandLine condition="contains">poweron-vm-default.bat</CommandLine>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Intel SUR (System Usage Report) - Legitimate scheduled task -->
        <Rule groupRelation="and">
            <ParentImage condition="is">C:\Windows\System32\svchost.exe</ParentImage>
            <ParentCommandLine condition="contains">Schedule</ParentCommandLine>
            <Image condition="is">C:\Windows\System32\wscript.exe</Image>
            <CommandLine condition="contains all">C:\Program Files\Intel\SUR\QUEENCREEK;task.vbs</CommandLine>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Intel SUR - cmd.exe running task.bat -->
        <Rule groupRelation="and">
            <ParentImage condition="is">C:\Windows\System32\wscript.exe</ParentImage>
            <ParentCommandLine condition="contains all">C:\Program Files\Intel\SUR\QUEENCREEK;task.vbs</ParentCommandLine>
            <Image condition="is">C:\Windows\System32\cmd.exe</Image>
            <CommandLine condition="contains">C:\Program Files\Intel\SUR\QUEENCREEK</CommandLine>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- NinjaOne RMM - Windows Patch Management -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\NinjaOne\NinjaWPM\NinjaWPM.exe</ParentImage>
            <Image condition="contains">cmd.exe</Image>
            <CommandLine condition="contains any">DISM.exe /online;get-packages</CommandLine>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Dropbox - Version check command -->
        <Rule groupRelation="and">
            <ParentImage condition="contains">\Dropbox\Client\Dropbox.exe</ParentImage>
            <Image condition="is">C:\Windows\System32\cmd.exe</Image>
            <CommandLine condition="contains">cmd.exe /c "ver"</CommandLine>
        </Rule>
        
        <!-- ======== ESCLUSIONI AGGIUNTE PER RIDURRE FALSI POSITIVI ======== -->
        
        <!-- Windows Defender e componenti di sicurezza Microsoft -->
        <Rule groupRelation="and">
          <Image condition="contains any">MsMpEng.exe;MpCmdRun.exe;SecurityHealthService.exe;SecurityHealthSystray.exe</Image>
          <ParentImage condition="contains">\Windows Defender\</ParentImage>
        </Rule>
        
        <!-- Windows Update e servizi di manutenzione -->
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Windows\System32\TiWorker.exe</ParentImage>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        
        <!-- Windows Search Indexer -->
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Windows\System32\SearchIndexer.exe</ParentImage>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        
        <!-- Microsoft Edge aggiornamenti automatici -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">\Microsoft\EdgeUpdate\</ParentImage>
          <Image condition="contains any">MicrosoftEdgeUpdate.exe;msedge.exe</Image>
        </Rule>
        
        <!-- Chrome aggiornamenti automatici -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">\Google\Update\</ParentImage>
          <Image condition="contains">GoogleUpdate.exe</Image>
        </Rule>
        
        <!-- Visual Studio Code e componenti -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">\Microsoft VS Code\</ParentImage>
          <Image condition="contains any">Code.exe;code-tunnel.exe</Image>
        </Rule>
        
        <!-- Microsoft Teams -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">\Microsoft\Teams\</ParentImage>
          <Image condition="contains">Teams.exe</Image>
        </Rule>
        
        <!-- Zoom -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">\Zoom\</ParentImage>
          <Image condition="contains">Zoom.exe</Image>
        </Rule>
        
        <!-- Wazuh Agent - Esclusione per agent di monitoraggio -->
        <Rule groupRelation="and">
          <Image condition="contains">\wazuh-agent\</Image>
          <ParentImage condition="contains">\wazuh-agent\</ParentImage>
        </Rule>
        
        <!-- Wazuh Agent FIM - File comparison operations (fc command) -->
        <Rule groupRelation="and">
          <ParentImage condition="contains">\ossec-agent\wazuh-agent.exe</ParentImage>
          <Image condition="is">C:\Windows\System32\cmd.exe</Image>
          <CommandLine condition="contains all">/c fc;ossec-agent\queue\diff</CommandLine>
          <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        
        <!-- OneDrive sync -->
        <Rule groupRelation="and">
          <Image condition="contains">OneDrive.exe</Image>
          <ParentImage condition="contains any">explorer.exe;userinit.exe</ParentImage>
        </Rule>
        
        <!-- Print Spooler service - Basic monitoring -->
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Windows\System32\spoolsv.exe</ParentImage>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        
        <!-- PrintNightmare Detection - Suspicious child processes from spoolsv.exe -->
        <Rule name="PrintNightmare_Suspicious_Child" groupRelation="and">
          <ParentImage condition="is">C:\Windows\System32\spoolsv.exe</ParentImage>
          <Image condition="is not">C:\Windows\System32\splwow64.exe</Image>
          <Image condition="is not">C:\Windows\System32\PrintIsolationHost.exe</Image>
          <Image condition="is not">C:\Windows\System32\conhost.exe</Image>
        </Rule>
        
        <!-- PrintNightmare - Execution from spool GUID directories -->
        <Rule name="PrintNightmare_GUID_Execution" groupRelation="or">
          <Image condition="contains all">C:\Windows\System32\spool\;{</Image>
          <Image condition="contains all">C:\Windows\SysWOW64\spool\;{</Image>
          <Image condition="contains all">C:\Windows\System32\spool\PRINTERS\;{</Image>
        </Rule>
        
        <!-- PrintNightmare - Rundll32 loading DLLs from suspicious paths -->
        <Rule name="PrintNightmare_Rundll32_Spool" groupRelation="and">
          <Image condition="is">C:\Windows\System32\rundll32.exe</Image>
          <CommandLine condition="contains">C:\Windows\System32\spool\</CommandLine>
          <CommandLine condition="contains">{</CommandLine>
        </Rule>
        
        <!-- Windows Task Scheduler esecuzioni legittime -->
        <Rule groupRelation="and">
          <ParentImage condition="is">C:\Windows\System32\svchost.exe</ParentImage>
          <ParentCommandLine condition="contains">Schedule</ParentCommandLine>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        
        <!-- Software House conosciuti - PATH generiche per evitare rumore -->
        <Rule groupRelation="and">
          <Image condition="contains any">\Program Files\7-Zip\;\Program Files\WinRAR\;\Program Files\Notepad++\</Image>
          <IntegrityLevel condition="is not">Low</IntegrityLevel>
        </Rule>
        
        <!-- Esclusione per servizi Windows firmati di sistema -->
        <Rule groupRelation="and">
          <Image condition="begin with">C:\Windows\System32\</Image>
          <IntegrityLevel condition="is">System</IntegrityLevel>
          <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        
        <!-- ======== FINE ESCLUSIONI AGGIUNTE ======== -->
        
      </ProcessCreate>
    </RuleGroup>
    <!-- Event ID 2 == File Creation Time - Includes -->
    <RuleGroup groupRelation="or">
      <FileCreateTime onmatch="include">
        <TargetFilename name="technique_id=T1099,technique_name=Timestomp" condition="end with">.exe</TargetFilename>
        <Image name="technique_id=T1070.006,technique_name=Timestomp" condition="begin with">C:\Temp</Image>
        <Image name="technique_id=T1070.006,technique_name=Timestomp" condition="begin with">C:\Windows\Temp</Image>
        <Image name="technique_id=T1070.006,technique_name=Timestomp" condition="begin with">C:\Tmp</Image>
        <Image name="technique_id=T1070.006,technique_name=Timestomp" condition="begin with">C:\Users</Image>
        <Image name="technique_id=T1099,technique_name=Timestomp" condition="begin with">\Device\HarddiskVolumeShadowCopy</Image>
      </FileCreateTime>
    </RuleGroup>
    <!-- Event ID 2 == File Creation Time - Excludes -->
    <RuleGroup groupRelation="or">
      <FileCreateTime onmatch="exclude">
        <Image condition="end with">AppData\Local\Google\Chrome\Application\chrome.exe</Image>
        <Image condition="end with">Root\VFS\ProgramFilesX86\Google\Chrome\Application\chrome.exe</Image>
        <TargetFilename condition="contains">\NVIDIA\NvBackend\ApplicationOntology\</TargetFilename>
        <Image condition="contains">OneDrive.exe</Image>
        <Image condition="contains">setup</Image>
        <Image condition="end with">slack.exe</Image>
        <Image condition="end with">AppData\Local\Microsoft\Teams\current\Teams.exe</Image>
      </FileCreateTime>
    </RuleGroup>
    <!-- Event ID 3 == Network Connection - Includes -->
    <RuleGroup groupRelation="or">
      <NetworkConnect onmatch="include">
        <Image name="technique_id=T1021,technique_name=Remote Services" condition="contains">vnc.exe</Image>
        <Image name="technique_id=T1021,technique_name=Remote Services" condition="contains">vncviewer.exe</Image>
        <Image name="technique_id=T1021,technique_name=Remote Services" condition="contains">vncservice.exe</Image>
        <Image name="technique_id=T1569.002,technique_name=Service Execution" condition="contains">winexesvc.exe</Image>
        <Image name="technique_id=T1197,technique_name=BITS Jobs" condition="contains">bitsadmin.exe</Image>
        <DestinationPort name="technique_id=T1571,technique_name=Non-Standard Port" condition="is">4444</DestinationPort>
        <DestinationPort name="technique_id=T1571,technique_name=Non-Standard Port" condition="is">31337</DestinationPort>
        <DestinationPort name="technique_id=T1571,technique_name=Non-Standard Port" condition="is">6667</DestinationPort>
        <DestinationPort name="technique_id=T1571,technique_name=Non-Standard Port" condition="is">5555</DestinationPort>
        <DestinationPort name="technique_id=T1571,technique_name=Non-Standard Port" condition="is">5353</DestinationPort>
        <Image name="technique_id=T1021,technique_name=Remote Services" condition="contains">omniinet.exe</Image>
        <Image name="technique_id=T1021,technique_name=Remote Services" condition="contains">hpsmhd.exe</Image>
        <Image name="technique_id=T1102,technique_name=Web Service" condition="begin with">C:\Program Files\Microsoft\HybridConnectionManager</Image>
        <Rule name="Unusual Connection" groupRelation="or">
          <Image condition="contains">dllhost.exe</Image>
          <Image condition="contains">hh.exe</Image>
          <Image condition="contains">klist.exe</Image>
          <Image condition="contains">schtasks.exe</Image>
          <Image condition="contains">taskkill.exe</Image>
          <Image name="technique_id=T1218.005,technique_name=Mshta" condition="contains">mshta.exe</Image>
          <Image name="technique_id=T1218.010,technique_name=Regsvr32" condition="contains">regsvr32.exe</Image>
          <Image name="technique_id=T1518.001,technique_name=Security Software Discovery" condition="contains">netsh.exe</Image>
          <Image name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="contains">xwizard.exe</Image>
          <Image name="technique_id=T1564.004,technique_name=NTFS File Attributes" condition="contains">esentutl.exe</Image>
          <Image name="technique_id=T1112,technique_name=Modify Registry" condition="contains">reg.exe</Image>
          <Image name="technique_id=T1134,technique_name=Access Token Manipulation" condition="contains">runas.exe</Image>
          <Image name="technique_id=T1069,technique_name=Permission Groups Discovery" condition="contains">net1.exe</Image>
          <Image name="technique_id=T1070,technique_name=Indicator Removal on Host" condition="contains">wevtutil.exe</Image>
        </Rule>
        <Image name="technique_id=T1003,technique_name=Credential Dumping" condition="contains">RpcPing.exe</Image>
        <Rule name="Discovery" groupRelation="or">
          <Image name="technique_id=T1016,technique_name=System Network Configuration Discovery" condition="contains">ipconfig.exe</Image>
          <Image name="technique_id=T1016,technique_name=System Network Configuration Discovery" condition="contains">nbtstat.exe</Image>
          <Image name="technique_id=T1016,technique_name=System Network Configuration Discovery" condition="contains">nslookup.exe</Image>
          <Image name="technique_id=T1018,technique_name=Remote System Discovery" condition="contains">net.exe</Image>
          <Image name="technique_id=T1018,technique_name=Remote System Discovery" condition="contains">nslookup.exe</Image>
          <Image name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="contains">nltest.exe</Image>
          <Image name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="contains">quser.exe</Image>
          <Image name="technique_id=T1049,technique_name=System Network Connections Discovery" condition="contains">netstat.exe</Image>
          <Image name="technique_id=T1057,technique_name=Process Discovery" condition="contains">qprocess.exe</Image>
          <Image name="technique_id=T1057,technique_name=Process Discovery" condition="contains">query.exe</Image>
          <Image name="technique_id=T1057,technique_name=Process Discovery" condition="contains">qwinsta.exe</Image>
          <Image name="technique_id=T1057,technique_name=Process Discovery" condition="contains">rwinsta.exe</Image>
          <Image name="technique_id=T1057,technique_name=Process Discovery" condition="contains">tasklist.exe</Image>
        </Rule>
        <Rule name="Ingress Tool Transfer" groupRelation="or">
          <Image name="technique_id=T1105,technique_name=Ingress Tool Transfer" condition="contains">expand.exe</Image>
          <Image name="technique_id=T1105,technique_name=Ingress Tool Transfer" condition="contains">extrac32.exe</Image>
          <Image name="technique_id=T1105,technique_name=Ingress Tool Transfer" condition="contains">IEExec.exe</Image>
          <Image name="technique_id=T1105,technique_name=Ingress Tool Transfer" condition="contains">Print.Exe</Image>
        </Rule>
        <Rule name="Execution" groupRelation="or">
          <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="contains">cscript.exe</Image>
          <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="contains">desktopimgdownldr.exe</Image>
          <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="contains">pcalua.exe</Image>
          <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="contains">winrs.exe</Image>
          <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="contains">wscript.exe</Image>
          <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains">Msdt.exe</Image>
          <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains">msiexec.exe</Image>
          <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains">RegisterCimProvider.exe</Image>
          <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains">ScriptRunner.exe</Image>
          <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains">dfsvc.exe</Image>
        </Rule>
        <Rule name="Services" groupRelation="or">
          <Image name="technique_id=T1569.002,technique_name=Service Execution" condition="contains">dnscmd.exe</Image>
          <Image name="technique_id=T1543.003,technique_name=Windows Service" condition="contains">sc.exe</Image>
          <Image name="technique_id=T1053,technique_name=Scheduled Task/Job" condition="contains">taskeng.exe</Image>
        </Rule>
        <Rule name="Shells and Terminals" groupRelation="or">
          <Image name="technique_id=T1059.001,technique_name=PowerShell" condition="contains">OpenConsole.exe</Image>
          <Image name="technique_id=T1059.001,technique_name=PowerShell" condition="contains">powershell.exe</Image>
          <Image name="technique_id=T1059.001,technique_name=PowerShell" condition="contains">WindowsTerminal.exe</Image>
          <Image name="technique_id=T1059.003,technique_name=Windows Command Shell" condition="contains">cmd.exe</Image>
          <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="contains">bash.exe</Image>
        </Rule>
        <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains">Mavinject.exe</Image>
        <Image name="technique_id=T1053,technique_name=Scheduled Task" condition="contains">at.exe</Image>
        <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains">certutil.exe</Image>
        <Image name="technique_id=T1218,technique_name=Signed Script Proxy Execution" condition="contains">cscript.exe</Image>
        <Image condition="contains">java.exe</Image>
        <Image name="technique_id=T1218.005,technique_name=Mshta" condition="contains">mshta.exe</Image>
        <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains">msiexec.exe</Image>
        <Image name="technique_id=T1069,technique_name=Permission Groups Discovery" condition="contains">net.exe</Image>
        <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains">notepad.exe</Image>
        <Image name="technique_id=T1012,technique_name=Query Registry" condition="contains">reg.exe</Image>
        <Image name="technique_id=T1218,technique_name=Regsvr32" condition="contains">regsvr32.exe</Image>
        <Image name="technique_id=T1218.011,technique_name=Rundll32" condition="contains">rundll32.exe</Image>
        <Image name="technique_id=T1543.003,technique_name=Windows Service" condition="contains">sc.exe</Image>
        <Image name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains">wmic.exe</Image>
        <Image name="technique_id=T1218,technique_name=Signed Script Proxy Execution" condition="contains">wscript.exe</Image>
        <Image condition="contains">driverquery.exe</Image>
        <Image name="technique_id=T1069,technique_name=Permission Groups Discovery" condition="contains">dsquery.exe</Image>
        <Image name="technique_id=T1069,technique_name=Permission Groups Discovery" condition="contains">AdFind.exe</Image>
        <Image condition="contains">hh.exe</Image>
        <Image condition="contains">infDefaultInstall.exe</Image>
        <Image condition="contains">javaw.exe</Image>
        <Image condition="contains">javaws.exe</Image>
        <Image name="technique_id=T1543.003,technique_name=Windows Service" condition="contains">mmc.exe</Image>
        <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains">msbuild.exe</Image>
        <Image name="technique_id=T1016,technique_name=System Network Configuration Discovery" condition="contains">nbtstat.exe</Image>
        <Image name="technique_id=T1018,technique_name=Remote System Discovery" condition="contains">nslookup.exe</Image>
        <Image name="technique_id=T1057,technique_name=Process Discovery" condition="contains">qprocess.exe</Image>
        <Image name="technique_id=T1057,technique_name=Process Discovery" condition="contains">qwinsta.exe</Image>
        <Image name="technique_id=T1218.009,technique_name=Regsvcs/Regasm" condition="contains">regsvcs.exe</Image>
        <Image name="technique_id=T1057,technique_name=Process Discovery" condition="contains">rwinsta.exe</Image>
        <Image name="technique_id=T1053,technique_name=Scheduled Task/Job" condition="contains">schtasks.exe</Image>
        <Image name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="contains">taskkill.exe</Image>
        <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains">replace.exe</Image>
        <DestinationPort name="technique_id=T1571,technique_name=Non-Standard Port" condition="is">1080</DestinationPort>
        <DestinationPort name="technique_id=T1571,technique_name=Non-Standard Port" condition="is">3128</DestinationPort>
        <DestinationPort name="technique_id=T1571,technique_name=Non-Standard Port" condition="is">8080</DestinationPort>
        <DestinationPort name="technique_id=T1021,technique_name=Remote Services" condition="is">22</DestinationPort>
        <DestinationPort name="technique_id=T1021,technique_name=Remote Services" condition="is">23</DestinationPort>
        <DestinationPort name="technique_id=T1571,technique_name=Non-Standard Port" condition="is">25</DestinationPort>
        <Rule groupRelation="and">
          <DestinationPort name="technique_id=T1021,technique_name=Remote Services" condition="is">88</DestinationPort>
          <Image condition="is not">C:\Windows\System32\lsass.exe</Image>
        </Rule>
        <DestinationPort name="technique_id=T1021,technique_name=Remote Services" condition="is">3389</DestinationPort>
        <DestinationPort name="technique_id=T1021,technique_name=Remote Services" condition="is">5800</DestinationPort>
        <DestinationPort name="technique_id=T1021,technique_name=Remote Services" condition="is">5900</DestinationPort>
        <DestinationPort name="technique_id=T1021,technique_name=Remote Services" condition="is">5985</DestinationPort>
        <DestinationPort name="technique_id=T1021,technique_name=Remote Services" condition="is">5986</DestinationPort>
        <DestinationPort name="technique_id=T1087.002,technique_name=Account Discovery: Domain Account" condition="is">9389</DestinationPort>
        <Image name="technique_id=T1569.002,technique_name=Service Execution" condition="contains">psexec.exe</Image>
        <Image name="technique_id=T1569.002,technique_name=Service Execution" condition="contains">psexesvc.exe</Image>
        <Rule groupRelation="and">
          <SourcePort name="technique_id=T1557,technique_name=Adversary-in-the-Middle" condition="contains any">445;389;8492;636;3268;3269</SourcePort>
          <Image condition="is not">C:\Windows\System32\lsass.exe</Image>
          <Image condition="is not">c:\Windows\System32\dsamain.exe</Image>
          <ProcessId condition="is not">4</ProcessId>
        </Rule>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\ProgramData</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Temp</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Temp</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\PerfLogs\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\$Recycle.bin\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Intel\Logs\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\Default\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\Public\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\NetworkService\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Fonts\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Debug\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Media\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Help\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\addins\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\repair\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\security\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\system32\config\systemprofile\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="contains">\htdocs\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="contains">\wwwroot\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="contains">\AppData\Local\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="contains">\AppData\Local\Temp\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="contains">\AppData\Roaming\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="contains">\AppData\LocalLow\</Image>
        <Image name="technique_id=T1036,technique_name=Masquerading" condition="contains">C:\Windows\SysWOW64</Image>
        <Image name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="contains">SyncAppvPublishingServer.exe</Image>
        <Image condition="contains">tor.exe</Image>
        <DestinationPort name="technique_id=T1571,technique_name=Non-Standard Port" condition="is">1723</DestinationPort>
        <DestinationPort name="technique_id=T1571,technique_name=Non-Standard Port" condition="is">4500</DestinationPort>
        <DestinationPort name="technique_id=T1571,technique_name=Non-Standard Port" condition="is">9001</DestinationPort>
        <DestinationPort name="technique_id=T1571,technique_name=Non-Standard Port" condition="is">9030</DestinationPort>
        <DestinationPort name="technique_id=T1021.006,technique_name=Windows Remote Management" condition="is">5985</DestinationPort>
        <DestinationPort name="technique_id=T1021.006,technique_name=Windows Remote Management" condition="is">5986</DestinationPort>
      </NetworkConnect>
    </RuleGroup>
    <!-- Event ID 3 == Network Connection - Excludes -->
    <RuleGroup groupRelation="or">
      <NetworkConnect onmatch="exclude">
        <!-- NinjaRMM - Esclusione totale per tutte le connessioni di rete -->
        <Image condition="contains">\NinjaRMMAgent\</Image>
        <!-- ADSelfServicePlus - Esclusione totale per tutte le connessioni di rete -->
        <Image condition="contains">ADSelfServicePlus</Image>
        <!-- TeamViewer - Esclusione totale per tutte le connessioni di rete (software principale di gestione remota) -->
        <Image condition="contains">\TeamViewer\</Image>
        <!-- Veeam - Esclusione totale per tutte le connessioni di rete (software critico di backup) -->
        <Image condition="contains">\Veeam\</Image>
        <Image condition="end with">AppData\Roaming\Dropbox\bin\Dropbox.exe</Image>
        <Image condition="end with">winlogbeat.exe</Image>
        <Image condition="end with">packetbeat.exe</Image>
        <Image condition="is">C:\Program Files\ESET\ESET Nod32 Antivirus\ekrn.exe</Image>
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\System32\lsass.exe</Image>
          <DestinationPort condition="is">88</DestinationPort>
        </Rule>
        <Image condition="contains">OneDrive.exe</Image>
        <Image condition="contains">OneDriveStandaloneUpdater.exe</Image>
        <Image condition="end with">ownCloud\owncloud.exe</Image>
        <Image condition="is">C:\Program Files\Palo Alto Networks\Traps\cyserver.exe</Image>
        <Rule groupRelation="and">
          <Protocol condition="is">udp</Protocol>
          <DestinationPort condition="is">3389</DestinationPort>
        </Rule>
        <Image condition="is">C:\Program Files (x86)\Sophos\Sophos Anti-Virus\Web Intelligence\swi_service.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Sophos\AutoUpdate\ALsvc.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Sophos\Remote Management System\RouterNT.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Sophos\Sophos Anti-Virus\Web Control\swc_service.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Sophos\Sophos Anti-Virus\Web Intelligence\swi_service.exe</Image>
        <Image condition="is">C:\Program Files\Sophos\Sophos Network Threat Protection\bin\SntpService.exe</Image>
        <Image condition="end with">AppData\Roaming\Spotify\Spotify.exe</Image>
        <Image condition="end with">AppData\Local\SynologyDrive\SynologyDrive.app\bin\cloud-drive-ui.exe</Image>
        <Image condition="end with">AppData\Local\SynologyDrive\SynologyDrive.app\bin\cloud-drive-daemon.exe</Image>
        <Image condition="is">C:\Program files (x86)\Trend Micro\OfficeScan Client\tmlisten.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Trend Micro\BM\TMBMSRV.exe</Image>
        <DestinationHostname condition="end with">.windowsupdate.microsoft.com</DestinationHostname>
        <DestinationHostname condition="end with">.windowsupdate.com</DestinationHostname>
        <DestinationHostname condition="end with">wustat.windows.com</DestinationHostname>
        <DestinationHostname condition="end with">go.microsoft.com</DestinationHostname>
        <DestinationHostname condition="end with">.update.microsoft.com</DestinationHostname>
        <DestinationHostname condition="end with">download.microsoft.com</DestinationHostname>
        <DestinationHostname condition="end with">microsoft.com.akadns.net</DestinationHostname>
        <DestinationHostname condition="end with">microsoft.com.nsatc.net</DestinationHostname>
    <!-- Kemp LoadMaster health checks verso Exchange -->
    <Rule groupRelation="and">
    <SourceIp>192.168.222.20</SourceIp>
    <DestinationPort>5985</DestinationPort>
    <Image>System</Image>
    </Rule>
    
    <!-- ======== ESCLUSIONI AGGIUNTE PER NETWORK CONNECT ======== -->
    
    <!-- Windows Update -->
    <Rule groupRelation="and">
      <Image condition="contains any">svchost.exe;TiWorker.exe;TrustedInstaller.exe</Image>
      <DestinationPort condition="is">443</DestinationPort>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- Microsoft Edge/Chrome browser connessioni HTTPS -->
    <Rule groupRelation="and">
      <Image condition="contains any">msedge.exe;chrome.exe;firefox.exe</Image>
      <DestinationPort condition="is">443</DestinationPort>
      <Initiated condition="is">true</Initiated>
    </Rule>
    
    <!-- Microsoft Office connessioni legittime -->
    <Rule groupRelation="and">
      <Image condition="contains">\Microsoft Office\</Image>
      <DestinationPort condition="is any">443;80</DestinationPort>
    </Rule>
    
    <!-- Windows Defender cloud protection -->
    <Rule groupRelation="and">
      <Image condition="contains">MsMpEng.exe</Image>
      <DestinationPort condition="is">443</DestinationPort>
    </Rule>
    
    <!-- DNS queries locali -->
    <Rule groupRelation="and">
      <DestinationPort condition="is">53</DestinationPort>
      <DestinationIsIpv6 condition="is">false</DestinationIsIpv6>
    </Rule>
    
    <!-- Microsoft Teams connessioni -->
    <Rule groupRelation="and">
      <Image condition="contains">\Microsoft\Teams\</Image>
      <DestinationPort condition="is any">443;80</DestinationPort>
    </Rule>
    
    <!-- OneDrive sync -->
    <Rule groupRelation="and">
      <Image condition="contains">OneDrive.exe</Image>
      <DestinationPort condition="is">443</DestinationPort>
    </Rule>
    
    <!-- Wazuh Agent comunicazione con server -->
    <Rule groupRelation="and">
      <Image condition="contains">\wazuh-agent\</Image>
      <DestinationPort condition="is any">1514;1515;55000</DestinationPort>
    </Rule>
    
    <!-- ======== FINE ESCLUSIONI NETWORK CONNECT ======== -->
    
      </NetworkConnect>
    </RuleGroup>
    <!-- Event ID 5 == Process Terminated - Includes -->
    <RuleGroup groupRelation="or">
      <ProcessTerminate onmatch="include">
        <Image condition="begin with">C:\Users</Image>
        <Image condition="begin with">C:\Temp</Image>
        <Image condition="begin with">C:\Windows\Temp</Image>
      </ProcessTerminate>
    </RuleGroup>
    <!-- Event ID 6 == Driver Loaded - Excludes -->
    <RuleGroup groupRelation="or">
      <!--Default to log all and exclude only valid signed Microsoft or Intel drivers-->
      <DriverLoad onmatch="exclude">
        <Rule groupRelation="and">
          <Signature condition="begin with">Intel </Signature>
          <SignatureStatus condition="is">Valid</SignatureStatus>
        </Rule>
        <Rule groupRelation="and">
          <Signature condition="contains">Microsoft</Signature>
          <SignatureStatus condition="is">Valid</SignatureStatus>
        </Rule>
      </DriverLoad>
    </RuleGroup>
    <!-- Event ID 7 == Image Loaded - Includes -->
    <RuleGroup groupRelation="or">
      <ImageLoad onmatch="include">
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1059.001,technique_name=PowerShell" condition="is">amsi.dll</OriginalFileName>
          <Image condition="excludes">powershell.exe</Image>
          <Image condition="excludes">powershell_ise.exe</Image>
        </Rule>
        <Rule groupRelation="and">
          <Image name="technique_id=T1037.005,technique_name=Boot or Logon Initialization Scripts - Startup Items" condition="end with">bginfo.exe</Image>
          <ImageLoaded condition="contains any">System.ni.dll;System.Core.ni.dll</ImageLoaded>
        </Rule>
        <ImageLoaded name="technique_id=T1197,technique_name=BITS" condition="end with">bitsproxy.dll</ImageLoaded>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1055,technique_name=Process Injection" condition="is">clr.dll</OriginalFileName>
          <Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
        </Rule>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1055,technique_name=Process Injection" condition="is">clrjit.dll</OriginalFileName>
          <Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
        </Rule>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1055,technique_name=Process Injection" condition="is">mscoreei.dll</OriginalFileName>
          <Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
        </Rule>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1055,technique_name=Process Injection" condition="is">mscoree.dll</OriginalFileName>
          <Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
        </Rule>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1055,technique_name=Process Injection" condition="is">mscoreeis.dll</OriginalFileName>
          <Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
        </Rule>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1055,technique_name=Process Injection" condition="is">mscorlib.dll</OriginalFileName>
          <Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
        </Rule>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1055,technique_name=Process Injection" condition="is">mscorlib.ni.dll</OriginalFileName>
          <Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
        </Rule>
        <ImageLoaded name="technique_id=T1047,technique_name=Windows Scheduled Tasks" condition="end with">mstask.dll</ImageLoaded>
        <ImageLoaded name="technique_id=T1059,technique_name=Command and Scripting Interpreter" condition="end with">wshom.ocx</ImageLoaded>
        <OriginalFileName condition="is">scrrun.dll</OriginalFileName>
        <OriginalFileName condition="is">vbscript.dll</OriginalFileName>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1218.005,technique_name=MSHTA with AMSI Bypass" condition="is">jscript.dll</OriginalFileName>
          <Image condition="end with">mshta.exe</Image>
        </Rule>
        <Rule groupRelation="and">
          <OriginalFileName name="technique_id=T1218.005,technique_name=MSHTA with AMSI Bypass" condition="is">jscript9.dll</OriginalFileName>
          <Image condition="end with">mshta.exe</Image>
        </Rule>
        <ImageLoaded name="technique_id=T1137,technique_name=Office Application Startup" condition="end with">.wll</ImageLoaded>
        <ImageLoaded name="technique_id=T1137,technique_name=Office Application Startup" condition="end with">.xll</ImageLoaded>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
          <OriginalFileName name="technique_id=T1559.001,technique_name=Component Object Model" condition="is">combase.dll</OriginalFileName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
          <OriginalFileName name="technique_id=T1559.001,technique_name=Component Object Model" condition="is">coml2.dll</OriginalFileName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
          <OriginalFileName name="technique_id=T1559.001,technique_name=Component Object Model" condition="is">comsvcs.dll</OriginalFileName>
        </Rule>
        <Rule groupRelation="and" name="technique_id=T1055,technique_name=Process Injection">
          <Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
          <ImageLoaded condition="begin with">C:\Windows\assembly\</ImageLoaded>
        </Rule>
        <Rule groupRelation="and" name="technique_id=T1055,technique_name=Process Injection">
          <Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
          <ImageLoaded condition="begin with">C:\Windows\Microsoft.NET\assembly\GAC_MSIL</ImageLoaded>
        </Rule>
        <Rule groupRelation="and" name="technique_id=T1055,technique_name=Process Injection">
          <Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
          <OriginalFileName condition="is">clr.dll</OriginalFileName>
        </Rule>
        <Rule groupRelation="and" name="technique_id=T1059.005,technique_name=Command and Scripting Interpreter VBScript">
          <Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
          <OriginalFileName condition="is">VBE7INTL.DLL</OriginalFileName>
        </Rule>
        <Rule groupRelation="and" name="technique_id=T1059.005,technique_name=Command and Scripting Interpreter VBScript">
          <Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
          <OriginalFileName condition="is">VBE7.DLL</OriginalFileName>
        </Rule>
        <!-- Oppure ancora meglio, rileva solo VBEUI.DLL caricato da percorsi sospetti -->
        <Rule groupRelation="and" name="technique_id=T1059.005,technique_name=Suspicious VBA Load">
            <OriginalFileName condition="is">VBEUI.DLL</OriginalFileName>
            <ImageLoaded condition="excludes all">C:\Program Files\Microsoft Office\;Microsoft Shared\VBA\</ImageLoaded>
            <ImageLoaded condition="excludes all">C:\Program Files (x86)\Microsoft Office\;Microsoft Shared\VBA\</ImageLoaded>
            <ImageLoaded condition="excludes all">\vfs\ProgramFilesCommonX64\;Microsoft Shared\VBA\</ImageLoaded>
            <ImageLoaded condition="excludes all">\vfs\ProgramFilesCommonX86\;Microsoft Shared\VBA\</ImageLoaded>
            <ImageLoaded condition="excludes all">\Microsoft Office\root\;Microsoft Shared\VBA\</ImageLoaded>
        </Rule>
        <Rule groupRelation="and" name="technique_id=T1137.001,technique_name=Office Application Startup - Office Template Macros">
          <Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
          <OriginalFileName condition="is">OUTLVBA.DLL</OriginalFileName>
        </Rule>
        <Image name="technique_id=T1137,technique_name=Office Application Startup" condition="end with">VSTOInstaller.exe</Image>
        <Rule groupRelation="and">
          <Image name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
          <ImageLoaded condition="is">C:\Windows\SysWOW64\wbem\wbemdisp.dll</ImageLoaded>
        </Rule>
        <!-- PowerShell automation DLL - escludendo ServerManager -->
        <Rule groupRelation="and" name="technique_id=T1059.001,technique_name=PowerShell">
          <ImageLoaded condition="end with">system.management.automation.ni.dll</ImageLoaded>
          <Image condition="excludes">C:\Windows\System32\ServerManager.exe</Image>
        </Rule>
        <Rule groupRelation="and" name="technique_id=T1059.001,technique_name=PowerShell">
          <ImageLoaded condition="end with">system.management.automation.dll</ImageLoaded>
          <Image condition="excludes">C:\Windows\System32\ServerManager.exe</Image>
        </Rule>
        <ImageLoaded name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">Microsoft.PowerShell.Commands.Diagnostics.dll</ImageLoaded>
        <ImageLoaded name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">Microsoft.PowerShell.Commands.Management.dll</ImageLoaded>
        <ImageLoaded name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">Microsoft.PowerShell.Commands.Utility.dll</ImageLoaded>
        <ImageLoaded name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">Microsoft.PowerShell.ConsoleHost.dll</ImageLoaded>
        <ImageLoaded name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">Microsoft.PowerShell.Security.dll</ImageLoaded>
        <ImageLoaded name="technique_id=T1210,technique_name=Exploitation of Remote Services" condition="begin with">C:\Windows\System32\spool\drivers\</ImageLoaded>
        <OriginalFileName name="technique_id=T1112,technique_name=Modify Registry" condition="is">regsvc.dll</OriginalFileName>
        <Rule groupRelation="and">
          <Image condition="end with">rundll32.exe</Image>
          <OriginalFileName name="technique_id=T1003.004,technique_name=LSASS Memory" condition="is">comsvcs.dll</OriginalFileName>
        </Rule>
        <OriginalFileName name="technique_id=T1053,technique_name=Scheduled Task" condition="is">taskschd.dll</OriginalFileName>
        <ImageLoaded name="technique_id=T1218.010,technique_name=Regsvr32" condition="end with">scrobj.dll</ImageLoaded>
        <OriginalFileName name="technique_id=T1218.010,technique_name=Regsvr32" condition="is">scrobj.dll</OriginalFileName>
        <ImageLoaded name="technique_id=T1574.002,technique_name=DLL Side-Loading" condition="contains any">admin$;c$;\\;\appdata\;\temp\</ImageLoaded>
        <ImageLoaded condition="begin with" name="technique_id=T1574.002,technique_name=DLL Side-Loading">c:\programdata\</ImageLoaded>
        <ImageLoaded condition="begin with" name="technique_id=T1574.002,technique_name=DLL Side-Loading">C:\Windows\Media\</ImageLoaded>
        <ImageLoaded condition="begin with" name="technique_id=T1574.002,technique_name=DLL Side-Loading">C:\Windows\addins\</ImageLoaded>
        <ImageLoaded condition="begin with" name="technique_id=T1574.002,technique_name=DLL Side-Loading">C:\Windows\system32\config\systemprofile\</ImageLoaded>
        <ImageLoaded condition="begin with" name="technique_id=T1574.002,technique_name=DLL Side-Loading">C:\Windows\Debug\</ImageLoaded>
        <ImageLoaded condition="begin with" name="technique_id=T1574.002,technique_name=DLL Side-Loading">C:\Windows\Temp</ImageLoaded>
        <ImageLoaded condition="begin with" name="technique_id=T1574.002,technique_name=DLL Side-Loading">C:\PerfLogs\</ImageLoaded>
        <ImageLoaded condition="begin with" name="technique_id=T1574.002,technique_name=DLL Side-Loading">C:\Windows\Help\</ImageLoaded>
        <ImageLoaded condition="begin with" name="technique_id=T1574.002,technique_name=DLL Side-Loading">C:\Intel\Logs\</ImageLoaded>
        <ImageLoaded condition="begin with" name="technique_id=T1574.002,technique_name=DLL Side-Loading">C:\Temp</ImageLoaded>
        <ImageLoaded condition="begin with" name="technique_id=T1574.002,technique_name=DLL Side-Loading">C:\Windows\repair\</ImageLoaded>
        <ImageLoaded condition="begin with" name="technique_id=T1574.002,technique_name=DLL Side-Loading">C:\Windows\security\</ImageLoaded>
        <ImageLoaded condition="begin with" name="technique_id=T1574.002,technique_name=DLL Side-Loading">C:\Windows\Fonts\</ImageLoaded>
        <ImageLoaded condition="contains" name="technique_id=T1574.002,technique_name=DLL Side-Loading">Downloads</ImageLoaded>
        <ImageLoaded condition="contains" name="technique_id=T1574.002,technique_name=DLL Side-Loading">Public</ImageLoaded>
        <ImageLoaded condition="contains" name="technique_id=T1574.002,technique_name=DLL Side-Loading">Documents</ImageLoaded>
        <ImageLoaded condition="contains" name="technique_id=T1574.002,technique_name=DLL Side-Loading">Music</ImageLoaded>
        <ImageLoaded condition="contains" name="technique_id=T1574.002,technique_name=DLL Side-Loading">Video</ImageLoaded>
        <ImageLoaded condition="begin with" name="technique_id=T1574.002,technique_name=DLL Side-Loading">file:</ImageLoaded>
        <ImageLoaded name="technique_id=T1574.002,technique_name=DLL Side-Loading" condition="contains">$Recycle.bin\</ImageLoaded>
        <ImageLoaded name="technique_id=T1574.002,technique_name=DLL Side-Loading" condition="contains">\Windows\IME\</ImageLoaded>
        <Rule groupRelation="and">
          <OriginalFileName condition="is">urlmon.dll</OriginalFileName>
        </Rule>
        <ImageLoaded name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="end with">wmiutils.dll</ImageLoaded>
      </ImageLoad>
    </RuleGroup>
    <!-- Event ID 7 == Image Loaded - Excludes -->
    <RuleGroup groupRelation="or">
      <ImageLoad onmatch="exclude">
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\System32\cscript.exe</Image>
          <OriginalFileName condition="is">scrobj.dll</OriginalFileName>
        </Rule>
    <!-- Office che carica VBA legittimo di Microsoft - VERSIONE CORRETTA -->
        <Rule groupRelation="and">
            <Image condition="contains">\Office16\</Image>
            <ImageLoaded condition="contains all">
                \Microsoft Shared\VBA\;
                VBEUI.DLL
            </ImageLoaded>
            <Signed condition="is">true</Signed>
            <SignatureStatus condition="is">Valid</SignatureStatus>
        </Rule>
        <!-- Alternativa più specifica per essere sicuri -->
        <Rule groupRelation="and">
            <Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image>
            <OriginalFileName condition="is">VBEUI.DLL</OriginalFileName>
            <Company condition="is">Microsoft Corporation</Company>
            <SignatureStatus condition="is">Valid</SignatureStatus>
        </Rule>
    <!-- NinjaRMM legitimate PowerShell usage for patching operations -->
        <Rule groupRelation="and">
            <Image condition="contains">\NinjaRMMAgent\</Image>
            <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
            <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
    <!-- NinjaRMM wa_3rd_party_host_32.exe specifico per app-patching-ops -->
        <Rule groupRelation="and">
            <Image condition="contains all">\NinjaRMMAgent\;app-patching-ops</Image>
            <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
        </Rule>
    <!-- NinjaRMM - Esclusione totale per qualsiasi DLL caricata -->
        <Image condition="contains">\NinjaRMMAgent\</Image>
    <!-- TeamViewer - Esclusione totale per qualsiasi DLL caricata (software principale di gestione remota) -->
        <Image condition="contains">\TeamViewer\</Image>
    <!-- Veeam - Esclusione totale per qualsiasi DLL caricata (software critico di backup) -->
        <Image condition="contains">\Veeam\</Image>
    <!-- ESET products legitimate PowerShell usage -->
        <Rule groupRelation="and">
            <Image condition="begin with">C:\Program Files\ESET\</Image>
            <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
            <Signed condition="is">true</Signed>
        </Rule>
    <!-- ESET Security PowerShell usage - versione completa per 32/64 bit -->
        <Rule groupRelation="and">
            <Image condition="begin with">C:\Program Files\ESET\</Image>
            <Image condition="contains">wa_3rd_party_host</Image>
            <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
            <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- ESET Security VAPM PowerShell usage - anche per utenti normali -->
        <Rule groupRelation="and">
            <Image condition="begin with">C:\Program Files\ESET\</Image>
            <Image condition="contains">wa_3rd_party_host</Image>
            <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
        </Rule>
        <!-- ESET Security VAPM wa_3rd_party_host_64.exe specifico -->
        <Rule groupRelation="and">
            <Image condition="contains">\ESET\ESET Security\VAPM\wa_3rd_party_host_64.exe</Image>
            <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
            <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- NinjaRMM - Esclusione ampia per tutti i componenti che caricano PowerShell -->
        <Rule groupRelation="and">
            <Image condition="contains">\NinjaRMMAgent\</Image>
            <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
            <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- NinjaRMM wa_3rd_party_host specifico per app-patching-ops -->
        <Rule groupRelation="and">
            <Image condition="contains all">\NinjaRMMAgent\;wa_3rd_party_host</Image>
            <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
            <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- NinjaOne/NinjaRMM wa_3rd_party_host_32.exe in ProgramData path -->
        <Rule groupRelation="and">
            <Image condition="is">C:\ProgramData\NinjaRMMAgent\components\app-patching-ops\content\lib\wa_3rd_party_host_32.exe</Image>
            <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
            <Signed condition="is">true</Signed>
            <SignatureStatus condition="is">Valid</SignatureStatus>
            <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
        </Rule>
        <!-- Veeam VSS Support per SharePoint che carica PowerShell per operazioni di backup -->
        <Rule groupRelation="and">
            <Image condition="contains">\VeeamVssSupport\Veeam.VSS.Sharepoint2019.exe</Image>
            <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
            <User condition="contains">Administrator</User>
        </Rule>
        <!-- SharePoint Timer Service (OWSTIMER.EXE) che carica PowerShell per operazioni legittime -->
        <Rule groupRelation="and">
            <Image condition="contains">\Web Server Extensions\16\BIN\OWSTIMER.EXE</Image>
            <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
            <User condition="contains">svc_spfarm</User>
        </Rule>
        <!-- SharePoint Search Service (noderunner.exe) che carica PowerShell per operazioni legittime -->
        <Rule groupRelation="and">
            <Image condition="contains">\Microsoft Office Servers\16.0\Search\Runtime\1.0\noderunner.exe</Image>
            <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
            <User condition="contains">svc_spfarm</User>
        </Rule>
        <!-- SharePoint Workspace Daemon (mssdmn.exe) che carica PowerShell per operazioni legittime -->
        <Rule groupRelation="and">
            <Image condition="contains">\Microsoft Office Servers\16.0\Bin\mssdmn.exe</Image>
            <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
            <User condition="contains">svc_spfarm</User>
        </Rule>
      <!-- MMC (Microsoft Management Console) che carica PowerShell per operazioni amministrative legittime -->
      <Rule groupRelation="and">
        <Image condition="is">C:\Windows\System32\mmc.exe</Image>
        <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
        <User condition="contains">Administrator</User>
      </Rule>
      <!-- SQL Server PowerShell (SQLPS.exe) che carica PowerShell per operazioni SQL legittime -->
      <Rule groupRelation="and">
        <Image condition="contains">Microsoft SQL Server</Image>
        <Image condition="end with">\SQLPS.exe</Image>
        <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
        <User condition="contains any">SQLSERVERAGENT;SQLAgent$</User>
      </Rule>
      <!-- SQLPS.exe carica System.Management.Automation - esclusione generica per tutte le utenze -->
      <Rule groupRelation="and">
        <Image condition="contains">Microsoft SQL Server</Image>
        <Image condition="end with">\SQLPS.exe</Image>
        <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
      </Rule>
      <!-- SQL Server 2022 (160) SQLPS.exe con utente svc_spp -->
      <Rule groupRelation="and">
        <Image condition="contains">Microsoft SQL Server\160\Tools\Binn\SQLPS.exe</Image>
        <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
        <User condition="contains">svc_spp</User>
      </Rule>
        <Rule groupRelation="and">
          <Image condition="is">powershell.exe</Image>
          <OriginalFileName condition="excludes">mscoree.dll</OriginalFileName>
          <OriginalFileName condition="excludes">mscoreei.dll</OriginalFileName>
          <OriginalFileName condition="excludes">mscoreeis.dll</OriginalFileName>
          <OriginalFileName condition="excludes">clr.dll</OriginalFileName>
          <OriginalFileName condition="excludes">clrjit.dll</OriginalFileName>
        </Rule>
    <!-- Esclusione: mscorsvw.exe carica DLL durante ottimizzazione .NET -->
        <!-- Include System.Management.Automation per PowerShell pre-compilato -->
        <Rule groupRelation="and">
          <Image condition="end with">mscorsvw.exe</Image>
          <ImageLoaded condition="contains">\assembly\NativeImages_</ImageLoaded>
        </Rule>
        <!-- mscorsvw.exe carica System.Management.Automation dalla GAC durante ottimizzazione .NET -->
        <Rule groupRelation="and">
          <Image condition="end with">mscorsvw.exe</Image>
          <ImageLoaded condition="contains all">\assembly\GAC_MSIL\System.Management.Automation\</ImageLoaded>
        </Rule>
        <Rule groupRelation="and">
          <Image name="technique_id=T1137,technique_name=Office Application Startup" condition="end with">VSTOInstaller.exe</Image>
          <ImageLoaded condition="begin with">C:\Windows\</ImageLoaded>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
          <ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\FileSyncTelemetryExtensions.dll</ImageLoaded>
        </Rule>
    <!-- PowerShell 7 che carica la sua libreria di automazione -->
    <Rule groupRelation="and">
    <Image condition="is">C:\Program Files\PowerShell\7\pwsh.exe</Image>
    <ImageLoaded condition="contains">PowerShell\7\System.Management.Automation.dll</ImageLoaded>
    <Signed condition="is">true</Signed>
    </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
          <ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\FileCoAuthLib.dll</ImageLoaded>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
          <ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\OneDriveTelemetryStable.dll</ImageLoaded>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
          <ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\vcruntime140.dll</ImageLoaded>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
          <ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\UpdateRingSettings.dll</ImageLoaded>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
          <ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\LoggingPlatform.dll</ImageLoaded>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all"> C:\Users\;\AppData\Local\Microsoft\OneDrive;\FileCoAuth.exe</Image>
          <ImageLoaded condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\FileCoAuth.exe</ImageLoaded>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\System32\svchost.exe</Image>
          <ImageLoaded condition="is">C:\Windows\System32\netapi32.dll</ImageLoaded>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\System32\svchost.exe</Image>
          <ImageLoaded condition="is">C:\Windows\System32\msvcp110_win.dll</ImageLoaded>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\System32\svchost.exe</Image>
          <ImageLoaded condition="is">C:\Windows\System32\dsreg.dll</ImageLoaded>
        </Rule>
    <!-- PowerShell Remoting da amministratori -->
    <Rule groupRelation="and">
    <Image condition="is">C:\WINDOWS\System32\wsmprovhost.exe</Image>
    <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
    <User condition="contains any">
    \Kappa;
    \Administrator;
    \svc_dc;
    BUONVICINI_TI1\
    </User>
    </Rule>
    <!-- Office che carica VBA legittimo di Microsoft -->
    <Rule groupRelation="and">
    <Image condition="contains">\Office16\</Image>
    <ImageLoaded condition="contains all">
    \Microsoft Shared\VBA\;
    VBEUI.DLL
    </ImageLoaded>
    <Signed condition="is">true</Signed>
    </Rule>
    <!-- Office Click-to-Run che carica VBA legittimo tramite VFS -->
    <Rule groupRelation="and">
    <Image condition="contains">\Microsoft Office\root\Office16\</Image>
    <ImageLoaded condition="contains all">
    \vfs\ProgramFilesCommonX64\Microsoft Shared\VBA\;
    VBEUI.DLL
    </ImageLoaded>
    <Signed condition="is">true</Signed>
    </Rule>
    <!-- IIS worker process che carica PowerShell per Exchange Management -->
    <Rule groupRelation="and">
    <Image condition="is">C:\Windows\System32\inetsrv\w3wp.exe</Image>
    <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
    <Signed condition="is">false</Signed>
    </Rule>
    <!-- Exchange Store Worker che carica PowerShell per operazioni legittime -->
    <Rule groupRelation="and">
    <Image condition="contains">\Exchange Server\V15\Bin\Microsoft.Exchange.Store.Worker.exe</Image>
    <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Exchange ComplianceAuditService che carica PowerShell per controlli di conformità -->
    <Rule groupRelation="and">
      <Image condition="contains">\Exchange Server\V15\Bin\ComplianceAuditService.exe</Image>
      <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- WinRM host che carica PowerShell per remoting legittimo -->
    <Rule groupRelation="and">
    <Image condition="is">C:\Windows\System32\wsmprovhost.exe</Image>
    <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
    <Signed condition="is">false</Signed>
    </Rule>
    <!-- Windows Server Manager che carica PowerShell per gestione server -->
    <Rule groupRelation="and">
    <Image condition="is">C:\Windows\System32\ServerManager.exe</Image>
    <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
    </Rule>
    <!-- Windows Server Manager che carica PowerShell NativeImages precompilato -->
    <Rule groupRelation="and">
    <Image condition="is">C:\Windows\System32\ServerManager.exe</Image>
    <ImageLoaded condition="contains all">\\assembly\\NativeImages;System.Management.Automation.ni.dll</ImageLoaded>
    </Rule>
    <!-- Veritas Backup Exec RAWS wrapper che carica PowerShell per operazioni di backup -->
    <Rule groupRelation="and">
    <Image condition="contains">\Veritas\Backup Exec\RAWS\spswrapperv7.exe</Image>
    <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
    <User condition="contains">\svc_dc</User>
    </Rule>
    <!-- Veritas Backup Exec monad.exe che carica PowerShell per operazioni di backup -->
    <Rule groupRelation="and">
    <Image condition="contains">\Veritas\Backup Exec\RAWS\monad.exe</Image>
    <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
    <User condition="contains">\svc_dc</User>
    </Rule>
    <!-- HP Sure Click che carica PowerShell per operazioni di sicurezza -->
    <Rule groupRelation="and">
    <Image condition="contains">\HP\Sure Click\servers\BrConsole.exe</Image>
    <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
    </Rule>
    <!-- Visual Studio 2019 ServiceHub che carica PowerShell per operazioni di sviluppo -->
    <Rule groupRelation="and">
    <Image condition="contains">\Microsoft Visual Studio\2019\Enterprise\Common7\ServiceHub\Hosts\ServiceHub.Host.CLR.x86\ServiceHub.VSDetouredHost.exe</Image>
    <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
    </Rule>
    <!-- Visual Studio 2019 ServiceHub.Host.CLR.x86 che carica PowerShell per operazioni di sviluppo -->
    <Rule groupRelation="and">
    <Image condition="contains">\Microsoft Visual Studio\2019\Enterprise\Common7\ServiceHub\Hosts\ServiceHub.Host.CLR.x86\ServiceHub.Host.CLR.x86.exe</Image>
    <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
    </Rule>
    <!-- NinjaRMM patching operations loading PowerShell automation -->
    <Rule groupRelation="and">
      <Image condition="contains">\NinjaRMMAgent\components\app-patching-ops\</Image>
      <Image condition="contains">wa_3rd_party_host</Image>
      <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    <!-- NinjaRMM - Any component loading PowerShell for automation -->
    <Rule groupRelation="and">
      <Image condition="contains">\NinjaRMMAgent\</Image>
      <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
    </Rule>
    
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\System32\svchost.exe</Image>
          <ImageLoaded condition="is">C:\Windows\System32\perfctrs.dll</ImageLoaded>
        </Rule>
      </ImageLoad>
    </RuleGroup>
    <!-- Event ID 8 == CreateRemoteThread - Excludes -->
    <RuleGroup groupRelation="or">
      <!--Default to log all and exclude a few common processes-->
      <CreateRemoteThread onmatch="exclude">
        <SourceImage condition="is">C:\Windows\System32\svchost.exe</SourceImage>
        <SourceImage condition="is">C:\Windows\System32\wininit.exe</SourceImage>
        <SourceImage condition="is">C:\Windows\System32\csrss.exe</SourceImage>
        <SourceImage condition="is">C:\Windows\System32\services.exe</SourceImage>
        <SourceImage condition="is">C:\Windows\System32\winlogon.exe</SourceImage>
        <SourceImage condition="is">C:\Windows\System32\audiodg.exe</SourceImage>
        <Rule groupRelation="and">
          <SourceImage condition="is">C:\Windows\System32\dwm.exe</SourceImage>
          <TargetImage condition="is">C:\Windows\System32\csrss.exe</TargetImage>
        </Rule>
        <TargetImage condition="end with">Google\Chrome\Application\chrome.exe</TargetImage>
        <SourceImage condition="is">C:\Windows\System32\wbem\WmiPrvSE.exe</SourceImage>
      </CreateRemoteThread>
    </RuleGroup>
    <!-- Event ID 9 == RawAccessRead - Includes -->
    <RuleGroup groupRelation="or">
      <RawAccessRead onmatch="include" />
    </RuleGroup>
    <!-- Event ID 10 == ProcessAccess - Includes -->
    <RuleGroup groupRelation="or">
      <ProcessAccess onmatch="include">
        <CallTrace name="technique_id=T1003,technique_name=Credential Dumping" condition="contains">dbghelp.dll</CallTrace>
        <CallTrace name="technique_id=T1003,technique_name=Credential Dumping" condition="contains">dbgcore.dll</CallTrace>
        <TargetImage condition="contains">Desktop</TargetImage>
        <Rule groupRelation="and">
          <TargetImage name="technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\csrss.exe</TargetImage>
          <GrantedAccess>0x1F1FFF</GrantedAccess>
        </Rule>
        <Rule groupRelation="and">
          <TargetImage name="technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\wininit.exe</TargetImage>
          <GrantedAccess>0x1F1FFF</GrantedAccess>
        </Rule>
        <Rule groupRelation="and">
          <TargetImage name="technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\winlogon.exe</TargetImage>
          <GrantedAccess>0x1F1FFF</GrantedAccess>
        </Rule>
        <Rule groupRelation="and">
          <TargetImage name="technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\services.exe</TargetImage>
          <GrantedAccess>0x1F1FFF</GrantedAccess>
        </Rule>
        <GrantedAccess name="technique_id=T1055.012,technique_name=Process Hollowing">0x21410</GrantedAccess>
        <Rule groupRelation="and">
          <TargetImage name="technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\lsass.exe</TargetImage>
          <GrantedAccess>0x1FFFFF</GrantedAccess>
        </Rule>
        <Rule groupRelation="and">
          <TargetImage name="technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\lsass.exe</TargetImage>
          <GrantedAccess>0x1F1FFF</GrantedAccess>
        </Rule>
        <Rule groupRelation="and">
          <TargetImage name="technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\lsass.exe</TargetImage>
          <GrantedAccess>0x1010</GrantedAccess>
        </Rule>
        <Rule groupRelation="and">
          <TargetImage name="technique_id=T1003,technique_name=Credential Dumping" condition="is">C:\Windows\system32\lsass.exe</TargetImage>
          <GrantedAccess>0x143A</GrantedAccess>
        </Rule>
        <Rule groupRelation="and">
          <TargetImage name="technique_id=T1003,technique_name=Credential Dumping" condition="contains">lsass.exe</TargetImage>
          <SourceImage name="technique_id=T1003,technique_name=Credential Dumping" condition="contains">wsmprovhost.exe</SourceImage>
        </Rule>
        <Rule groupRelation="and" name="technique_id=T1055,technique_name=Process Injection">
          <SourceImage condition="contains all">C:\Program Files;\Microsoft Office\Root\Office</SourceImage>
          <CallTrace condition="contains">\Microsoft Shared\VBA</CallTrace>
        </Rule>
        <Rule groupRelation="and">
          <CallTrace name="technique_id=T1055.001,technique_name=Dynamic-link Library Injection" condition="contains all">C:\Windows\SYSTEM32\ntdll.dll;C:\Windows\System32\KERNELBASE.dll;UNKNOWN</CallTrace>
          <GrantedAccess name="technique_id=T1055.001,technique_name=Dynamic-link Library Injection" condition="contains any">0x1F0FFF;0x1F1FFF;0x143A;0x1410;0x1010;0x1F2FFF;0x1F3FFF;0x1FFFFF;0x147A</GrantedAccess>
          <SourceImage condition="is not">C:\WINDOWS\system32\AutoModeDetect.exe</SourceImage>
        </Rule>
        <GrantedAccess name="technique_id=T1055.012,technique_name=Process Hollowing">0x0800</GrantedAccess>
        <GrantedAccess name="technique_id=T1003,technique_name=Credential Dumping">0x0810</GrantedAccess>
        <GrantedAccess name="technique_id=T1055,technique_name=Process Injection">0x0820</GrantedAccess>
        <GrantedAccess name="technique_id=T1055.012,technique_name=Process Hollowing">0x800</GrantedAccess>
        <GrantedAccess name="technique_id=T1003,technique_name=Credential Dumping">0x810</GrantedAccess>
        <GrantedAccess name="technique_id=T1055,technique_name=Process Injection">0x820</GrantedAccess>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\PerfLogs\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\$Recycle.bin\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Intel\Logs\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\Default\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\Public\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Users\NetworkService\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Fonts\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Debug\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Media\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\Help\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\addins\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\repair\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\security\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="begin with">C:\Windows\system32\config\systemprofile\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="contains">VolumeShadowCopy</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="contains">\htdocs\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="contains">\wwwroot\</SourceImage>
        <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="contains">\Temp\</SourceImage>
        <Rule groupRelation="and">
          <SourceImage name="technique_id=T1036,technique_name=Masquerading" condition="contains">\AppData\</SourceImage>
          <SourceImage condition="excludes">\AppData\Local\Microsoft\Teams\current\Teams.exe</SourceImage>
        </Rule>
        <Rule groupRelation="and">
          <CallTrace name="technique_id=T1059.001,technique_name=PowerShell" condition="contains">System.Management.Automation.ni.dll</CallTrace>
          <SourceImage condition="is not">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</SourceImage>
        </Rule>
        <Rule groupRelation="and">
          <CallTrace name="technique_id=T1055,technique_name=Process Injection" condition="excludes">C:\Windows\SYSTEM32\ntdll.dll</CallTrace>
          <CallTrace name="technique_id=T1055,technique_name=Process Injection" condition="excludes">C:\Windows\SYSTEM32\win32u.dll</CallTrace>
          <CallTrace name="technique_id=T1055,technique_name=Process Injection" condition="excludes">C:\Windows\SYSTEM32\wow64win.dll</CallTrace>
        </Rule>
      </ProcessAccess>
    </RuleGroup>
    <!-- Event ID 10 == ProcessAccess - Excludes -->
    <RuleGroup groupRelation="or">
      <ProcessAccess onmatch="exclude">
        <!-- NinjaRMM - Esclusione totale per tutti gli accessi ai processi -->
        <SourceImage condition="contains">\NinjaRMMAgent\</SourceImage>
        <!-- TeamViewer - Esclusione totale per tutti gli accessi ai processi (software principale di gestione remota) -->
        <SourceImage condition="contains">\TeamViewer\</SourceImage>
        <!-- Veeam - Esclusione totale per tutti gli accessi ai processi (software critico di backup) -->
        <SourceImage condition="contains">\Veeam\</SourceImage>
        <SourceImage condition="is">C:\Program Files\Adobe\Adobe Creative Cloud Experience\libs\node.exe</SourceImage>
        <SourceImage condition="contains all">C:\Program Files;\Common Files\Adobe\AdobeGCClient\AGMService.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\Acrobat.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\AcroCEF\AcroCEF.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files (x86)\Common Files\Adobe\ARM\1.0\AdobeARMHelper.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files\Adobe\Adobe Photoshop 2021\Photoshop.exe</SourceImage>
        <!-- Cisco Webex/Spark - Legitimate UI operations with Explorer -->
        <SourceImage condition="contains">\Cisco Spark\CiscoCollabHost.exe</SourceImage>
        <TargetImage condition="begin with">C:\Program Files\Autodesk\Autodesk Desktop App</TargetImage>
        <TargetImage condition="begin with">C:\Program Files (x86)\Autodesk\Autodesk Desktop App</TargetImage>
        <Rule groupRelation="and">
          <SourceImage condition="is">C:\Program Files\Microsoft Monitoring Agent\Agent\MonitoringHost.exe</SourceImage>
          <TargetImage condition="is">C:\Windows\system32\cscript.exe</TargetImage>
        </Rule>
    <!-- Windows Auto Mode Detection -->
        <!-- AutoModeDetect.exe accede legittimamente a Explorer per rilevazione modalità display -->
        <Rule groupRelation="and">
            <SourceImage condition="is">C:\WINDOWS\system32\AutoModeDetect.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="is">0x1410</GrantedAccess>
            <SourceUser condition="is">NT AUTHORITY\SYSTEM</SourceUser>
        </Rule>
        <!-- AutoModeDetect.exe accesso da utenti normali -->
        <Rule groupRelation="and">
            <SourceImage condition="is">C:\WINDOWS\system32\AutoModeDetect.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="is">0x1410</GrantedAccess>
        </Rule>
        <!-- Esclusione: Alienware Command Center -->
        <!-- AWCC monitora Explorer per l'interfaccia utente e le notifiche -->
        <Rule groupRelation="and">
          <SourceImage condition="contains">Alienware Command Center</SourceImage>
          <TargetImage condition="end with">Explorer.EXE</TargetImage>
          <GrantedAccess condition="is">0x1410</GrantedAccess>
        </Rule>
        <!-- Cisco Spark/Webex Teams accesso legittimo a Explorer - CORRETTO -->
        <Rule groupRelation="and">
            <SourceImage condition="contains">\CiscoSparkLauncher\CiscoCollabHost.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="is">0x1410</GrantedAccess>  <!-- VALORE CORRETTO -->
        </Rule>
        
        <!-- Cisco Spark/Webex da Programs folder - UI operations con Explorer -->
        <Rule groupRelation="and">
            <SourceImage condition="contains">\Programs\Cisco Spark\CiscoCollabHost.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="is">0x1401</GrantedAccess>
        </Rule>
        
        <!-- Cisco Spark/Webex - Regola generica per qualsiasi percorso CiscoCollabHost -->
        <Rule groupRelation="and">
            <SourceImage condition="contains">CiscoCollabHost.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="contains any">0x1401;0x1410</GrantedAccess>
        </Rule>
        <!-- Microsoft OneDrive accesso legittimo a Explorer -->
        <Rule groupRelation="and">
            <SourceImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;\OneDrive.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="contains any">0x1410;0x101411;0x1411;0x40</GrantedAccess>
        </Rule>
        <!-- Microsoft OneDrive FileSyncConfig.exe accesso legittimo a Explorer -->
        <Rule groupRelation="and">
            <SourceImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\;FileSyncConfig.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="is">0x40</GrantedAccess>
        </Rule>
        <!-- Cursor IDE accesso legittimo a Explorer -->
        <Rule groupRelation="and">
            <SourceImage condition="contains">\cursor\Cursor.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="is">0x1410</GrantedAccess>
        </Rule>
        <!-- Windows Error Reporting (WerFault) accesso legittimo per dump diagnostici -->
        <Rule groupRelation="and">
            <SourceImage condition="contains any">C:\WINDOWS\system32\WerFault.exe;C:\WINDOWS\SysWOW64\WerFault.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="contains any">0x1FFFFF;0x1F3FFF;0x1410</GrantedAccess>
        </Rule>
        <!-- Intel System Usage Report (SUR) - Servizio legittimo Intel - Regola ampia -->
        <Rule groupRelation="and">
            <SourceImage condition="contains">\Intel\SUR\</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
        </Rule>
        <!-- Tutti i servizi Intel che accedono a Explorer - Regola molto ampia -->
        <Rule groupRelation="and">
            <SourceImage condition="begin with">C:\Program Files\Intel\</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
        </Rule>
        <!-- Intel SUR specifico con qualsiasi GrantedAccess elevato -->
        <Rule groupRelation="and">
            <SourceImage condition="end with">\SurSvc.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="contains any">0x1F3FFF;0x1FFFFF;0x1410;0x1438</GrantedAccess>
        </Rule>
        <!-- HP Touchpoint Analytics Client - Software legittimo HP per telemetria e analytics -->
        <Rule groupRelation="and">
            <SourceImage condition="contains">\HP\HP Touchpoint Analytics Client\TouchpointAnalyticsClient.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="is">0x1F3FFF</GrantedAccess>
            <SourceUser condition="is">NT AUTHORITY\SYSTEM</SourceUser>
        </Rule>
        <!-- Squirrel Update Framework - Framework legittimo di aggiornamento usato da molte applicazioni -->
        <!-- Squirrel è usato da applicazioni come Teams, Discord, Slack, ecc. per gestire gli aggiornamenti -->
        <Rule groupRelation="and">
            <SourceImage condition="contains">\SquirrelTemp\Update.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="is">0x40</GrantedAccess>
        </Rule>
        <!-- Alternativa più generica per coprire diversi valori di GrantedAccess -->
        <Rule groupRelation="and">
            <SourceImage condition="contains">\CiscoSparkLauncher\CiscoCollabHost.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="contains any">0x1410;0x1401;0x1400;0x40</GrantedAccess>
        </Rule>
        <!-- Microsoft Teams accesso legittimo a Explorer -->
        <Rule groupRelation="and">
            <SourceImage condition="contains">MSTeams_</SourceImage>
            <SourceImage condition="end with">\ms-teams.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="is">0x1410</GrantedAccess>
        </Rule>
        <!-- Microsoft Teams - versione desktop classica -->
        <Rule groupRelation="and">
            <SourceImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\Teams\current\Teams.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="is">0x1410</GrantedAccess>
        </Rule>
        <!-- PowerShell accesso legittimo a Explorer per automazione e query processi -->
        <Rule groupRelation="and">
            <SourceImage condition="end with">\powershell.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="is">0x1410</GrantedAccess>
        </Rule>
        <!-- Discord accesso legittimo a Explorer per notifiche e system tray -->
        <Rule groupRelation="and">
            <SourceImage condition="contains">\Discord\app-</SourceImage>
            <SourceImage condition="end with">\Discord.exe</SourceImage>
            <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
            <GrantedAccess condition="contains any">0x40;0x1410</GrantedAccess>
        </Rule>
    <SourceImage condition="contains all">C:\WindowsAzure\GuestAgent_;CollectGuestLogs.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files\Microsoft Monitoring Agent\Agent\HealthService.exe</SourceImage>
        <SourceImage condition="is">C:\Windows\CarbonBlack\cb.exe</SourceImage>
        <Rule name="Exclude Chrome SW Reporter into Reporter" groupRelation="and">
          <SourceImage condition="contains">software_reporter_tool.exe</SourceImage>
          <TargetImage condition="contains">software_reporter_tool.exe</TargetImage>
          <GrantedAccess condition="is">0x1410</GrantedAccess>
        </Rule>
        <Rule name="Exclude Chrome SW Reporter into Chrome" groupRelation="and">
          <SourceImage condition="contains">software_reporter_tool.exe</SourceImage>
          <TargetImage condition="contains">chrome.exe</TargetImage>
          <GrantedAccess condition="is">0x1410</GrantedAccess>
        </Rule>
        <Rule name="Exclude Chrome SW Reporter Accessing Anything" groupRelation="and">
          <SourceImage condition="contains">software_reporter_tool.exe</SourceImage>
          <GrantedAccess condition="is">0x1410</GrantedAccess>
        </Rule>
        <SourceImage condition="contains all">C:\Program Files\Cisco\AMP\;sfc.exe</SourceImage>
        <SourceImage condition="contains all">C:\Users\;\AppData\Local\Citrix\ICA Client\receiver\Receiver.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files (x86)\Citrix\ICA Client\Receiver\Receiver.exe</SourceImage>
        <SourceImage condition="is">c:\Program Files\Couchbase\Server\bin\sigar_port.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files\Windows Defender Advanced Threat Protection\MsSense.exe</SourceImage>
        <SourceImage condition="contains all">C:\ProgramData\Microsoft\Windows Defender Advanced Threat Protection\DataCollection\;\OpenHandleCollector.exe</SourceImage>
        <SourceImage condition="contains all">C:\Program Files\Elastic\Agent\data\;\metricbeat.exe</SourceImage>
        <SourceImage condition="contains all">C:\Program Files;\FireEye\xagt\xagt.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files (x86)\Ivanti\Workspace Control\cpushld.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files (x86)\RES Software\Workspace Manager\cpushld.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files\Ivanti\Workspace Control\cpushld.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files\RES Software\Workspace Manager\cpushld.exe</SourceImage>
        <SourceImage condition="end with">wmiprvse.exe</SourceImage>
        <SourceImage condition="end with">GoogleUpdate.exe</SourceImage>
        <SourceImage condition="end with">LTSVC.exe</SourceImage>
        <SourceImage condition="end with">taskmgr.exe</SourceImage>
        <SourceImage condition="end with">VBoxService.exe</SourceImage>
        <SourceImage condition="end with">vmtoolsd.exe</SourceImage>
        <SourceImage condition="end with">\Citrix\System32\wfshell.exe</SourceImage>
        <SourceImage condition="is">C:\Windows\System32\lsm.exe</SourceImage>
        <SourceImage condition="end with">Microsoft.Identity.AadConnect.Health.AadSync.Host.exe</SourceImage>
        <SourceImage condition="begin with">C:\Program Files (x86)\Symantec\Symantec Endpoint Protection</SourceImage>
        <GrantedAccess>0x1000</GrantedAccess>
        <GrantedAccess>0x1400</GrantedAccess>
        <GrantedAccess>0x101400</GrantedAccess>
        <GrantedAccess>0x101000</GrantedAccess>
        <SourceImage condition="is">C:\Program Files\McAfee\Endpoint Security\Endpoint Security Platform\mfeesp.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files\McAfee\Agent\x86\macompatsvc.exe</SourceImage>
        <SourceImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\OneDrive\StandaloneUpdater\OneDriveSetup.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files\Microsoft Office\root\Office16\OUTLOOK.EXE</SourceImage>
        <SourceImage condition="is">C:\Program Files\PowerToys\modules\KeyboardManager\KeyboardManagerEngine\PowerToys.KeyboardManagerEngine.exe</SourceImage>
        <Rule groupRelation="and">
          <SourceImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\Teams\current\Teams.exe</SourceImage>
          <TargetImage condition="contains all">C:\Users\;\AppData\Local\Microsoft\Teams\current\Teams.exe</TargetImage>
        </Rule>
        <SourceImage condition="is">C:\Program Files\Microsoft Security Client\MsMpEng.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files\Windows Defender\MsMpEng.exe</SourceImage>
        <SourceImage condition="contains all">C:\ProgramData\Microsoft\Windows Defender\Platform\;\MsMpEng.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files (x86)\Mobatek\MobaXterm\MobaXterm.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files\Palo Alto Networks\Traps\cyserver.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files\Qualys\QualysAgent\QualysAgent.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files (x86)\Razer Chroma SDK\bin\RzSDKService.exe</SourceImage>
        <SourceImage condition="is">C:\WINDOWS\CCM\CcmExec.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files\Splunk\bin\splunkd.exe</SourceImage>
    <!-- NinjaRMM - principale fonte di rumore -->
    <SourceImage condition="contains">\NinjaRMMAgent.exe</SourceImage>
    <!-- Synology USB Client Service -->
    <SourceImage condition="contains">\Synology\Assistant\UsbClientService.exe</SourceImage>
    <!-- EIConnector (probabilmente Dell o altro vendor) -->
    <SourceImage condition="contains">\EIConnector.exe</SourceImage>
    <!-- Evernote -->
    <SourceImage condition="contains">\Evernote\Evernote.exe</SourceImage>
    <!-- Evernote updater che accede a Explorer.exe per aggiornamenti -->
    <Rule groupRelation="and">
        <SourceImage condition="contains">\evernote-client-updater\pending\</SourceImage>
        <SourceImage condition="end with">-setup.exe</SourceImage>
        <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
        <GrantedAccess condition="is">0x40</GrantedAccess>
    </Rule>
        <Rule groupRelation="and">
          <SourceImage condition="is">C:\Program Files\Microsoft VS Code\Code.exe</SourceImage>
          <TargetImage condition="is">C:\Program Files\Microsoft VS Code\Code.exe</TargetImage>
          <GrantedAccess condition="is">0x100000</GrantedAccess>
        </Rule>
        <Rule groupRelation="and">
          <SourceImage condition="is">C:\Program Files\Microsoft VS Code\Code.exe</SourceImage>
          <TargetImage condition="is">C:\Program Files\Microsoft VS Code\Code.exe</TargetImage>
          <GrantedAccess condition="is">0x1401</GrantedAccess>
        </Rule>
    <!-- PowerShell che accede a Explorer solo per admin autorizzati -->
    <Rule groupRelation="and">
      <SourceImage condition="contains">powershell.exe</SourceImage>
      <TargetImage condition="contains">Explorer.EXE</TargetImage>
      <GrantedAccess condition="is">0x1410</GrantedAccess>
      <SourceUser condition="contains any">
      \Kappa;
      \svc_dc;
      \Administrator;
      BUONVICINI_TI1\Administrator
      </SourceUser>
    </Rule>
    <!-- NinjaRMM Agent accesso legittimo a Explorer -->
    <Rule groupRelation="and">
    <SourceImage condition="contains">\NinjaRMMAgent.exe</SourceImage>
    <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
    <GrantedAccess condition="is">0x1410</GrantedAccess>
    </Rule>
    <!-- WebEx accesso legittimo a Explorer -->
    <Rule groupRelation="and">
    <SourceImage condition="contains">\WebEx\WebexHost.exe</SourceImage>
    <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
    <GrantedAccess condition="is">0x1410</GrantedAccess>
    </Rule>
    <!-- Telegram accesso a Explorer per notifiche/taskbar e DirectX -->
    <Rule groupRelation="and">
    <SourceImage condition="contains">\Telegram Desktop\Telegram.exe</SourceImage>
    <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
    <GrantedAccess condition="contains any">0x40;0x1410</GrantedAccess>
    </Rule>
    <!-- Telegram Updater accesso legittimo a Explorer durante aggiornamenti -->
    <Rule groupRelation="and">
    <SourceImage condition="contains">\Telegram Desktop\Updater.exe</SourceImage>
    <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
    <GrantedAccess condition="is">0x40</GrantedAccess>
    </Rule>
    <!-- ProtonDrive accesso a Explorer tramite DirectX/WPF per rendering grafico -->
    <Rule groupRelation="and">
    <SourceImage condition="contains">\Proton\Drive\ProtonDrive.exe</SourceImage>
    <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
    <GrantedAccess condition="is">0x1410</GrantedAccess>
    </Rule>
    <!-- TeamViewer accesso legittimo a Explorer -->
    <Rule groupRelation="and">
      <SourceImage condition="contains">\TeamViewer\TeamViewer.exe</SourceImage>
      <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
      <GrantedAccess condition="is">0x1410</GrantedAccess>
    </Rule>
    <!-- ClickShare accesso legittimo a Explorer per condivisione schermo -->
    <Rule groupRelation="and">
      <SourceImage condition="contains">\ClickShare\current\clickshare_native.exe</SourceImage>
      <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
      <GrantedAccess condition="is">0x1010</GrantedAccess>
    </Rule>
    <!-- Dell Update Service accesso a Explorer con privilegi elevati -->
    <Rule groupRelation="and">
      <SourceImage condition="contains">\Dell\UpdateService\ServiceShell.exe</SourceImage>
      <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
      <GrantedAccess condition="is">0x1f3fff</GrantedAccess>
    </Rule>
    <!-- Dell Display and Peripheral Manager accesso legittimo a Explorer -->
    <Rule groupRelation="and">
      <SourceImage condition="contains">\Dell\Dell Display and Peripheral Manager\Plugins\DDPM.Subagent.User\DDPM.Subagent.User.exe</SourceImage>
      <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
      <GrantedAccess condition="is">0x1410</GrantedAccess>
    </Rule>
    <!-- LG Device Manager accesso legittimo a Explorer.exe per gestione dispositivi -->
    <Rule groupRelation="and">
      <SourceImage condition="contains">\LG Software\LG Device Manager\DeviceManager.exe</SourceImage>
      <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
    </Rule>
    <!-- Wacom Tablet Service accesso a Explorer per gestione tavoletta grafica -->
    <Rule groupRelation="and">
      <SourceImage condition="contains">\WTabletServiceISD.exe</SourceImage>
      <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
      <GrantedAccess condition="is">0x1410</GrantedAccess>
    </Rule>
    <!-- Microsoft Edge Update accesso legittimo a Explorer per verifica stato e notifiche -->
    <Rule groupRelation="and">
      <SourceImage condition="contains">\Microsoft\EdgeUpdate\MicrosoftEdgeUpdate.exe</SourceImage>
      <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
      <GrantedAccess condition="is">0x1440</GrantedAccess>
    </Rule>
    <!-- Zero Install accesso a Explorer per integrazione con shell -->
    <Rule groupRelation="and">
      <SourceImage condition="contains">\Zero Install\0install.exe</SourceImage>
      <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
      <GrantedAccess condition="is">0x40</GrantedAccess>
    </Rule>
    <!-- DeepL.exe (0install) accesso legittimo a Explorer per integrazione shell/traduzione -->
    <Rule groupRelation="and">
      <SourceImage condition="contains all">0install.net\implementations\;DeepL.exe</SourceImage>
      <TargetImage condition="contains">Explorer.EXE</TargetImage>
      <GrantedAccess condition="is">0x1410</GrantedAccess>
    </Rule>
    <!-- HP Touchpoint Analytics Client accesso legittimo a Explorer per analisi sistema -->
    <Rule groupRelation="and">
      <SourceImage condition="contains">\HP\HP Touchpoint Analytics Client\TouchpointAnalyticsClient.exe</SourceImage>
      <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
      <GrantedAccess condition="is">0x1410</GrantedAccess>
      <SourceUser condition="is">NT AUTHORITY\SYSTEM</SourceUser>
    </Rule>
        <!-- Synology USB Client Service accesso a vari processi -->
    <Rule groupRelation="and">
    <SourceImage condition="contains">\Synology\Assistant\UsbClientService.exe</SourceImage>
    <GrantedAccess condition="is">0x1410</GrantedAccess>
    </Rule>
    <!-- Evernote accesso a wmic -->
    <Rule groupRelation="and">
    <SourceImage condition="contains">\Evernote\Evernote.exe</SourceImage>
    <TargetImage condition="is">C:\Windows\System32\Wbem\wmic.exe</TargetImage>
    </Rule>
    <!-- Alienware accesso a Windows Terminal -->
    <Rule groupRelation="and">
    <SourceImage condition="contains">\Alienware\Alienware Command Center\AWCC.Background.Server.exe</SourceImage>
    <TargetImage condition="contains">WindowsTerminal.exe</TargetImage>
    <GrantedAccess condition="is">0x1410</GrantedAccess>
    </Rule>
    <Rule groupRelation="and">
          <SourceImage condition="contains all">C:\Users\;\AppData\Local\Programs\Microsoft VS Code\Code.exe</SourceImage>
          <TargetImage condition="contains all">C:\Users\;\AppData\Local\Programs\Microsoft VS Code\Code.exe</TargetImage>
          <GrantedAccess condition="is">0x1401</GrantedAccess>
        </Rule>
    <!-- VS Code accesso a Explorer per integrazione shell/taskbar -->
    <Rule groupRelation="and">
      <SourceImage condition="contains all">C:\Users\;\AppData\Local\Programs\Microsoft VS Code\Code.exe</SourceImage>
      <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
      <GrantedAccess condition="contains any">0x40;0x1410</GrantedAccess>
    </Rule>
    <!-- Windsurf (VS Code fork) accesso a Explorer per integrazione shell/taskbar -->
    <Rule groupRelation="and">
      <SourceImage condition="contains all">C:\Users\;\AppData\Local\Programs\Windsurf\Windsurf.exe</SourceImage>
      <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
      <GrantedAccess condition="contains any">0x40;0x1410</GrantedAccess>
    </Rule>
    <!-- Cursor (VS Code fork) accesso a Explorer per integrazione shell/taskbar e process tree -->
    <Rule groupRelation="and">
      <SourceImage condition="contains">\AppData\Local\Programs\cursor\Cursor.exe</SourceImage>
      <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
      <GrantedAccess condition="contains any">0x40;0x1410</GrantedAccess>
    </Rule>
    <!-- MirusHR30 Java application accesso a Explorer per integrazione shell -->
    <Rule groupRelation="and">
      <SourceImage condition="contains">\MirusHR30\jre\bin\javaw.exe</SourceImage>
      <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
      <GrantedAccess condition="is">0x40</GrantedAccess>
    </Rule>
    <!-- Veeam Setup accesso a Explorer per integrazione shell durante installazione -->
    <Rule groupRelation="and">
      <SourceImage condition="contains all">Veeam\Setup\Temp\</SourceImage>
      <SourceImage condition="end with">.dat</SourceImage>
      <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
      <GrantedAccess condition="is">0x40</GrantedAccess>
    </Rule>
        <SourceImage condition="is">C:\Program Files (x86)\VMware\VMWare Player\vmware-authd.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files (x86)\VMware\VMware Workstation\vmware-authd.exe</SourceImage>
        <SourceImage condition="is">C:\Program Files\WinZip\FAHWindow64.exe</SourceImage>
        <!-- Microsoft PowerToys FancyZones - Window management utility needs Explorer access -->
        <Rule groupRelation="and">
            <SourceImage condition="contains">\PowerToys\PowerToys.FancyZones.exe</SourceImage>
            <TargetImage condition="end with">\Explorer.EXE</TargetImage>
            <GrantedAccess condition="is">0x1410</GrantedAccess>
        </Rule>
        <!-- PowerToys modules accessing Explorer for various features (case variations) -->
        <Rule groupRelation="and">
            <SourceImage condition="contains">\PowerToys\</SourceImage>
            <TargetImage condition="end with">\explorer.exe</TargetImage>
            <GrantedAccess condition="contains any">0x1410;0x40</GrantedAccess>
        </Rule>
        <!-- PowerToys accessing Explorer.EXE (uppercase) -->
        <Rule groupRelation="and">
            <SourceImage condition="contains">\PowerToys\</SourceImage>
            <TargetImage condition="end with">\Explorer.EXE</TargetImage>
            <GrantedAccess condition="contains any">0x1410;0x40</GrantedAccess>
        </Rule>
        
        <!-- ======== ESCLUSIONI AGGIUNTE PER PROCESS ACCESS ======== -->
        
        <!-- Windows Defender accesso ai processi per scanning -->
        <Rule groupRelation="and">
          <SourceImage condition="contains">MsMpEng.exe</SourceImage>
          <GrantedAccess condition="is any">0x1000;0x1400;0x101001</GrantedAccess>
        </Rule>
        
        <!-- Servizi Windows legittimi che accedono a svchost -->
        <Rule groupRelation="and">
          <SourceImage condition="is">C:\Windows\System32\svchost.exe</SourceImage>
          <TargetImage condition="is">C:\Windows\System32\svchost.exe</TargetImage>
          <GrantedAccess condition="is">0x100000</GrantedAccess>
        </Rule>
        
        <!-- Windows Error Reporting -->
        <Rule groupRelation="and">
          <SourceImage condition="is">C:\Windows\System32\WerFault.exe</SourceImage>
          <GrantedAccess condition="is any">0x1400;0x1410</GrantedAccess>
        </Rule>
        
        <!-- Visual Studio Code debugger -->
        <Rule groupRelation="and">
          <SourceImage condition="contains">\Microsoft VS Code\</SourceImage>
          <CallTrace condition="contains">node_modules</CallTrace>
        </Rule>
        
        <!-- Chrome browser processi interni -->
        <Rule groupRelation="and">
          <SourceImage condition="contains">\Google\Chrome\Application\chrome.exe</SourceImage>
          <TargetImage condition="contains">\Google\Chrome\Application\chrome.exe</TargetImage>
        </Rule>
        
        <!-- Edge browser processi interni -->
        <Rule groupRelation="and">
          <SourceImage condition="contains">msedge.exe</SourceImage>
          <TargetImage condition="contains">msedge.exe</TargetImage>
        </Rule>
        
        <!-- Microsoft Office interazioni tra processi -->
        <Rule groupRelation="and">
          <SourceImage condition="contains">\Microsoft Office\</SourceImage>
          <TargetImage condition="contains">\Microsoft Office\</TargetImage>
        </Rule>
        
        <!-- Wazuh agent monitoring -->
        <Rule groupRelation="and">
          <SourceImage condition="contains">\wazuh-agent\</SourceImage>
          <GrantedAccess condition="is any">0x1000;0x1400</GrantedAccess>
        </Rule>
        
        <!-- Windows SearchIndexer -->
        <Rule groupRelation="and">
          <SourceImage condition="is">C:\Windows\System32\SearchIndexer.exe</SourceImage>
          <GrantedAccess condition="is">0x100000</GrantedAccess>
        </Rule>
        
        <!-- Application Experience service -->
        <Rule groupRelation="and">
          <SourceImage condition="contains">CompatTelRunner.exe</SourceImage>
          <GrantedAccess condition="is any">0x1000;0x1400</GrantedAccess>
        </Rule>
        
        <!-- MSI Installers accessing Explorer with minimal permissions -->
        <Rule groupRelation="and">
          <SourceImage condition="contains any">\Temp\;msiexec.exe</SourceImage>
          <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
          <GrantedAccess condition="is">0x40</GrantedAccess>
        </Rule>
        
        <!-- Adobe PDF Reader installers and updaters -->
        <Rule groupRelation="and">
          <SourceImage condition="contains any">GA_PDFReader;AdobeARM.exe;AcroRd32.exe;Acrobat.exe</SourceImage>
          <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
          <GrantedAccess condition="is any">0x40;0x1000;0x1400</GrantedAccess>
        </Rule>
        
        <!-- Generic installers in Temp folder with minimal access -->
        <Rule groupRelation="and">
          <SourceImage condition="begin with">C:\Windows\Temp\</SourceImage>
          <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
          <GrantedAccess condition="is">0x40</GrantedAccess>
        </Rule>
        
        <!-- Java installers and updaters -->
        <Rule groupRelation="and">
          <SourceImage condition="contains any">jre-;jdk-;java-;JavaSetup</SourceImage>
          <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
          <GrantedAccess condition="is">0x40</GrantedAccess>
        </Rule>
        
        <!-- PowerShell ISE accessing Explorer - normal behavior -->
        <Rule groupRelation="and">
          <SourceImage condition="is">C:\Windows\system32\WindowsPowerShell\v1.0\PowerShell_ISE.exe</SourceImage>
          <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
          <GrantedAccess condition="is any">0x1410;0x1000;0x1400</GrantedAccess>
        </Rule>
        
        <!-- ======== FINE ESCLUSIONI PROCESS ACCESS ======== -->
        
      </ProcessAccess>
    </RuleGroup>
    <!-- Event ID 11 == FileCreate - Includes -->
    <RuleGroup groupRelation="or">
      <FileCreate onmatch="include">
        <TargetFilename name="technique_id=T1546.011,technique_name=Application Shimming" condition="contains">C:\Windows\AppPatch\Custom</TargetFilename>
        <TargetFilename condition="end with">.bat</TargetFilename>
        <TargetFilename condition="end with">.cmd</TargetFilename>
        <TargetFilename name="technique_id=T1059,technique_name=Command and Scripting Interpreter" condition="end with">.chm</TargetFilename>
        <TargetFilename condition="contains all">C:\Users\;\.azure\accesstokens.json</TargetFilename>
        <TargetFilename condition="contains all">C:\Users\;\.aws\credentials</TargetFilename>
        <TargetFilename condition="contains all">C:\Users\;\config\gcloud</TargetFilename>
        <TargetFilename condition="contains all">C:\Users\;\.alibabacloud\credentials</TargetFilename>
        <TargetFilename condition="contains all">C:\Users\;\.kube\config</TargetFilename>
        <TargetFilename condition="contains all">C:\Users\;\.ssh\</TargetFilename>
        <Rule groupRelation="and">
          <Image condition="end with">\WINWORD.EXE</Image>
          <TargetFilename condition="contains any">.cab;.inf</TargetFilename>
        </Rule>
        <TargetFilename condition="begin with">C:\Users\Default</TargetFilename>
        <TargetFilename condition="contains">Desktop</TargetFilename>
        <TargetFilename name="technique_id=T1218,technique_name=Office Signed Binary Proxy Execution" condition="contains">AppData\Local\Microsoft\CLR_v2.0\UsageLogs\</TargetFilename>
        <TargetFilename name="technique_id=T1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\cscript.exe.log</TargetFilename>
        <TargetFilename name="technique_id=T1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\wscript.exe.log</TargetFilename>
        <TargetFilename name="technique_id=T1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\wmic.exe.log</TargetFilename>
        <TargetFilename name="technique_id=T1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\mshta.exe.log</TargetFilename>
        <TargetFilename name="technique_id=T1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\svchost.exe.log</TargetFilename>
        <TargetFilename name="technique_id=T1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\regsvr32.exe.log</TargetFilename>
        <TargetFilename name="technique_id=T1218,technique_name=Office Signed Binary Proxy Execution" condition="end with">\UsageLogs\rundll32.exe.log</TargetFilename>
        <TargetFilename condition="contains">\Downloads\</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\System32\Drivers</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\SysWOW64\Drivers</TargetFilename>
        <Rule groupRelation="and">
          <TargetFilename condition="end with">.js</TargetFilename>
          <TargetFilename condition="contains">Appdata\Local\whatsapp\</TargetFilename>
          <Image condition="excludes">Appdata\Local\whatsapp\</Image>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="end with">.js</TargetFilename>
          <TargetFilename condition="contains">Appdata\Local\Microsoft\Teams\</TargetFilename>
          <Image condition="excludes">Appdata\Local\Microsoft\Teams\</Image>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="end with">.js</TargetFilename>
          <TargetFilename condition="contains">Appdata\Local\slack\</TargetFilename>
          <Image condition="excludes">Appdata\Local\slack\</Image>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="end with">.js</TargetFilename>
          <TargetFilename condition="contains">Appdata\Local\discord\</TargetFilename>
          <Image condition="excludes">Appdata\Local\discord\</Image>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="end with">.js</TargetFilename>
          <TargetFilename condition="contains">Appdata\Local\signal\</TargetFilename>
          <Image condition="excludes">Appdata\Local\signal\</Image>
        </Rule>
        <TargetFilename condition="end with">.exe</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\System32\GroupPolicy\Machine\Scripts</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\System32\GroupPolicy\User\Scripts</TargetFilename>
        <TargetFilename name="technique_id=T1218.005,technique_name=Mshta" condition="end with">.hta</TargetFilename>
        <TargetFilename condition="end with">.iso</TargetFilename>
        <TargetFilename condition="end with">.img</TargetFilename>
        <TargetFilename name="technique_id=T1059.007,technique_name=JavaScript" condition="end with">.js</TargetFilename>
        <TargetFilename name="technique_id=T1059.007,technique_name=JavaScript" condition="end with">.javascript</TargetFilename>
        <TargetFilename condition="end with">.kirbi</TargetFilename>
        <!-- File .LNK sospetti, escludendo Office Recent -->
        <Rule groupRelation="and">
            <TargetFilename name="technique_id=T1187,technique_name=Forced Authentication" condition="end with">.lnk</TargetFilename>
            <TargetFilename condition="excludes">\AppData\Roaming\Microsoft\Office\Recent\</TargetFilename>
            <TargetFilename condition="excludes">\Microsoft Office\Recent\</TargetFilename>
        </Rule>
        <!-- File .LNK maiuscoli sospetti, escludendo Office Recent -->
        <Rule groupRelation="and">
            <TargetFilename name="technique_id=T1187,technique_name=Forced Authentication" condition="end with">.LNK</TargetFilename>
            <TargetFilename condition="excludes">\AppData\Roaming\Microsoft\Office\Recent\</TargetFilename>
            <TargetFilename condition="excludes">\Microsoft Office\Recent\</TargetFilename>
        </Rule>
        <TargetFilename name="technique_id=T1187,technique_name=Forced Authentication" condition="end with">.scf</TargetFilename>
        <TargetFilename condition="end with">.application</TargetFilename>
        <TargetFilename condition="end with">.appref-ms</TargetFilename>
        <TargetFilename name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="end with">.*proj</TargetFilename>
        <TargetFilename name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="end with">.sln</TargetFilename>
        <TargetFilename condition="end with">.settingcontent-ms</TargetFilename>
        <TargetFilename condition="end with">.docm</TargetFilename>
        <TargetFilename condition="end with">.pptm</TargetFilename>
        <TargetFilename condition="end with">.xlsm</TargetFilename>
        <TargetFilename condition="end with">.xlm</TargetFilename>
        <TargetFilename condition="end with">.dotm</TargetFilename>
        <TargetFilename condition="end with">.xltm</TargetFilename>
        <TargetFilename condition="end with">.potm</TargetFilename>
        <TargetFilename condition="end with">.ppsm</TargetFilename>
        <TargetFilename condition="end with">.sldm</TargetFilename>
        <TargetFilename condition="end with">.xlam</TargetFilename>
        <TargetFilename condition="end with">.xla</TargetFilename>
        <TargetFilename condition="end with">.iqy</TargetFilename>
        <TargetFilename condition="end with">.slk</TargetFilename>
        <TargetFilename condition="contains">\Content.Outlook\</TargetFilename>
        <TargetFilename condition="contains">Roaming\Microsoft\Outlook\VbaProject.OTM</TargetFilename>
        <TargetFilename condition="end with">.rwz</TargetFilename>
        <TargetFilename condition="contains">Roaming\Microsoft\Outlook\Outlook.xml</TargetFilename>
        <TargetFilename condition="end with">.rft</TargetFilename>
        <TargetFilename condition="end with">.jsp</TargetFilename>
        <TargetFilename condition="end with">.jspx</TargetFilename>
        <TargetFilename condition="end with">.asp</TargetFilename>
        <TargetFilename condition="end with">.aspx</TargetFilename>
        <TargetFilename condition="end with">.php</TargetFilename>
        <TargetFilename condition="end with">.war</TargetFilename>
        <TargetFilename condition="end with">.ace</TargetFilename>
        <TargetFilename name="technique_id=T1059.001,technique_name=PowerShell" condition="begin with">C:\Windows\System32\WindowsPowerShell</TargetFilename>
        <TargetFilename name="technique_id=T1059.001,technique_name=PowerShell" condition="begin with">C:\Windows\SysWOW64\WindowsPowerShell</TargetFilename>
        <TargetFilename name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">.ps1</TargetFilename>
        <TargetFilename name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">.ps2</TargetFilename>
        <TargetFilename condition="end with">.py</TargetFilename>
        <TargetFilename condition="end with">.pyc</TargetFilename>
        <TargetFilename condition="end with">.pyw</TargetFilename>
        <TargetFilename condition="end with">.rdp</TargetFilename>
        <Image condition="contains">rundll32.exe</Image>
        <TargetFilename condition="begin with">C:\Windows\System32\Tasks</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\Tasks\</TargetFilename>
        <TargetFilename condition="contains">\Start Menu</TargetFilename>
        <TargetFilename condition="contains">\Startup</TargetFilename>
        <TargetFilename name="technique_id=T1574.010,technique_name=Services File Permissions Weakness" condition="begin with">C:\Windows\SysWoW64</TargetFilename>
        <TargetFilename name="technique_id=T1574.010,technique_name=Services File Permissions Weakness" condition="begin with">C:\Windows\System32</TargetFilename>
        <TargetFilename name="technique_id=T1574.010,technique_name=Services File Permissions Weakness" condition="begin with">C:\Windows\</TargetFilename>
        <TargetFilename condition="end with">.sys</TargetFilename>
        <Rule name="technique_id=T1003.001,technique_name=OS Credential Dumping: LSASS Memory" groupRelation="and">
          <TargetFilename condition="contains">lsass</TargetFilename>
          <TargetFilename condition="contains any">dmp;DMP</TargetFilename>
          <Image condition="contains">taskmgr.exe</Image>
        </Rule>
        <TargetFilename condition="end with">.url</TargetFilename>
        <TargetFilename condition="end with">.vb</TargetFilename>
        <TargetFilename condition="end with">.vbe</TargetFilename>
        <TargetFilename condition="end with">.vbs</TargetFilename>
        <Rule groupRelation="and">
          <TargetFilename name="technique_id=T1562.001,technique_name=Disable or Modify tools" condition="begin with">C:\Windows\System32\CodeIntegrity\CIPolicies\Active\</TargetFilename>
          <TargetFilename name="technique_id=T1562.001,technique_name=Disable or Modify tools" condition="end with">.cip</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename name="technique_id=T1562.001,technique_name=Disable or Modify tools" condition="begin with">C:\Windows\System32\CodeIntegrity\</TargetFilename>
          <TargetFilename name="technique_id=T1562.001,technique_name=Disable or Modify tools" condition="end with">.p7b</TargetFilename>
        </Rule>
        <TargetFilename name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="begin with">C:\Windows\System32\Wbem</TargetFilename>
        <TargetFilename name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="begin with">C:\Windows\SysWOW64\Wbem</TargetFilename>
        <Image name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="begin with">C:\WINDOWS\system32\wbem\scrcons.exe</Image>
        <TargetFilename name="technique_id=T1546.008,technique_name=Services File Permissions Weakness" condition="begin with">C:\Windows\Temp\</TargetFilename>
        <TargetFilename name="technique_id=T1546.008,technique_name=Services File Permissions Weakness" condition="begin with">C:\Program\</TargetFilename>
        <TargetFilename name="technique_id=T1047,technique_name=File System Permissions Weakness" condition="begin with">C:\Temp\</TargetFilename>
        <TargetFilename name="technique_id=T1047,technique_name=File System Permissions Weakness" condition="begin with">C:\PerfLogs\</TargetFilename>
        <TargetFilename name="technique_id=T1047,technique_name=File System Permissions Weakness" condition="begin with">C:\Users\Public\</TargetFilename>
        <TargetFilename name="technique_id=T1047,technique_name=File System Permissions Weakness" condition="contains">\AppData\Temp\</TargetFilename>
        
        <!-- PrintNightmare Detection - DLL drops in spool GUID directories -->
        <Rule name="PrintNightmare_GUID_DLL" groupRelation="and">
          <TargetFilename condition="contains">C:\Windows\System32\spool\</TargetFilename>
          <TargetFilename condition="contains">{</TargetFilename>
          <TargetFilename condition="end with">.dll</TargetFilename>
        </Rule>
        
        <!-- PrintNightmare Detection - EXE drops in spool GUID directories -->
        <Rule name="PrintNightmare_GUID_EXE" groupRelation="and">
          <TargetFilename condition="contains">C:\Windows\System32\spool\</TargetFilename>
          <TargetFilename condition="contains">{</TargetFilename>
          <TargetFilename condition="end with">.exe</TargetFilename>
        </Rule>
        
        <!-- PrintNightmare - Specific FP pattern files matching your alerts -->
        <Rule name="PrintNightmare_FP_Pattern" groupRelation="and">
          <TargetFilename condition="contains">C:\Windows\System32\spool\</TargetFilename>
          <TargetFilename condition="contains any">fp2pdf;fpp8-pdf;fppdata;fppdes;fppdis;fppgraf</TargetFilename>
        </Rule>
        
        <!-- Suspicious DLLs in numbered spool driver directories with GUIDs -->
        <Rule name="PrintNightmare_Numbered_Spool_DLL" groupRelation="and">
          <TargetFilename condition="contains all">C:\Windows\System32\spool\drivers\;3\</TargetFilename>
          <TargetFilename condition="contains">{</TargetFilename>
          <TargetFilename condition="end with">.dll</TargetFilename>
        </Rule>
        
        <!-- Suspicious EXEs in numbered spool driver directories with GUIDs -->
        <Rule name="PrintNightmare_Numbered_Spool_EXE" groupRelation="and">
          <TargetFilename condition="contains all">C:\Windows\System32\spool\drivers\;3\</TargetFilename>
          <TargetFilename condition="contains">{</TargetFilename>
          <TargetFilename condition="end with">.exe</TargetFilename>
        </Rule>
        
        <!-- DLLs created directly in PRINTERS directory -->
        <Rule name="PrintNightmare_Printers_DLL" groupRelation="and">
          <TargetFilename condition="begin with">C:\Windows\System32\spool\PRINTERS\</TargetFilename>
          <TargetFilename condition="end with">.dll</TargetFilename>
        </Rule>
        
        <!-- EXEs created directly in PRINTERS directory -->
        <Rule name="PrintNightmare_Printers_EXE" groupRelation="and">
          <TargetFilename condition="begin with">C:\Windows\System32\spool\PRINTERS\</TargetFilename>
          <TargetFilename condition="end with">.exe</TargetFilename>
        </Rule>
      </FileCreate>
    </RuleGroup>
    <!-- Event ID 11 == FileCreate - Excludes -->
    <RuleGroup groupRelation="or">
      <FileCreate onmatch="exclude">
    <!-- wmiprvse.exe crea DismHost.exe in Temp durante operazioni DISM/servicing legittime -->
    <Rule groupRelation="and">
        <Image condition="end with">\wmiprvse.exe</Image>
        <TargetFilename condition="end with">DismHost.exe</TargetFilename>
        <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>

    <!-- Esclusione generica: qualsiasi processo wmiprvse.exe che crea DismHost.exe (qualsiasi percorso, qualsiasi utente) -->
    <Rule groupRelation="and">
        <Image condition="end with">wmiprvse.exe</Image>
        <TargetFilename condition="end with">DismHost.exe</TargetFilename>
    </Rule>
    
    <!-- Esclusione semplicissima: qualsiasi creazione di file DismHost.exe -->
    <TargetFilename condition="end with">DismHost.exe</TargetFilename>
    
    <!-- ===============================================
         WINDOWS UPDATE & SERVICING EXCLUSIONS
         Added: August 2025 by Paolo Caparrelli - GOLINE SA
         Purpose: Reduce false positives from legitimate Windows servicing operations
         Risk Assessment: Low - These are Microsoft-signed system processes
         =============================================== -->
    
    <!-- Windows servicing operations in WinREAgent - legitimate Windows update/recovery operations -->
    <Rule groupRelation="and">
        <Image condition="contains">\$WinREAgent\Scratch\</Image>
        <Image condition="end with">\dismhost.exe</Image>
        <TargetFilename condition="contains">\$WinREAgent\Scratch\</TargetFilename>
        <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- Windows servicing creating files in WinSxS during updates -->
    <Rule groupRelation="and">
        <Image condition="end with">\dismhost.exe</Image>
        <TargetFilename condition="contains">\WinSxS\Temp\InFlight\</TargetFilename>
        <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
      
    <!-- Red Gate SQL tools update downloads - legitimate SQL Server Management Studio extension updates -->
    <Rule groupRelation="and">
        <Image condition="contains">\Microsoft SQL Server Management Studio\</Image>
        <Image condition="end with">\Ssms.exe</Image>
        <TargetFilename condition="contains all">\Temp\Red Gate\CFU\;.exe</TargetFilename>
    </Rule>
    <!-- Red Gate SQL tools - any Red Gate software in temp -->
    <Rule groupRelation="and">
        <TargetFilename condition="contains all">\Temp\Red Gate\;.exe</TargetFilename>
    </Rule>
    <!-- Veritas QuickAssist che crea file temporanei durante operazioni di supporto -->
    <Rule groupRelation="and">
        <Image condition="contains">VeritasQuickAssist.exe</Image>
        <TargetFilename condition="contains all">\AppData\Local\Temp\.net\VeritasQuickAssist\;.exe</TargetFilename>
    </Rule>
    <!-- VQACollector (componente di Veritas QuickAssist) che crea strumenti temporanei -->
    <Rule groupRelation="and">
        <Image condition="contains">VQACollector.exe</Image>
        <TargetFilename condition="contains all">\AppData\Local\Temp\.net\;.exe</TargetFilename>
    </Rule>
    <!-- Duo Desktop installazione - software MFA legittimo che installa librerie crittografiche -->
    <Rule groupRelation="and">
        <Image condition="is">C:\WINDOWS\system32\msiexec.exe</Image>
        <TargetFilename condition="contains all">\Duo Desktop\;.dll</TargetFilename>
        <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- Duo Desktop - BouncyCastle cryptography library (legitimate) -->
    <Rule groupRelation="and">
        <Image condition="is">C:\WINDOWS\system32\msiexec.exe</Image>
        <TargetFilename condition="contains">BouncyCastle.Cryptography.dll</TargetFilename>
        <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- Cisco Secure Client vpndownloader - Download legittimo di aggiornamenti client VPN -->
    <Rule groupRelation="and">
        <Image condition="contains">\Cisco\Cisco Secure Client\vpndownloader.exe</Image>
        <TargetFilename condition="contains all">\Windows\Temp\;.msi</TargetFilename>
        <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- FinePrint PDF printer driver DLLs in spool directory -->
    <Rule groupRelation="and">
        <TargetFilename condition="contains">\windows\system32\spool\</TargetFilename>
        <TargetFilename condition="contains any">fp2pdf;fpp8-pdf2fp;fp8-pdf</TargetFilename>
        <TargetFilename condition="end with">.dll</TargetFilename>
        <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM;SYSTEM</User>
    </Rule>
    
    <!-- Windows Print Spooler - Driver di stampa legittimi Microsoft nella cartella New -->
    <Rule groupRelation="and">
        <Image condition="is">C:\Windows\System32\spoolsv.exe</Image>
        <TargetFilename condition="contains">\spool\drivers\</TargetFilename>
        <TargetFilename condition="contains">\3\New\</TargetFilename>
        <TargetFilename condition="contains any">MXDWDRV.DLL;PJLMON.DLL;PS5UI.DLL;PSCRIPT5.DLL;UNIDRV.DLL;UNIRES.DLL;UNIDRVUI.DLL;PrintConfig.dll;mxdwdrv.dll</TargetFilename>
        <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- Esclusione: PowerShell Policy Test Files -->
        <!-- Questi sono file temporanei creati da PowerShell per testare le execution policy -->
        <Rule groupRelation="or">
          <TargetFilename condition="contains">\__PSScriptPolicyTest_</TargetFilename>
        </Rule>
    <!-- Microsoft .NET installation - msiexec creating legitimate XML documentation files -->
    <Rule groupRelation="and">
        <Image condition="is">C:\WINDOWS\system32\msiexec.exe</Image>
        <TargetFilename condition="contains all">\dotnet\packs\;.xml</TargetFilename>
        <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    <!-- Exchange Server OAB (Offline Address Book) PowerShell temporanei -->
    <!-- Exchange crea script PS1 temporanei per gestire l'Offline Address Book -->
    <Rule groupRelation="and">
      <Image condition="contains">\Exchange Server\V15\Bin\MSExchangeMailboxAssistants.exe</Image>
      <TargetFilename condition="contains all">\Exchange Server\V15\ClientAccess\OAB\Temp\</TargetFilename>
      <TargetFilename condition="end with">.ps1</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Esclusione: Google Chrome Updates -->
        <!-- Chrome updater crea file temporanei durante gli aggiornamenti automatici -->
        <Rule groupRelation="or">
          <Image condition="contains">chrome_Unpacker_BeginUnzipping</Image>
          <TargetFilename condition="contains all">Google\Chrome\Temp;chrome.exe</TargetFilename>
          <TargetFilename condition="contains all">Google\Chrome\Temp;Chrome-bin</TargetFilename>
        </Rule>
    <!-- Microsoft Edge WebView2 unpacking Cognitive Services and other components -->
    <Rule groupRelation="and">
      <Image condition="contains">\Microsoft\EdgeWebView\Application\</Image>
      <Image condition="end with">msedgewebview2.exe</Image>
      <TargetFilename condition="contains all">\Temp\chrome_Unpacker_BeginUnzipping;.dll</TargetFilename>
    </Rule>
    <!-- Google Chrome installer - Esclusione DEFINITIVA e AMPIA -->
    <Rule groupRelation="and">
      <Image condition="contains all">\SystemTemp\Google;setup.exe</Image>
      <TargetFilename condition="contains">\Google\Chrome\</TargetFilename>
    </Rule>
    <!-- Google Chrome - Qualsiasi file creato nella cartella Chrome\Temp -->
    <TargetFilename condition="contains">\Google\Chrome\Temp\</TargetFilename>
    <!-- Google Chrome - Pattern specifico per chrome.exe in Temp -->
    <Rule groupRelation="and">
      <TargetFilename condition="contains all">\Google\Chrome\Temp\;chrome.exe</TargetFilename>
    </Rule>
    <!-- HP PhoneWise Device Maintenance - Software legittimo HP per gestione dispositivi -->
    <Rule groupRelation="and">
      <Image condition="contains">HPPhoneWiseDeviceMaintenance.exe</Image>
      <TargetFilename condition="contains">\HPPhoneWise\Temp\</TargetFilename>
    </Rule>
    <!-- HP Software in generale - File creati in SWSETUP (cartella standard HP per software/driver) -->
    <Rule groupRelation="and">
      <TargetFilename condition="contains all">C:\SWSETUP\;HP</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
    </Rule>
    <!-- Esclusione: Brave Browser Updates -->
        <!-- Brave updater crea file temporanei durante gli aggiornamenti automatici -->
        <Rule groupRelation="or">
          <Image condition="contains all">BraveSoftware\Update\Install;setup.exe</Image>
          <TargetFilename condition="contains all">BraveSoftware\Brave-Browser\Temp;.exe</TargetFilename>
        </Rule>
    <!-- Esclusione: .NET Runtime Optimization Service -->
        <!-- mscorsvw.exe pre-compila assembly .NET dopo aggiornamenti Windows -->
        <Rule groupRelation="and">
          <Image condition="end with">mscorsvw.exe</Image>
          <TargetFilename condition="contains">\assembly\NativeImages_</TargetFilename>
        </Rule>
    <!-- Esclusione: .NET Desktop Runtime Installation -->
        <!-- Microsoft .NET runtime installers creano file temporanei durante installazione/aggiornamento -->
        <Rule groupRelation="or">
          <TargetFilename condition="contains">windowsdesktop-runtime-</TargetFilename>
          <Image condition="contains">windowsdesktop-runtime-</Image>
          <TargetFilename condition="contains all">\Windows\Temp\;\.be\;windowsdesktop-runtime</TargetFilename>
          <TargetFilename condition="contains all">\Windows\Temp\;\.cr\;windowsdesktop-runtime</TargetFilename>
        </Rule>
    <!-- Microsoft Print Spooler - Driver legittimi -->
    <!-- spoolsv.exe crea DLL legittime per driver di stampa Microsoft -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\System32\spoolsv.exe</Image>
      <TargetFilename condition="contains">\spool\drivers\</TargetFilename>
      <TargetFilename condition="contains any">MXDWDRV.DLL;PS5UI.DLL;PSCRIPT5.DLL;UNIDRV.DLL;UNIDRVUI.DLL;mxdwdui.dll;PrintConfig.dll;MXDWDRV.dll;PS5UI.dll;PSCRIPT5.dll;UNIDRV.dll;UNIDRVUI.dll;PrintConfig.DLL;PCL5URES.DLL;PJLMON.DLL;UNIRES.DLL;FXSDRV.DLL;FXSUI.DLL;TTYRES.DLL;TTY.DLL;TTYUI.DLL</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- spoolsv.exe crea DLL in W32X86 - esclusione generica per driver 32-bit -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\System32\spoolsv.exe</Image>
      <TargetFilename condition="contains">\spool\drivers\W32X86\</TargetFilename>
      <TargetFilename condition="end with">.DLL</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- spoolsv.exe crea DLL in driver subdirectories - esclusione per strutture complesse -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\System32\spoolsv.exe</Image>
      <TargetFilename condition="contains">\spool\drivers\</TargetFilename>
      <TargetFilename condition="contains">\I386\</TargetFilename>
      <TargetFilename condition="end with">.DLL</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- spoolsv.exe crea DLL in x64 - esclusione generica per driver 64-bit -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\System32\spoolsv.exe</Image>
      <TargetFilename condition="contains">\spool\drivers\x64\</TargetFilename>
      <TargetFilename condition="end with">.DLL</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- HP Print Spooler - Driver HP legittimi -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\System32\spoolsv.exe</Image>
      <TargetFilename condition="contains all">\spool\drivers\;V4Connections\</TargetFilename>
      <TargetFilename condition="contains">HP.OneDriver</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- HP/PCL Print Spooler - Driver PCL (HP e altri) più ampia -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\System32\spoolsv.exe</Image>
      <TargetFilename condition="contains">\spool\drivers\</TargetFilename>
      <TargetFilename condition="contains any">PCL4RES.DLL;PCL5ERES.DLL;PCL5RES.DLL;PCL6RES.DLL;PCLXL.DLL</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Print Spooler V4Connections - Tutti i driver di stampa V4 legittimi -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\System32\spoolsv.exe</Image>
      <TargetFilename condition="contains all">\spool\drivers\x64\V4Connections\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Print Spooler V4Connections con GUID - Driver in sottocartelle con GUID -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\System32\spoolsv.exe</Image>
      <TargetFilename condition="contains">\spool\drivers\x64\V4Connections\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Microsoft Universal Print Driver - Driver universali nella cartella New temporanea -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\System32\spoolsv.exe</Image>
      <TargetFilename condition="contains">\spool\drivers\x64\3\New\</TargetFilename>
      <TargetFilename condition="contains any">PJLMON.DLL;UNIRES.DLL;UNIDRV.DLL;UNIDRVUI.DLL</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Konica Minolta Print Drivers - Driver KM legittimi nella cartella New -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\System32\spoolsv.exe</Image>
      <TargetFilename condition="contains">\spool\drivers\x64\3\New\</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\System32\spool\drivers\x64\3\New\KM</TargetFilename>
      <TargetFilename condition="end with">.DLL</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- HP Print Drivers - Driver HP legittimi nella cartella New -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\System32\spoolsv.exe</Image>
      <TargetFilename condition="contains">\spool\drivers\x64\3\New\</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\System32\spool\drivers\x64\3\New\HP</TargetFilename>
      <TargetFilename condition="end with">.DLL</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- PrinterDCA Service - File temporanei DLL legittimi -->
    <Rule groupRelation="and">
      <Image condition="is">C:\Program Files (x86)\Printer DCA\PrinterDCA.Service.exe</Image>
      <TargetFilename condition="contains">C:\Windows\Temp\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- ===== NINJAONE/NINJARMM PATCH MANAGEMENT - BROAD EXCLUSIONS ===== -->
    <!-- NinjaRMM is a legitimate patch management tool - exclude all patching activities -->
    
    <!-- NinjaRMM Patch Management - Any file created in Windows\Temp by patch installers -->
    <Rule groupRelation="and">
      <Image condition="contains">\NinjaRMMAgent\components\app-patching-ops\content\patches\</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- NinjaRMM Patch Management - Any file created in user temp folders by patch installers -->
    <Rule groupRelation="and">
      <Image condition="contains">\NinjaRMMAgent\components\app-patching-ops\content\patches\</Image>
      <TargetFilename condition="contains">\AppData\Local\Temp\</TargetFilename>
    </Rule>
    
    <!-- NinjaRMM Patch Management - Any file created in Program Files during software installation -->
    <Rule groupRelation="and">
      <Image condition="contains">\NinjaRMMAgent\components\app-patching-ops\content\patches\</Image>
      <TargetFilename condition="contains any">C:\Program Files\;C:\Program Files (x86)\</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- NinjaRMM Patch Management - Any file created in ProgramData during software installation -->
    <Rule groupRelation="and">
      <Image condition="contains">\NinjaRMMAgent\components\app-patching-ops\content\patches\</Image>
      <TargetFilename condition="contains">C:\ProgramData\</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- Microsoft Office Updates - Exclude files created in Office updates folder -->
    <Rule groupRelation="and">
      <TargetFilename condition="contains">\Microsoft Office\Updates\Download\PackageFiles\</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;Administrators;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- NinjaRMM Patch Management - Any installer creating files in Windows directory -->
    <Rule groupRelation="and">
      <Image condition="contains">\NinjaRMMAgent\components\app-patching-ops\content\patches\</Image>
      <TargetFilename condition="begin with">C:\Windows\</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- NinjaRMM Scripts and maintenance - Exclude PowerShell scripts in temp -->
    <Rule groupRelation="and">
      <Image condition="contains">\NinjaRMMAgent\</Image>
      <TargetFilename condition="end with">.ps1</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- NinjaRMM Scripts and maintenance - Exclude batch scripts in temp -->
    <Rule groupRelation="and">
      <Image condition="contains">\NinjaRMMAgent\</Image>
      <TargetFilename condition="contains any">.bat;.cmd</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    <!-- Microsoft Edge Update Setup - File temporanei EXE da installer utente -->
    <Rule groupRelation="and">
      <Image condition="contains all">\Microsoft\EdgeUpdate\Install\;MicrosoftEdgeUpdateSetup</Image>
      <TargetFilename condition="contains">\AppData\Local\Temp\</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
    </Rule>
    
            <!-- Office che crea LNK in tutte le cartelle Microsoft legittime -->
        <Rule groupRelation="and">
            <Image condition="contains any">\Office16\EXCEL.EXE;\Office16\WINWORD.EXE;\Office16\POWERPNT.EXE;\Office16\OUTLOOK.EXE;\Office16\MSACCESS.EXE;\Office16\MSPUB.EXE</Image>
            <TargetFilename condition="contains">\AppData\Roaming\Microsoft\</TargetFilename>
            <TargetFilename condition="end with">.lnk</TargetFilename>
        </Rule>
        <!-- Office che crea LNK maiuscoli in tutte le cartelle Microsoft legittime -->
        <Rule groupRelation="and">
            <Image condition="contains any">\Office16\EXCEL.EXE;\Office16\WINWORD.EXE;\Office16\POWERPNT.EXE;\Office16\OUTLOOK.EXE;\Office16\MSACCESS.EXE;\Office16\MSPUB.EXE</Image>
            <TargetFilename condition="contains">\AppData\Roaming\Microsoft\</TargetFilename>
            <TargetFilename condition="end with">.LNK</TargetFilename>
        </Rule>
        <!-- Specifico per Excel che crea LNK temporanei -->
        <Rule groupRelation="and">
            <Image condition="contains">\Office16\EXCEL.EXE</Image>
            <TargetFilename condition="contains">\AppData\Roaming\Microsoft\Excel\</TargetFilename>
            <TargetFilename condition="end with">.lnk</TargetFilename>
        </Rule>
    <!-- DYMO Label Printer software che crea file temporanei .NET -->
    <Rule groupRelation="and">
      <Image condition="contains">\DYMO\DYMO Connect\DYMO.WebApi.Win.Host.exe</Image>
      <TargetFilename condition="contains all">\AppData\Local\Temp\.net\;DYMO</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
    </Rule>
    <!-- DYMO Label Printer software - DLL libraries in temp -->
    <Rule groupRelation="and">
      <Image condition="contains">\DYMO\DYMO Connect\DYMO.WebApi.Win.Host.exe</Image>
      <TargetFilename condition="contains all">\AppData\Local\Temp\.net\DYMO;.dll</TargetFilename>
    </Rule>
    <!-- Telegram auto-update process - Enhanced to include Updater.exe and all update files -->
    <Rule groupRelation="and">
      <Image condition="contains">\Telegram Desktop\Telegram.exe</Image>
      <TargetFilename condition="contains">\Telegram Desktop\tupdates\temp\</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
    </Rule>
    <!-- Telegram Updater.exe creating files during update process -->
    <Rule groupRelation="and">
      <Image condition="contains">\Telegram Desktop\Updater.exe</Image>
      <TargetFilename condition="contains">\Telegram Desktop\</TargetFilename>
    </Rule>
    <!-- Microsoft Package Cache Bootstrapper -->
    <!-- Bootstrapper.exe crea file temporanei durante installazione di software Microsoft -->
    <Rule groupRelation="and">
      <Image condition="contains">\Package Cache\</Image>
      <Image condition="end with">Bootstrapper.exe</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="contains any">.ba\;mbahost.dll;.tmp;.exe;.dll</TargetFilename>
    </Rule>
    <!-- Regola più generica per qualsiasi Bootstrapper Microsoft -->
    <Rule groupRelation="and">
      <Image condition="end with">Bootstrapper.exe</Image>
      <TargetFilename condition="contains all">Windows\Temp;.ba\</TargetFilename>
    </Rule>
    <!-- Windows Installer rundll32 custom actions -->
    <!-- rundll32.exe crea DLL temporanee per custom actions durante installazioni -->
    <Rule groupRelation="and">
      <Image condition="contains">rundll32.exe</Image>
      <TargetFilename condition="contains">\Windows\Installer\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
    </Rule>
    <!-- rundll32 Self-Extracting archives - setup temporanei legittimi -->
    <Rule groupRelation="and">
      <Image condition="is">C:\Windows\System32\rundll32.exe</Image>
      <TargetFilename condition="contains all">\AppData\Local\Temp\SFX</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
    </Rule>
    <!-- rundll32 SFX con GUID lunghi - archivi auto-estraenti -->
    <Rule groupRelation="and">
      <Image condition="contains">rundll32.exe</Image>
      <TargetFilename condition="contains">\AppData\Local\Temp\SFXC</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
    </Rule>
    <!-- rundll32 setup installer generici in Temp -->
    <Rule groupRelation="and">
      <Image condition="is">C:\Windows\System32\rundll32.exe</Image>
      <TargetFilename condition="contains all">\AppData\Local\Temp\;Setup.</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
    </Rule>
    <!-- rundll32 crea collegamenti Work Resources (RADC) nel menu Start - applicazione aziendale -->
    <Rule groupRelation="and">
      <Image condition="end with">\rundll32.exe</Image>
      <TargetFilename condition="contains all">\Start Menu\Programs\Work Resources (RADC)\;.lnk</TargetFilename>
    </Rule>
    <!-- TechSmith Snagit updater usando Burn framework -->
    <Rule groupRelation="and">
      <Image condition="contains">\TechSmith\</Image>
      <Image condition="contains">Update.exe</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="contains">\.ba\</TargetFilename>
    </Rule>
    <!-- ===== NATIVE INSTRUMENTS ===== -->
        <Rule groupRelation="and">
            <Image condition="contains">\Native Instruments\</Image>
            <TargetFilename condition="contains">\Native Instruments\</TargetFilename>
            <TargetFilename condition="end with">.json</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
            <Image condition="contains">\Native Instruments\</Image>
            <TargetFilename condition="contains">\Native Instruments\</TargetFilename>
            <TargetFilename condition="end with">.xml</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
            <Image condition="contains">\Native Instruments\</Image>
            <TargetFilename condition="contains">\Native Instruments\</TargetFilename>
            <TargetFilename condition="end with">.ini</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
            <Image condition="contains">\Native Instruments\</Image>
            <TargetFilename condition="contains">\Native Instruments\</TargetFilename>
            <TargetFilename condition="end with">.cfg</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
            <Image condition="contains">\Native Instruments\</Image>
            <TargetFilename condition="contains">\Native Instruments\</TargetFilename>
            <TargetFilename condition="end with">.log</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
            <Image condition="contains">\Native Instruments\</Image>
            <TargetFilename condition="contains">\Native Instruments\</TargetFilename>
            <TargetFilename condition="end with">.txt</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
            <Image condition="contains">\Native Instruments\</Image>
            <TargetFilename condition="contains">\Native Instruments\</TargetFilename>
            <TargetFilename condition="end with">.db</TargetFilename>
        </Rule>
    
    
    <!-- ===== ESCLUSIONI PER WINDOWS UPDATE E RECOVERY ENVIRONMENT ===== -->
    <!-- Windows Update - .NET/ASP.NET Core Runtime installations -->
    <Rule groupRelation="and">
      <Image condition="contains">\SoftwareDistribution\Download\Install\</Image>
      <Image condition="contains any">aspnetcore-runtime-;dotnet-runtime-;windowsdesktop-runtime-;dotnet-hosting-</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Update - Generic runtime installations in Temp -->
    <Rule groupRelation="and">
      <Image condition="contains">\SoftwareDistribution\Download\Install\</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="contains">\.cr\</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Desktop Runtime installer da SoftwareDistribution - Regola ampia -->
    <Rule groupRelation="and">
      <Image condition="contains">\SoftwareDistribution\Download\Install\</Image>
      <Image condition="contains">runtime</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Update Platform - UpdatePlatform.amd64fre.exe che installa Defender updates -->
    <Rule groupRelation="and">
      <Image condition="contains">\SoftwareDistribution\Download\Install\UpdatePlatform.amd64fre.exe</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Visual Studio Update installer che crea DLL temporanee durante aggiornamento -->
    <Rule groupRelation="and">
      <Image condition="contains all">\SoftwareDistribution\Download\Install\;VisualStudioUpdate</Image>
      <TargetFilename condition="contains">\Windows\SystemTemp\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Desktop Runtime installer con Burn framework -->
    <Rule groupRelation="and">
      <Image condition="contains all">\Windows\Temp\;\.cr\;windowsdesktop-runtime-</Image>
      <TargetFilename condition="contains all">\Windows\Temp\;\.ba\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Desktop Runtime installer - file EXE temporanei -->
    <Rule groupRelation="and">
      <Image condition="contains all">\Windows\Temp\;\.cr\;windowsdesktop-runtime-</Image>
      <TargetFilename condition="contains all">\Windows\Temp\;\.be\;windowsdesktop-runtime-</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- .NET Runtime installer - file EXE temporanei -->
    <Rule groupRelation="and">
      <Image condition="contains all">\Windows\Temp\;\.cr\;dotnet-runtime-</Image>
      <TargetFilename condition="contains all">\Windows\Temp\;\.be\;dotnet-runtime-</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Desktop Runtime installer - MSI files -->
    <Rule groupRelation="and">
      <Image condition="contains all">\Windows\Temp\;\.cr\;windowsdesktop-runtime-</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="end with">.msi</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- .NET Runtime installer da Package Cache -->
    <Rule groupRelation="and">
      <Image condition="contains all">\ProgramData\Package Cache\;dotnet-runtime-</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="contains any">\.ba\;\.be\</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Desktop Runtime installer da Package Cache -->
    <Rule groupRelation="and">
      <Image condition="contains all">\ProgramData\Package Cache\;windowsdesktop-runtime-</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="contains any">\.ba\;\.be\</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Recovery Environment - caso specifico del tuo log -->
    <Rule groupRelation="and">
      <Image condition="contains">\$WinREAgent\Scratch\</Image>
      <Image condition="contains">dismhost.exe</Image>
      <TargetFilename condition="contains all">$WinREAgent\Scratch\Mount\Windows\WinSxS\Temp</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    <!-- WinSxS InFlight temp files - caso specifico del tuo log -->
    <Rule groupRelation="and">
      <TargetFilename condition="contains all">Windows\WinSxS\Temp\InFlight</TargetFilename>
      <TargetFilename condition="end with">_tiworker.exe</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    <!-- Windows Recovery dismhost.exe crea tiworker.exe temporaneo -->
    <Rule groupRelation="and">
      <Image condition="contains all">$WinREAgent\Scratch\;dismhost.exe</Image>
      <TargetFilename condition="contains all">WinSxS\Temp\InFlight\;_tiworker.exe</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    <!-- Windows Recovery dismhost.exe - Esclusione più ampia per qualsiasi file creato da dismhost in WinREAgent -->
    <Rule groupRelation="and">
      <Image condition="contains">dismhost.exe</Image>
      <Image condition="contains">$WinREAgent</Image>
      <TargetFilename condition="contains">\Temp\</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    <!-- Windows Recovery Environment - Comprehensive exclusion for all WinREAgent operations -->
    <Rule groupRelation="and">
      <Image condition="contains">$WinREAgent\</Image>
      <TargetFilename condition="contains">$WinREAgent\</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    <!-- SysAid - Software di help desk che crea file nella cartella pubblica -->
    <Rule groupRelation="and">
      <Image condition="contains">\SysAid\</Image>
      <TargetFilename condition="contains">\Users\Public\</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- ESET - Esclusione totale per qualsiasi file creato da prodotti ESET -->
    <Image condition="contains">\ESET\</Image>
    <!-- ADSelfServicePlus - Esclusione totale per qualsiasi file creato -->
    <Image condition="contains">ADSelfServicePlus</Image>
    <!-- TeamViewer - Esclusione totale per qualsiasi file creato (software principale di gestione remota) -->
    <Image condition="contains">\TeamViewer\</Image>
    <!-- Veeam - Esclusione totale per qualsiasi file creato (software critico di backup) -->
    <Image condition="contains">\Veeam\</Image>
    
    <!-- Windows Installer MSI*.tmp che crea setup.exe in Temp durante installazioni legittime -->
    <Rule groupRelation="and">
      <Image condition="contains">\Windows\Installer\MSI</Image>
      <Image condition="end with">.tmp</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="end with">setup.exe</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- Windows Installer - Esclusione più ampia per qualsiasi MSI*.tmp che crea file in Temp\7z* -->
    <Rule groupRelation="and">
      <Image condition="contains">\Windows\Installer\MSI</Image>
      <Image condition="end with">.tmp</Image>
      <TargetFilename condition="contains">\Windows\Temp\7z</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- Firefox Installer - MSI*.tmp che installa QUALSIASI file di Firefox in Temp -->
    <Rule groupRelation="and">
      <Image condition="contains">\Windows\Installer\MSI</Image>
      <Image condition="end with">.tmp</Image>
      <TargetFilename condition="contains">\Windows\Temp\7zS</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- Firefox Setup.exe che crea DLL NSIS in Temp (installer components) -->
    <Rule groupRelation="and">
      <Image condition="contains">\Windows\Temp\7zS</Image>
      <Image condition="end with">setup.exe</Image>
      <TargetFilename condition="contains">\Windows\Temp\ns</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- Firefox maintenanceservice_installer.exe che crea DLL in Temp -->
    <Rule groupRelation="and">
      <Image condition="contains">Mozilla Firefox\maintenanceservice_installer.exe</Image>
      <TargetFilename condition="contains">\Windows\Temp\ns</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- Firefox Setup - Creazione shortcut legittimi sul Desktop pubblico (qualsiasi pattern 7zS) -->
    <Rule groupRelation="and">
      <Image condition="contains">\Windows\Temp\7zS</Image>
      <Image condition="end with">setup.exe</Image>
      <TargetFilename condition="contains">\Users\Public\Desktop\</TargetFilename>
      <TargetFilename condition="contains">Firefox</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    
    <!-- ===== ESCLUSIONI AGGIUNTIVE SUGGERITE PER WINDOWS UPDATE ===== -->
    <!-- TrustedInstaller operazioni legittime -->
    <Rule groupRelation="and">
      <Image condition="is">C:\Windows\servicing\TrustedInstaller.exe</Image>
      <TargetFilename condition="contains any">\Windows\WinSxS\;\Windows\servicing\;\Windows\Temp\</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    <!-- Windows Update Client -->
    <Rule groupRelation="and">
      <Image condition="is">C:\Windows\System32\wuauclt.exe</Image>
      <TargetFilename condition="contains">\Windows\SoftwareDistribution\</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- DISM operations generiche -->
    <Rule groupRelation="and">
      <Image condition="contains">dismhost.exe</Image>
      <TargetFilename condition="contains any">\Windows\WinSxS\Temp\;\Windows\Temp\;\$WinREAgent\</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Component Based Servicing tramite svchost -->
    <Rule groupRelation="and">
      <Image condition="is">C:\Windows\System32\svchost.exe</Image>
      <TargetFilename condition="contains all">\Windows\WinSxS\Temp\;InFlight</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Update staging files -->
    <Rule groupRelation="and">
      <TargetFilename condition="contains">\Windows\WinSxS\pending.xml</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Servicing Stack -->
    <Rule groupRelation="and">
      <Image condition="contains">\Windows\servicing\</Image>
      <TargetFilename condition="contains">\Windows\servicing\Packages\</TargetFilename>
      <TargetFilename condition="end with">.mum</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- msiexec installazione .NET Framework/Runtime legittima -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\system32\msiexec.exe</Image>
      <TargetFilename condition="contains">\Program Files\dotnet\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- msiexec installazione .NET Framework/Runtime legittima (32-bit) -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\system32\msiexec.exe</Image>
      <TargetFilename condition="contains">\Program Files (x86)\dotnet\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Wazuh Agent installazione/aggiornamento legittimo -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\system32\msiexec.exe</Image>
      <TargetFilename condition="contains any">\Windows\Temp\wazuh-agent-;\Windows\Temp\PFiles\ossec-agent\</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Defender MpSigStub aggiornamento definizioni -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\system32\MpSigStub.exe</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="end with">mpengine.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Defender MsMpEng.exe crea DLL temporanee durante scansioni -->
    <Rule groupRelation="and">
      <Image condition="contains">\Windows Defender\Platform\</Image>
      <Image condition="end with">\MsMpEng.exe</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Windows Defender MsMpEng.exe crea DismHost.exe temporaneo per operazioni di manutenzione -->
    <Rule groupRelation="and">
      <Image condition="contains">\Windows Defender\Platform\</Image>
      <Image condition="end with">\MsMpEng.exe</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="end with">\DismHost.exe</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- DISM.exe crea DLL temporanee in C:\Windows\Temp (AppxProvider.dll, ProvProvider.dll e simili) -->
    <Rule groupRelation="and">
      <Image condition="end with">\Dism.exe</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- wmiprvse.exe crea DLL temporanee in C:\Windows\Temp (AppxProvider.dll e simili) -->
    <Rule groupRelation="and">
      <Image condition="end with">\wmiprvse.exe</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- DISM.exe crea TransmogProvider.dll e altre DLL in sottocartelle GUID di Windows\Temp -->
    <Rule groupRelation="and">
      <Image condition="is">C:\Windows\System32\Dism.exe</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="contains">TransmogProvider.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- DISM.exe crea DismHost.exe in cartelle temporanee per operazioni di manutenzione -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\system32\Dism.exe</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="end with">\DismHost.exe</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- DISM.exe operazioni driver da utenti normali in cartelle temporanee -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\system32\dism.exe</Image>
      <TargetFilename condition="contains all">\AppData\Local\Temp\;\DriverStore\FileRepository\</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
    </Rule>
    <!-- DISM.exe crea DismHost.exe in AppData temporanee per utenti normali -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\system32\dism.exe</Image>
      <TargetFilename condition="contains">\AppData\Local\Temp\</TargetFilename>
      <TargetFilename condition="end with">\DismHost.exe</TargetFilename>
    </Rule>
    <!-- Windows Disk Cleanup (cleanmgr.exe) crea DLL temporanee come FfuProvider.dll per operazioni di pulizia -->
    <Rule groupRelation="and">
      <Image condition="is">C:\Windows\system32\cleanmgr.exe</Image>
      <TargetFilename condition="contains">\AppData\Local\Temp\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
    </Rule>
        <Image condition="is">C:\Program Files (x86)\Dell\CommandUpdate\InvColPC.exe</Image>
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files\Elastic\Endpoint\elastic-endpoint.exe</Image>
          <TargetFilename condition="is">C:\Program Files\Elastic\Endpoint\state\last-document-id.json</TargetFilename>
        </Rule>
    <!-- Intel Bluetooth driver installer che crea file temporanei -->
    <Rule groupRelation="and">
    <Image condition="contains">\Intel\DSA\Downloads\</Image>
    <Image condition="contains">BT-</Image>
    <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
    <TargetFilename condition="end with">.dll</TargetFilename>
    </Rule>
    <!-- ESET Remote Administrator Agent aggiornamenti legittimi -->
    <Rule groupRelation="and">
      <Image condition="contains">\ESET\RemoteAdministrator\Agent\ERAAgent.exe</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="end with">.msi</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- ESET Remote Administrator Agent installazione tramite msiexec -->
    <Rule groupRelation="and">
      <Image condition="is">C:\Windows\System32\MsiExec.exe</Image>
      <TargetFilename condition="contains">EsetRemoteAdminAgent</TargetFilename>
    </Rule>
    <!-- ESET - qualsiasi operazione in Temp (più ampia) -->
    <Rule groupRelation="and">
      <TargetFilename condition="contains all">\Temp\;Eset</TargetFilename>
    </Rule>
    <!-- Veeam Agent installer che crea file temporanei durante installazione -->
    <Rule groupRelation="and">
      <Image condition="contains">VeeamAgentWindows</Image>
      <TargetFilename condition="contains all">Veeam\Setup\Temp\</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
    </Rule>
    <!-- Browser installers che creano LNK sul desktop pubblico -->
    <Rule groupRelation="and">
      <Image condition="contains">setup.exe</Image>
      <TargetFilename condition="is">C:\Users\Public\Desktop\Microsoft Edge.lnk</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    
    <!-- Microsoft Edge Update - Exclude temp installer writing EdgeUpdate.exe in temp folders -->
    <Rule groupRelation="and">
      <Image condition="contains">\Windows\Installer\</Image>
      <TargetFilename condition="contains all">Microsoft\Temp\;.tmp;MicrosoftEdgeUpdate.exe</TargetFilename>
      <TargetFilename condition="end with">MicrosoftEdgeUpdate.exe</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    
    <!-- ===== ELEVOC AUDIO DRIVER INSTALLER ===== -->
    <!-- ElevocAPOCheck.exe - Legitimate audio driver installer creating Python runtime DLLs -->
    <Rule groupRelation="and">
      <Image condition="is">C:\WINDOWS\System32\ElevocInstallDriver\ElevocAPOCheck.exe</Image>
      <TargetFilename condition="contains">C:\Windows\Temp\_MEI</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    
    <!-- ElevocAPOCheck.exe - Generic exclusion for any DLL creation in Temp -->
    <Rule groupRelation="and">
      <Image condition="contains">ElevocAPOCheck.exe</Image>
      <TargetFilename condition="contains">C:\Windows\Temp\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    
    <!-- Audio driver installers using Python PyInstaller framework -->
    <Rule groupRelation="and">
      <TargetFilename condition="contains">C:\Windows\Temp\_MEI</TargetFilename>
      <TargetFilename condition="contains any">python311.dll;ucrtbase.dll;VCRUNTIME140.dll;api-ms-win;libcrypto;libssl</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    
    <!-- Google Chrome desktop shortcut - Universal rule -->
    <TargetFilename condition="is">C:\Users\Public\Desktop\Google Chrome.lnk</TargetFilename>
    
    <!-- Google Chrome installer from SystemTemp creating desktop shortcut -->
    <Rule groupRelation="and">
      <Image condition="contains all">\SystemTemp\Google;setup.exe</Image>
      <TargetFilename condition="is">C:\Users\Public\Desktop\Google Chrome.lnk</TargetFilename>
      <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
    </Rule>
    <Rule groupRelation="and">
      <Image condition="contains">setup.exe</Image>
      <TargetFilename condition="is">C:\Users\Public\Desktop\Brave.lnk</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <Rule groupRelation="and">
      <Image condition="contains">setup.exe</Image>
      <TargetFilename condition="is">C:\Users\Public\Desktop\Firefox.lnk</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Microsoft Edge Update installer specifico -->
    <Rule groupRelation="and">
      <Image condition="contains all">EdgeUpdate\Install\;setup.exe</Image>
      <TargetFilename condition="is">C:\Users\Public\Desktop\Microsoft Edge.lnk</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Microsoft Edge Update installer con cartelle temporanee EDGEMITMP -->
    <Rule groupRelation="and">
      <Image condition="contains all">EdgeUpdate\Install\;EDGEMITMP_;setup.exe</Image>
      <TargetFilename condition="is">C:\Users\Public\Desktop\Microsoft Edge.lnk</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Microsoft Edge Update installer tramite Windows Installer MSI -->
    <Rule groupRelation="and">
      <Image condition="contains">\Windows\Installer\MSI</Image>
      <Image condition="end with">.tmp</Image>
      <TargetFilename condition="contains">\Microsoft\Temp\</TargetFilename>
      <TargetFilename condition="contains">MicrosoftEdgeUpdate</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Microsoft Edge Update Setup crea file temporanei in Microsoft\Temp durante installazione -->
    <Rule groupRelation="and">
      <Image condition="contains all">\Microsoft\EdgeUpdate\Install\;MicrosoftEdgeUpdateSetup</Image>
      <TargetFilename condition="contains">Microsoft\Temp\</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Microsoft Edge installer MSI - tutti i componenti Edge inclusi ARM64 -->
    <Rule groupRelation="and">
      <Image condition="contains">\Windows\Installer\MSI</Image>
      <Image condition="end with">.tmp</Image>
      <TargetFilename condition="contains">C:\Program Files (x86)\Microsoft\Temp\</TargetFilename>
      <TargetFilename condition="contains">MicrosoftEdge</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Google Chrome installer da SystemTemp -->
    <!-- RIMOSSO: Regola duplicata per Google Chrome.lnk -->
    <!-- msiexec generico che crea LNK sul desktop pubblico durante installazioni legittime -->
    <Rule groupRelation="and">
      <Image condition="is">C:\Windows\System32\msiexec.exe</Image>
      <TargetFilename condition="begin with">C:\Users\Public\Desktop\</TargetFilename>
      <TargetFilename condition="end with">.lnk</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- msiexec SysWOW64 che crea LNK sul desktop pubblico durante installazioni legittime -->
    <Rule groupRelation="and">
      <Image condition="is">C:\Windows\SysWOW64\msiexec.exe</Image>
      <TargetFilename condition="begin with">C:\Users\Public\Desktop\</TargetFilename>
      <TargetFilename condition="end with">.lnk</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- TeamViewer Update che crea DLL temporanee durante aggiornamento -->
    <Rule groupRelation="and">
      <Image condition="contains">\TeamViewer\Update\update.exe</Image>
      <TargetFilename condition="contains all">\Windows\Temp\;.tmp\</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- NinjaRMM - Esclusione totale per qualsiasi file creato da NinjaRMM -->
    <Rule groupRelation="and">
      <Image condition="contains">\NinjaRMMAgent\</Image>
    </Rule>
    <!-- Chrome update che crea file durante installazione -->
    <Rule groupRelation="and">
    <Image condition="contains all">
      \SystemTemp\chrome_Unpacker_;
      \setup.exe
    </Image>
    <TargetFilename condition="contains">\Google\Chrome\Temp\</TargetFilename>
    <TargetFilename condition="end with">.exe</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- NVIDIA Driver Setup - Creazione DLL temporanee durante installazione driver -->
    <Rule groupRelation="and">
      <Image condition="contains">\DriverStore\FileRepository\nvdm.inf_</Image>
      <Image condition="end with">\SETUP.EXE</Image>
      <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
      <TargetFilename condition="end with">.DLL</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Google Chrome update process da SystemTemp con pattern variabili -->
    <Rule groupRelation="and">
      <Image condition="contains all">\SystemTemp\Google;setup.exe</Image>
      <TargetFilename condition="contains">\Google\Chrome\Temp\</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
    <!-- Chrome update che crea file in Chrome-bin durante installazione -->
    <Rule groupRelation="and">
      <Image condition="contains">\SystemTemp\chrome_Unpacker_</Image>
      <TargetFilename condition="contains all">\Google\Chrome\Temp\;Chrome-bin\</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename>
      <User condition="is">NT AUTHORITY\SYSTEM</User>
    </Rule>
        <Rule groupRelation="and">
          <Image condition="begin with">C:\Program Files\Elastic\Agent\data\</Image>
          <TargetFilename condition="contains all">C:\Program Files\Elastic\Agent\data\;.ndjson</TargetFilename>
        </Rule>
    <!-- NinjaRMM - Esclusione totale per qualsiasi file creato da NinjaRMM (duplicato) -->
    <Rule groupRelation="and">
      <Image condition="contains">\NinjaRMMAgent\</Image>
    </Rule>
        <Image condition="is">C:\Windows\system32\igfxCUIService.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Ivanti\Workspace Control\pfwsmgr.exe</Image>
        <Image condition="is">C:\Program Files (x86)\RES Software\Workspace Manager\pfwsmgr.exe</Image>
        <Image condition="is">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeC2RClient.exe</Image>
        <TargetFilename condition="contains all">C:\Windows\Prefetch;.pf</TargetFilename>
        <Image condition="is">C:\Windows\System32\smss.exe</Image>
        <Image condition="is">C:\Windows\system32\CompatTelRunner.exe</Image>
        <Image condition="is">C:\Windows\system32\wbem\WMIADAP.EXE</Image>
        <TargetFilename condition="begin with">C:\Windows\System32\DriverStore\Temp\</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\System32\wbem\Performance\</TargetFilename>
        <TargetFilename condition="end with">WRITABLE.TST</TargetFilename>
        <TargetFilename condition="contains">\AppData\Roaming\Microsoft\Windows\Recent\</TargetFilename>
        <TargetFilename condition="begin with">C:\$WINDOWS.~BT\Sources\SafeOS\SafeOS.Mount\</TargetFilename>
        <Image condition="begin with">C:\WINDOWS\winsxs\amd64_microsoft-windows</Image>
        <Image condition="is">c:\Program Files\Microsoft Security Client\MsMpEng.exe</Image>
        <Rule groupRelation="and">
          <Image condition="contains">Outlook.exe</Image>
          <TargetFilename condition="contains">Roaming\Microsoft\Outlook\Outlook.xml</TargetFilename>
        </Rule>
        <Image condition="is">c:\windows\system32\provtool.exe</Image>
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\system32\wsmprovhost.exe</Image>
          <TargetFilename condition="contains all">C:\Users\;\AppData\Local\Temp;__PSScriptPolicyTest;.ps1</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\system32\WindowsPowerShell\v1.0\powershell.exe</Image>
          <TargetFilename condition="contains all">C:\Windows\Temp;__PSScriptPolicyTest;.ps1</TargetFilename>
          <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- HP Accessory Center che crea script PowerShell temporanei per operazioni legittime -->
        <Rule groupRelation="and">
          <Image condition="contains">WindowsApps\AD2F1837.HPAccessoryCenter</Image>
          <Image condition="end with">\HPAccessoryCenter.exe</Image>
          <TargetFilename condition="contains all">\AppData\Local\Temp\;hpac_;.ps1</TargetFilename>
        </Rule>
        <!-- SharePoint Search Host Controller scarica DLL dizionari per controllo ortografico -->
        <Rule groupRelation="and">
          <Image condition="contains">\Microsoft Office Servers\16.0\Search\HostController\hostcontrollerservice.exe</Image>
          <TargetFilename condition="contains all">\AppData\Local\Temp\HostController\Downloads\;.dll</TargetFilename>
          <User condition="contains">svc_spfarm</User>
        </Rule>
        <Image condition="is">C:\WINDOWS\CCM\CcmExec.exe</Image>
        <TargetFilename condition="begin with">C:\Windows\CCM</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\System32\Tasks\Microsoft\Windows\PLA\FabricTraces</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\System32\Tasks\Microsoft\Windows\SoftwareProtectionPlatform\SvcRestartTask</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\System32\Tasks\Microsoft\Windows\Customer Experience Improvement Program\Server\ServerRoleUsageCollector</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\System32\Tasks\Microsoft\Windows\Customer Experience Improvement Program\Server\ServerCeipAssistant</TargetFilename>
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\System32\svchost.exe</Image>
          <TargetFilename condition="is">C:\Windows\ServiceProfiles\LocalService\AppData\Local\lastalive0.dat</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\System32\svchost.exe</Image>
          <TargetFilename condition="is">C:\Windows\ServiceProfiles\LocalService\AppData\Local\lastalive1.dat</TargetFilename>
        </Rule>
            <!-- Microsoft Edge Update - Versione corretta -->
        <Rule groupRelation="and">
            <Image condition="contains">\Microsoft\EdgeUpdate\</Image>
            <Image condition="contains any">Setup;Install</Image>
            <TargetFilename condition="contains">\Microsoft\Temp\</TargetFilename>
            <TargetFilename condition="end with">.exe</TargetFilename>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        <!-- Alternativa più generica per tutti gli update Microsoft -->
        <Rule groupRelation="and">
            <Image condition="contains any">\Microsoft\EdgeUpdate\;\Microsoft\Edge\</Image>
            <TargetFilename condition="contains">Temp</TargetFilename>
            <TargetFilename condition="end with">.exe</TargetFilename>
            <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
    <Rule groupRelation="and">
      <Image condition="contains any">
      \Office16\EXCEL.EXE;
      \Office16\WINWORD.EXE;
      \Office16\POWERPNT.EXE;
      \Office16\OUTLOOK.EXE
    </Image>
    <TargetFilename condition="contains all">
      \AppData\Roaming\Microsoft\Office\Recent\;
      .LNK
    </TargetFilename>
    </Rule>
  <!-- HP Driver Setup che crea file temporanei durante installazione -->
  <Rule groupRelation="and">
  <Image condition="contains">\DriverStore\FileRepository\</Image>
  <Image condition="contains">HPDCSetup.exe</Image>
  <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
  <TargetFilename condition="end with">.dll</TargetFilename>
  </Rule>
  <!-- HP Driver Setup con NSIS installer - crea file nsExec.dll e altri componenti NSIS -->
  <Rule groupRelation="and">
    <Image condition="contains">\DriverStore\FileRepository\</Image>
    <Image condition="contains any">HPDCSetup.exe;HP.*Setup.exe</Image>
    <TargetFilename condition="contains">\Windows\Temp\ns</TargetFilename>
    <TargetFilename condition="contains">.tmp\</TargetFilename>
  </Rule>
  <!-- Generic HP driver installations from DriverStore creating any temp files -->
  <Rule groupRelation="and">
    <Image condition="contains all">\DriverStore\FileRepository\;hp</Image>
    <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  <!-- ManageEngine OpManager Npcap installer che crea DLL temporanee -->
  <Rule groupRelation="and">
    <Image condition="contains">\ManageEngine\OpManager\Nmap\npcap-</Image>
    <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
    <TargetFilename condition="end with">.dll</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  <!-- ManageEngine OpManager Npcap installer che crea file temporanei -->
  <Rule groupRelation="and">
    <Image condition="contains">\ManageEngine\OpManager\Nmap\npcap-</Image>
    <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
    <TargetFilename condition="contains">nso</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  <!-- ManageEngine OpManager vcredist installer che crea file temporanei -->
  <Rule groupRelation="and">
    <Image condition="contains">\ManageEngine\OpManager\Nmap\vcredist_x86.exe</Image>
    <TargetFilename condition="contains all">\Windows\Temp\;\.cr\;vcredist</TargetFilename>
    <TargetFilename condition="end with">.exe</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  <!-- ManageEngine ADAudit Plus - JNA/Elasticsearch file temporanei legittimi -->
  <Rule groupRelation="and">
    <Image condition="contains">\ManageEngine\ADAudit Plus\jre\bin\java.exe</Image>
    <TargetFilename condition="contains all">\Windows\Temp\elasticsearch\jna-</TargetFilename>
    <TargetFilename condition="end with">.dll</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  <!-- TeamViewer Update che crea file temporanei -->
  <Rule groupRelation="and">
  <Image condition="contains">\TeamViewer\Update\update.exe</Image>
  <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
  <TargetFilename condition="contains any">.dll;.exe;.tmp</TargetFilename>
  </Rule>
  <!-- TeamViewer.exe che crea update.exe nella sua cartella temp -->
  <Rule groupRelation="and">
  <Image condition="contains">\TeamViewer\TeamViewer.exe</Image>
  <TargetFilename condition="contains all">\AppData\Local\Temp\TeamViewer\;update.exe</TargetFilename>
  </Rule>
  <!-- Windows Application Compatibility Scripts - acregl.exe -->
  <Rule groupRelation="and">
    <Image condition="contains">\Application Compatibility Scripts\acregl.exe</Image>
    <TargetFilename condition="contains">\AppData\Local\Temp\</TargetFilename>
    <TargetFilename condition="end with">.cmd</TargetFilename>
  </Rule>
          <!-- Windows Diagnostics SDIAG scripts - VERSIONE CORRETTA -->
        <Rule groupRelation="and">
            <Image condition="is">C:\WINDOWS\system32\taskhostw.exe</Image>
            <TargetFilename condition="contains all">\Temp\SDIAG_;.ps1</TargetFilename>
        </Rule>
        <!-- Alternativa più specifica -->
        <Rule groupRelation="and">
            <Image condition="is">C:\WINDOWS\system32\taskhostw.exe</Image>
            <TargetFilename condition="contains">\Temp\SDIAG_</TargetFilename>
            <TargetFilename condition="end with">.ps1</TargetFilename>
        </Rule>
        <!-- Esclusione ancora più ampia per tutti i file SDIAG -->
        <Rule groupRelation="and">
            <TargetFilename condition="contains">\Temp\SDIAG_</TargetFilename>
            <TargetFilename condition="contains any">CL_Utility.ps1;TS_</TargetFilename>
        </Rule>
        <!-- Windows Diagnostics SDIAG DLL - DiagPackage legittime -->
        <Rule groupRelation="and">
            <Image condition="is">C:\WINDOWS\system32\taskhostw.exe</Image>
            <TargetFilename condition="contains all">\Temp\SDIAG_;DiagPackage.dll</TargetFilename>
        </Rule>
  <!-- Installer wireless che crea file temporanei durante installazione -->
  <Rule groupRelation="and">
    <Image condition="contains">\Temp\</Image>
    <Image condition="contains">WirelessSetup.exe</Image>
  <TargetFilename condition="contains all">
    \Temp\;
    \CoreBA.exe
  </TargetFilename>
  </Rule>
  <!-- Applicazioni che usano pattern GUID\.cr per auto-estrazione in AppData\Local\Temp -->
  <Rule groupRelation="and">
    <Image condition="contains">\AppData\Local\Temp\</Image>
    <TargetFilename condition="contains all">\AppData\Local\Temp\{;}\\.cr\\</TargetFilename>
    <TargetFilename condition="end with">.exe</TargetFilename>
  </Rule>
  <!-- PRTG Desktop installazione specifica -->
  <Rule groupRelation="and">
    <Image condition="contains">\PRTGDesktop\</Image>
    <TargetFilename condition="contains all">\AppData\Local\Temp\;\.cr\</TargetFilename>
    <TargetFilename condition="end with">prtg-desktop-offline-</TargetFilename>
  </Rule>
  <!-- VS Code PowerShell Extension - Creazione di DLL legittime -->
  <Rule groupRelation="and">
    <Image condition="contains">Microsoft VS Code\Code.exe</Image>
    <TargetFilename condition="contains all">\.vscode\extensions\;PowerShellEditorServices</TargetFilename>
    <TargetFilename condition="end with">.dll</TargetFilename>
  </Rule>
  <!-- VS Code - Creazione temporanea estensioni PowerShell con GUID -->
  <Rule groupRelation="and">
    <Image condition="contains">Microsoft VS Code\Code.exe</Image>
    <TargetFilename condition="contains">\.vscode\extensions\.</TargetFilename>
    <TargetFilename condition="contains">\modules\PowerShellEditorServices\</TargetFilename>
    <TargetFilename condition="end with">.dll</TargetFilename>
  </Rule>
  <!-- PowerShell - Creazione DLL temporanee per compilazione dinamica C# -->
  <Rule groupRelation="and">
    <Image condition="end with">\powershell.exe</Image>
    <TargetFilename condition="contains">\AppData\Local\Temp\</TargetFilename>
    <TargetFilename condition="end with">.dll</TargetFilename>
  </Rule>
  <!-- PowerShell ISE - Creazione DLL temporanee per compilazione dinamica -->
  <Rule groupRelation="and">
    <Image condition="end with">\powershell_ise.exe</Image>
    <TargetFilename condition="contains">\AppData\Local\Temp\</TargetFilename>
    <TargetFilename condition="end with">.dll</TargetFilename>
  </Rule>
  <!-- IIS/ASP.NET - File temporanei legittimi creati da w3wp.exe -->
  <Rule groupRelation="and">
    <Image condition="is">C:\Windows\System32\inetsrv\w3wp.exe</Image>
    <TargetFilename condition="contains">\Temporary ASP.NET Files\</TargetFilename>
    <User condition="contains">\svc_</User>
  </Rule>
  <!-- IIS/ASP.NET - BouncyCastle e altre DLL legittime in Temporary ASP.NET Files -->
  <Rule groupRelation="and">
    <Image condition="is">C:\Windows\System32\inetsrv\w3wp.exe</Image>
    <TargetFilename condition="contains all">\Temporary ASP.NET Files\;\.DLL</TargetFilename>
  </Rule>
  <!-- IIS generico - tutti i file temporanei ASP.NET legittimi -->
  <Rule groupRelation="and">
    <Image condition="end with">\inetsrv\w3wp.exe</Image>
    <TargetFilename condition="contains">\Microsoft.NET\Framework64\v4.0.30319\Temporary ASP.NET Files\</TargetFilename>
  </Rule>
  <Rule groupRelation="and">
    <Image condition="end with">\inetsrv\w3wp.exe</Image>
    <TargetFilename condition="contains">\Microsoft.NET\Framework\v4.0.30319\Temporary ASP.NET Files\</TargetFilename>
  </Rule>
  <!-- Office che crea file .LNK nella cartella Recent - comportamento legittimo -->
  <Rule groupRelation="and">
    <Image condition="contains">\Microsoft Office\</Image>
    <TargetFilename condition="contains">\AppData\Roaming\Microsoft\Office\Recent\</TargetFilename>
    <TargetFilename condition="end with">.LNK</TargetFilename>
  </Rule>
  <Rule groupRelation="and">
    <Image condition="contains">\Microsoft Office\</Image>
    <TargetFilename condition="contains">\AppData\Roaming\Microsoft\Office\Recent\</TargetFilename>
    <TargetFilename condition="end with">.lnk</TargetFilename>
  </Rule>
  
  <!-- ===== WINDOWS UPDATE & SERVICING EXCLUSIONS ===== -->
  <!-- Windows Recovery Agent & DISM - Operazioni legittime di servicing -->
  <Rule groupRelation="and">
    <Image condition="contains">$WinREAgent\Scratch\</Image>
    <Image condition="end with">\dismhost.exe</Image>
    <TargetFilename condition="contains">$WinREAgent\Scratch\Mount\Windows\WinSxS\Temp\InFlight\</TargetFilename>
    <TargetFilename condition="end with">_tiworker.exe</TargetFilename>
    <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
  </Rule>
  <!-- DISM/dismhost generico per operazioni WinREAgent -->
  <Rule groupRelation="and">
    <Image condition="contains">\dismhost.exe</Image>
    <TargetFilename condition="contains">$WinREAgent\Scratch\</TargetFilename>
    <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
  </Rule>
  <!-- Windows Update/TiWorker che crea file temporanei -->
  <Rule groupRelation="and">
    <Image condition="is">C:\Windows\System32\TiWorker.exe</Image>
    <TargetFilename condition="contains">\WinSxS\Temp\</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  <!-- Esclusione generica per file in WinSxS\Temp creati dal servicing stack -->
  <Rule groupRelation="and">
    <TargetFilename condition="contains">\WinSxS\Temp\InFlight\</TargetFilename>
    <TargetFilename condition="end with">_tiworker.exe</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  <!-- TrustedInstaller.exe che crea file durante aggiornamenti -->
  <Rule groupRelation="and">
    <Image condition="is">C:\Windows\servicing\TrustedInstaller.exe</Image>
    <TargetFilename condition="contains">\WinSxS\</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  <!-- Brave Browser Update - Legitimate browser update process -->
  <Rule groupRelation="and">
    <Image condition="contains">\BraveSoftware\Update\BraveUpdate.exe</Image>
    <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
    <TargetFilename condition="contains">brave_installer</TargetFilename>
    <TargetFilename condition="end with">.exe</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  <!-- Chrome Update - Legitimate browser update process -->
  <Rule groupRelation="and">
    <Image condition="contains">\Google\Update\GoogleUpdate.exe</Image>
    <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
    <TargetFilename condition="contains">chrome_installer</TargetFilename>
    <TargetFilename condition="end with">.exe</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  <!-- Edge Update - Legitimate browser update process -->
  <Rule groupRelation="and">
    <Image condition="contains">\Microsoft\EdgeUpdate\MicrosoftEdgeUpdate.exe</Image>
    <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
    <TargetFilename condition="contains">MicrosoftEdge</TargetFilename>
    <TargetFilename condition="end with">.exe</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  <!-- NVIDIA App - rundll32.exe creating JSON configuration files -->
  <Rule groupRelation="and">
    <Image condition="contains">rundll32.exe</Image>
    <TargetFilename condition="contains">\NVIDIA Corporation\NVIDIA app\</TargetFilename>
    <TargetFilename condition="end with">.json</TargetFilename>
  </Rule>
  <!-- NVIDIA App - rundll32.exe creating Start Menu shortcuts -->
  <Rule groupRelation="and">
    <Image condition="contains">rundll32.exe</Image>
    <TargetFilename condition="contains all">Start Menu\Programs\NVIDIA Corporation</TargetFilename>
    <TargetFilename condition="end with">.lnk</TargetFilename>
  </Rule>
  <!-- NVIDIA GeForce Experience - rundll32.exe operations -->
  <Rule groupRelation="and">
    <Image condition="contains">rundll32.exe</Image>
    <TargetFilename condition="contains">\NVIDIA Corporation\</TargetFilename>
  </Rule>
  <!-- Inno Setup installers - Legitimate installation temporary files -->
  <Rule groupRelation="and">
    <Image condition="contains all">\Windows\Temp\is-;.tmp</Image>
    <TargetFilename condition="contains all">\Windows\Temp\is-;.tmp</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  <!-- Inno Setup - isxdl.dll download component -->
  <Rule groupRelation="and">
    <TargetFilename condition="contains">\Windows\Temp\is-</TargetFilename>
    <TargetFilename condition="end with">isxdl.dll</TargetFilename>
  </Rule>
  <!-- Inno Setup - Setup files in temp -->
  <Rule groupRelation="and">
    <TargetFilename condition="contains">\Windows\Temp\is-</TargetFilename>
    <TargetFilename condition="contains">Setup.dll</TargetFilename>
  </Rule>
  <!-- Inno Setup - Cleanup utilities -->
  <Rule groupRelation="and">
    <TargetFilename condition="contains">\Windows\Temp\is-</TargetFilename>
    <TargetFilename condition="contains">deldir</TargetFilename>
  </Rule>
  <!-- Inno Setup - Any file created by installer in temp (broader exclusion) -->
  <Rule groupRelation="and">
    <Image condition="contains">\TEMP\is-</Image>
    <Image condition="end with">.tmp</Image>
    <TargetFilename condition="contains">\Temp\</TargetFilename>
  </Rule>
  <!-- Microsoft Edge installer creating desktop shortcuts -->
  <Rule groupRelation="and">
    <Image condition="contains">\Microsoft\EdgeUpdate\</Image>
    <TargetFilename condition="contains">\Users\Public\Desktop\</TargetFilename>
    <TargetFilename condition="end with">Microsoft Edge.lnk</TargetFilename>
    <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
  </Rule>
  <!-- Browser installers creating public desktop shortcuts -->
  <Rule groupRelation="and">
    <TargetFilename condition="contains">\Users\Public\Desktop\</TargetFilename>
    <TargetFilename condition="end with">.lnk</TargetFilename>
    <Image condition="contains any">\EdgeUpdate\;\ChromeUpdate\;\BraveUpdate\;\Firefox\</Image>
  </Rule>
  <!-- NinjaRMM patching operations - NSIS installers (nsy pattern) -->
  <Rule groupRelation="and">
    <Image condition="contains">\NinjaRMMAgent\components\app-patching-ops\</Image>
    <TargetFilename condition="contains">\Temp\nsy</TargetFilename>
    <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
  </Rule>
  <!-- NinjaRMM patching operations - NSIS installers (nsp pattern) -->
  <Rule groupRelation="and">
    <Image condition="contains">\NinjaRMMAgent\components\app-patching-ops\</Image>
    <TargetFilename condition="contains">\Temp\nsp</TargetFilename>
    <User condition="contains any">NT AUTHORITY\SYSTEM;NT-AUTORITÄT\SYSTEM</User>
  </Rule>
  <!-- NinjaRMM patching operations - NSIS temp files (broad) -->
  <Rule groupRelation="and">
    <Image condition="contains">\NinjaRMMAgent\</Image>
    <TargetFilename condition="contains">\Temp\ns</TargetFilename>
    <TargetFilename condition="end with">.tmp</TargetFilename>
  </Rule>
  <!-- NSIS installers creating temp files (generic) -->
  <Rule groupRelation="and">
    <TargetFilename condition="contains all">\Temp\ns;.tmp</TargetFilename>
    <TargetFilename condition="end with">.dll</TargetFilename>
  </Rule>
  
  <!-- MSI installers creating EXE files in Temp folders -->
  <Rule groupRelation="and">
    <Image condition="is">C:\WINDOWS\system32\msiexec.exe</Image>
    <TargetFilename condition="contains">\Temp\</TargetFilename>
    <TargetFilename condition="end with">.exe</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  
  <!-- MSI installers creating MSI files in Temp folders -->
  <Rule groupRelation="and">
    <Image condition="is">C:\WINDOWS\system32\msiexec.exe</Image>
    <TargetFilename condition="contains">\Temp\</TargetFilename>
    <TargetFilename condition="end with">.msi</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  
  <!-- MSI installers creating TMP files in Temp folders -->
  <Rule groupRelation="and">
    <Image condition="is">C:\WINDOWS\system32\msiexec.exe</Image>
    <TargetFilename condition="contains">\Temp\</TargetFilename>
    <TargetFilename condition="end with">.tmp</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  
  <!-- Foxit and other legitimate installers creating files in Temp -->
  <Rule groupRelation="and">
    <Image condition="is">C:\WINDOWS\system32\msiexec.exe</Image>
    <TargetFilename condition="contains any">FoxitEditor;FoxitReader;AdobeReader;AcroReader</TargetFilename>
    <TargetFilename condition="contains">\Temp\</TargetFilename>
  </Rule>
  
  <!-- Windows svchost creating files in WindowsApps -->
  <Rule groupRelation="and">
    <Image condition="is">C:\WINDOWS\system32\svchost.exe</Image>
    <TargetFilename condition="contains">\WindowsApps\</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  
  <!-- Microsoft Store app installations and updates -->
  <Rule groupRelation="and">
    <TargetFilename condition="contains all">\WindowsApps\;Microsoft.</TargetFilename>
    <TargetFilename condition="end with">.dll</TargetFilename>
    <User condition="is">NT AUTHORITY\SYSTEM</User>
  </Rule>
  
      </FileCreate>
    </RuleGroup>
    <!-- Event ID 12,13,14 == RegObject added/deleted, RegValue Set, RegObject Renamed - Includes -->
    <RuleGroup groupRelation="or">
      <RegistryEvent onmatch="include">
        <TargetObject name="technique_id=T1546.011,technique_name=Application Shimming" condition="contains">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\InstalledSDB</TargetObject>
        <TargetObject name="technique_id=T1546.011,technique_name=Application Shimming" condition="contains">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Custom</TargetObject>
        <TargetObject name="technique_id=T1547.002,technique_name=Authentication Package" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Authentication</TargetObject>
        <TargetObject name="technique_id=T1547.002,technique_name=Authentication Package" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\RunAsPPL</TargetObject>
        <TargetObject name="technique_id=T1547.002,technique_name=Authentication Package" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\NtlmMinClientSec</TargetObject>
        <TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains">\CurrentVersion\Run</TargetObject>
        <TargetObject condition="contains">\Group Policy\Scripts</TargetObject>
        <TargetObject name="technique_id=T1037,technique_name=Boot or Logon Initialization Scripts" condition="contains">\Windows\System\Scripts</TargetObject>
        <TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains">\Policies\Explorer\Run</TargetObject>
        <TargetObject condition="end with">\ServiceDll</TargetObject>
        <TargetObject condition="end with">\ImagePath</TargetObject>
        <TargetObject condition="end with">\Start</TargetObject>
        <TargetObject name="technique_id=T1547.004,technique_name=Winlogon Helper DLL" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify</TargetObject>
        <TargetObject name="technique_id=T1547.004,technique_name=Winlogon Helper DLL" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit</TargetObject>
        <TargetObject name="technique_id=T1547.004,technique_name=Winlogon Helper DLL" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Shell</TargetObject>
        <TargetObject name="technique_id=T1547.004,technique_name=Winlogon Helper DLL" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\VmApplet</TargetObject>
        <TargetObject name="technique_id=T1547.004,technique_name=Winlogon Helper DLL" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Specialaccounts\userlist</TargetObject>
        <TargetObject name="technique_id=T1547.004,technique_name=Winlogon Helper DLL" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Uihostl</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows NT\CurrentVersion\Drivers32</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Drivers32</TargetObject>
        <TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains all">HKLM\SYSTEM\;Control\Session Manager\BootExecute</TargetObject>
        <TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains all">HKLM\SYSTEM\;Control\Session Manager\excludefromknowndlls</TargetObject>
        <TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains all">HKLM\SYSTEM\;Control\Session Manager\safedllsearchmode</TargetObject>
        <TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains all">HKLM\SYSTEM\;Control\Session Manager\setupexecute</TargetObject>
        <TargetObject name="technique_id=T1546.001,technique_name=Change Default File Association" condition="contains">\Explorer\FileExts</TargetObject>
        <TargetObject condition="contains">\shell\install\command</TargetObject>
        <TargetObject condition="contains">\shell\open\command</TargetObject>
        <TargetObject condition="contains">\shell\open\ddeexec</TargetObject>
        <TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains">Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders\Startup</TargetObject>
        <TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains all">software\microsoft\windows nt\currentversion\accessibility\ATs\;\StartExe</TargetObject>
        <TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains">software\microsoft\windows nt\currentversion\windows\run\</TargetObject>
        <TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains">Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU\</TargetObject>
        <TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains">software\microsoft\windows\currentversion\explorer\shell folders\common startup</TargetObject>
        <TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="contains">software\microsoft\windows\currentversion\explorer\shell folders\startup</TargetObject>
        <TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="begin with">hklm\software\microsoft\command processor\autorun</TargetObject>
        <TargetObject name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="contains">\mscfile\shell\open\command</TargetObject>
        <TargetObject name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="contains">ms-settings\shell\open\command</TargetObject>
        <TargetObject name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="contains">Classes\exefile\shell\runas\command\isolatedCommand</TargetObject>
        <TargetObject name="technique_id=T1546.015,technique_name=Component Object Model Hijacking" condition="contains all">Software\Classes\CLSID;inprocserver32</TargetObject>
        <TargetObject name="technique_id=T1546.015,technique_name=Component Object Model Hijacking" condition="contains all">Software\Classes\CLSID;localserver32</TargetObject>
        <TargetObject name="technique_id=T1546.015,technique_name=Component Object Model Hijacking" condition="contains all">Classes\CLSID\;TreatAs</TargetObject>
        <TargetObject name="technique_id=T1003.002,technique_name=Security Account Manager" condition="contains">System\CurrentControlSet\Services\VSS</TargetObject>
        <TargetObject name="technique_id=T1098,technique_name=Account Manipulation" condition="contains">\services\Netlogon\Parameters\DisablePasswordChange</TargetObject>
        <TargetObject name="technique_id=T1546.010,technique_name=Appinit DLLs" condition="contains all">HKLM\SOFTWARE\;Microsoft\Windows NT\CurrentVersion\Windows\Appinit_Dlls</TargetObject>
        <TargetObject name="technique_id=T1546.010,technique_name=Appinit DLLs" condition="contains all">HKLM\SOFTWARE\;Microsoft\Windows NT\CurrentVersion\Windows\loadappinit_dlls</TargetObject>
        <TargetObject name="technique_id=T1546.010,technique_name=Appinit DLLs" condition="contains all">\SYSTEM\;\Services\DNS\Parameters\ServerLevelPluginDll</TargetObject>
        <TargetObject name="technique_id=T1562.006,technique_name=Impair Defenses - Indicator Blocking" condition="end with">SOFTWARE\Microsoft\.NETFramework\ETWEnabled</TargetObject>
        <TargetObject name="technique_id=T1546.008,technique_name=Accessibility Features" condition="contains">\Environment\</TargetObject>
        <TargetObject condition="begin with">HKLM\SYSTEM\setup\cmdline</TargetObject>
        <TargetObject condition="begin with">HKLM\SYSTEM\setup\upgrade</TargetObject>
        <TargetObject condition="contains all">Software\microsoft\ctf\langbaraddin\;\Enable</TargetObject>
        <TargetObject condition="contains all">Software\microsoft\ctf\langbaraddin\;\FilePath</TargetObject>
        <TargetObject condition="contains">Software\policies\microsoft\windows\control panel\desktop\scrnsave.exe</TargetObject>
        <TargetObject condition="begin with">HKLM\Software\Classes\protocols\filter\</TargetObject>
        <TargetObject condition="begin with">HKLM\Software\Classes\protocols\handler\</TargetObject>
        <TargetObject name="technique_id=T1562.002,technique_name=Disable Windows Event Logging" condition="contains all">\SYSTEM\;\Service\EventLog;Retention</TargetObject>
        <TargetObject name="technique_id=T1562.002,technique_name=Disable Windows Event Logging" condition="contains all">\SYSTEM\;\Service\EventLog;MaxSize</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensions</TargetObject>
        <TargetObject name="technique_id=T1546.012,technique_name=Image File Execution Options Injection" condition="begin with">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options</TargetObject>
        <TargetObject name="technique_id=T1546.012,technique_name=Image File Execution Options Injection" condition="begin with">HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Image File Execution Options</TargetObject>
        <TargetObject condition="contains">\Internet Explorer\Toolbar</TargetObject>
        <TargetObject condition="contains">\Internet Explorer\Extensions</TargetObject>
        <TargetObject condition="contains">\Browser Helper Objects</TargetObject>
        <TargetObject condition="contains">\software\microsoft\internet explorer\desktop\components\Source</TargetObject>
        <TargetObject condition="contains">\software\microsoft\internet explorer\explorer bars\</TargetObject>
        <TargetObject condition="contains">\software\microsoft\internet explorer\Styles\MaxScriptStatements</TargetObject>
        <TargetObject condition="contains">\software\microsoft\internet explorer\toolbar\WebBrowser\ITBarLayout</TargetObject>
        <TargetObject condition="contains">\software\wow6432node\microsoft\internet explorer\toolbar\WebBrowser\ITBarLayout</TargetObject>
        <TargetObject condition="contains">\software\microsoft\internet explorer\urlsearchhooks\</TargetObject>
        <TargetObject condition="contains">HKLM\software\wow6432node\microsoft\internet explorer\urlsearchhooks\</TargetObject>
        <TargetObject name="technique_id=T1547.010,technique_name=Port Monitors" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Print\Monitors</TargetObject>
        <TargetObject condition="begin with">hklm\system\mounteddevices\</TargetObject>
        <TargetObject condition="contains all">hklm\system\;\enum\usb\</TargetObject>
        <TargetObject name="technique_id=T1546.007,technique_name=Netsh Helper DLL" condition="contains">SOFTWARE\Microsoft\Netsh</TargetObject>
        <TargetObject name="technique_id=T1137.006,technique_name=Office Add-ins" condition="contains all">\Microsoft\Office;\Outlook\Addins</TargetObject>
        <TargetObject name="technique_id=T1137.006,technique_name=Office Add-ins" condition="contains">\Software\Microsoft\VSTO\Security\Inclusion</TargetObject>
        <TargetObject name="technique_id=T1137.006,technique_name=Office Add-ins" condition="contains">\Software\Microsoft\VSTO\SolutionMetadata</TargetObject>
        <TargetObject name="technique_name=Outlook Server 95/98 Identity Keys" condition="contains">Identities</TargetObject>
        <TargetObject condition="contains all">SOFTWARE\Microsoft\Office\;\Outlook\Profiles\;\9375CFF0413111d3B88A00104B2A6676\;\Account Name</TargetObject>
        <TargetObject condition="contains all">SOFTWARE\Microsoft\Office\;\Outlook\Profiles\;\9375CFF0413111d3B88A00104B2A6676\;\Display Name</TargetObject>
        <TargetObject condition="contains all">SOFTWARE\Microsoft\Office\;\Outlook\Profiles\;\9375CFF0413111d3B88A00104B2A6676\;\Email</TargetObject>
        <TargetObject condition="contains all">SOFTWARE\Microsoft\Office\;\Outlook\Profiles\;\9375CFF0413111d3B88A00104B2A6676\;\HTTP Password</TargetObject>
        <TargetObject condition="contains all">SOFTWARE\Microsoft\Office\;\Outlook\Profiles\;\9375CFF0413111d3B88A00104B2A6676\;\HTTP User</TargetObject>
        <TargetObject condition="contains all">SOFTWARE\Microsoft\Office\;\Outlook\Profiles\;\9375CFF0413111d3B88A00104B2A6676\;\IMAP Password</TargetObject>
        <TargetObject condition="contains all">SOFTWARE\Microsoft\Office\;\Outlook\Profiles\;\9375CFF0413111d3B88A00104B2A6676\;\IMAP User</TargetObject>
        <TargetObject condition="contains all">SOFTWARE\Microsoft\Office\;\Outlook\Profiles\;\9375CFF0413111d3B88A00104B2A6676\;\MAPI Provider</TargetObject>
        <TargetObject condition="contains all">SOFTWARE\Microsoft\Office\;\Outlook\Profiles\;\9375CFF0413111d3B88A00104B2A6676\;\POP3 Password</TargetObject>
        <TargetObject condition="contains all">SOFTWARE\Microsoft\Office\;\Outlook\Profiles\;\9375CFF0413111d3B88A00104B2A6676\;\POP3 User</TargetObject>
        <TargetObject condition="contains all">SOFTWARE\Microsoft\Office\;\Outlook\Profiles\;\9375CFF0413111d3B88A00104B2A6676\;\SMTP Password</TargetObject>
        <TargetObject condition="contains all">SOFTWARE\Microsoft\Office\;\Outlook\Profiles\;\9375CFF0413111d3B88A00104B2A6676\;\SMTP User</TargetObject>
        <TargetObject name="technique_id=T1137.004,technique_name=Outlook Home Page" condition="contains all">software\microsoft\office\;\outlook\security\</TargetObject>
        <TargetObject name="technique_id=T1137.004,technique_name=Outlook Home Page" condition="contains all">software\microsoft\office\;\outlook\today\</TargetObject>
        <TargetObject name="technique_id=T1137.004,technique_name=Outlook Home Page" condition="contains all">software\microsoft\office\;\outlook\webview\;\</TargetObject>
        <TargetObject condition="contains all">software\microsoft\office\;\word\options\globaldotname</TargetObject>
        <TargetObject condition="contains all">software\microsoft\office\;\common\internet\server cache\</TargetObject>
        <TargetObject condition="contains all">software\;microsoft\office\;\addins\</TargetObject>
        <TargetObject condition="contains all">software\;microsoft\office\;\Common\COM Compatibility</TargetObject>
        <TargetObject condition="contains">\Security\Trusted Documents\TrustRecords</TargetObject>
        <TargetObject condition="contains">\Security\Trusted Documents\</TargetObject>
        <TargetObject condition="end with">\UrlUpdateInfo</TargetObject>
        <TargetObject condition="contains">software\microsoft\windows\currentversion\explorer\recentdocs\.docx\</TargetObject>
        <TargetObject condition="contains">software\microsoft\windows\currentversion\explorer\recentdocs\.xlsx\</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Clients\Mail\Microsoft Outlook\DllPath</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Clients\Mail\Microsoft Outlook\DllPathEx</TargetObject>
        <TargetObject condition="contains">software\microsoft\Office test\special\perf\</TargetObject>
        <TargetObject condition="contains all">software\microsoft\office\;\Options\OPEN</TargetObject>
        <TargetObject name="technique_id=T1137.006,technique_name=Office Add-ins" condition="contains all">\Microsoft\Office;\PowerPoint\Addins</TargetObject>
        <TargetObject name="T1559.002,office" condition="end with">\Word\Security\AllowDDE</TargetObject>
        <TargetObject name="T1559.002,office" condition="end with">\Excel\Security\DisableDDEServerLaunch</TargetObject>
        <TargetObject name="T1559.002,office" condition="end with">\Excel\Security\DisableDDEServerLookup</TargetObject>
        <TargetObject name="T1562,office" condition="end with">\VBAWarnings</TargetObject>
        <TargetObject name="T1562,office" condition="end with">\DisableInternetFilesInPV</TargetObject>
        <TargetObject name="T1562,office" condition="end with">\DisableUnsafeLocationsInPV</TargetObject>
        <TargetObject name="T1562,office" condition="end with">\DisableAttachementsInPV</TargetObject>
        <TargetObject name="technique_id=T1021.001,technique_name=Remote Desktop Protocol" condition="is">HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services\MaxInstanceCount</TargetObject>
        <TargetObject name="technique_id=T1021.001,technique_name=Remote Desktop Protocol" condition="is">HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services\RaunSolicit</TargetObject>
        <TargetObject name="technique_id=T1112,technique_name=Modify Registry" condition="begin with">HKLM\SYSTEM\CurrentControlSet\services\TermService\Parameters\ServiceDll</TargetObject>
        <TargetObject name="technique_id=T1112,technique_name=Modify Registry" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\fSingleSessionPerUser</TargetObject>
        <TargetObject name="technique_id=T1112,technique_name=Modify Registry" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\fDenyTSConnections</TargetObject>
        <TargetObject name="technique_id=T1112,technique_name=Modify Registry" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services\Shadow</TargetObject>
        <TargetObject name="technique_id=T1053,technique_name=Scheduled Task" condition="contains all">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks;Actions</TargetObject>
        <TargetObject name="technique_id=T1053,technique_name=Scheduled Task" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree</TargetObject>
        <TargetObject name="technique_id=T1053,technique_name=Scheduled Task" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\</TargetObject>
        <TargetObject name="technique_id=T1547.005,technique_name=Security Support Provider" condition="contains">SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\LSASS.exe</TargetObject>
        <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services</TargetObject>
        <TargetObject name="technique_id=T1553.003,technique_name=SIP and Trust Provider Hijacking" condition="begin with">HKLM\SOFTWARE\Microsoft\Cryptography\OID</TargetObject>
        <TargetObject name="technique_id=T1553.003,technique_name=SIP and Trust Provider Hijacking" condition="begin with">HKLM\SOFTWARE\WOW6432Node\Microsoft\Cryptography\OID</TargetObject>
        <TargetObject name="technique_id=T1553.003,technique_name=SIP and Trust Provider Hijacking" condition="begin with">HKLM\SOFTWARE\Microsoft\Cryptography\Providers\Trust</TargetObject>
        <TargetObject name="technique_id=T1553.003,technique_name=SIP and Trust Provider Hijacking" condition="begin with">HKLM\SOFTWARE\WOW6432Node\Microsoft\Cryptography\Providers\Trust</TargetObject>
        <TargetObject name="technique_id=T1553.003,technique_name=SIP and Trust Provider Hijacking" condition="begin with">HKLM\SOFTWARE\Microsoft\Cryptography\Offload\ExpoOffload</TargetObject>
        <TargetObject name="technique_id=T1569.002,technique_name=Service Execution" condition="end with">\PsExec\EulaAccepted</TargetObject>
        <TargetObject name="technique_id=T1105,technique_name=Ingress Tool Transfer" condition="end with">\PsFile\EulaAccepted</TargetObject>
        <TargetObject name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="end with">\PsGetSID\EulaAccepted</TargetObject>
        <TargetObject name="technique_id=T1057,technique_name=Process Discovery" condition="end with">\PsInfo\EulaAccepted</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="end with">\PsKill\EulaAccepted</TargetObject>
        <TargetObject name="technique_id=T1057,technique_name=Process Discovery" condition="end with">\PsList\EulaAccepted</TargetObject>
        <TargetObject name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="end with">\PsLoggedOn\EulaAccepted</TargetObject>
        <TargetObject name="technique_id=T1569.002,technique_name=Service Execution" condition="end with">\PsLogList\EulaAccepted</TargetObject>
        <TargetObject name="technique_id=T1098,technique_name=Account Manipulation" condition="end with">\PsPasswd\EulaAccepted</TargetObject>
        <TargetObject name="technique_id=T1569.002,technique_name=Service Execution" condition="end with">\PsService\EulaAccepted</TargetObject>
        <TargetObject name="undefined" condition="end with">\PsShutDown\EulaAccepted</TargetObject>
        <TargetObject name="undefined" condition="end with">\PsSuspend\EulaAccepted</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="contains">SYSTEM\CurrentControlSet\services\SysmonDrv</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="contains">SYSTEM\CurrentControlSet\services\Sysmon</TargetObject>
        <TargetObject name="technique_id=T1547.001,technique_name=Registry Run Keys / Start Folder" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp\InitialProgram</TargetObject>
        <TargetObject name="technique_id=T1547.003,technique_name=Time Providers" condition="contains">HKLM\System\CurrentControlSet\Services\W32Time\TimeProviders</TargetObject>
        <TargetObject name="technique_id=T1218,technique_name=Signed Binary Proxy Execution" condition="begin with">HKLM\Software\Microsoft\WAB\DLLPath</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\Control.exe</TargetObject>
        <TargetObject name="technique_id=T1546.009,technique_name=AppCert DLLs" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\AppCertDlls</TargetObject>
        <TargetObject name="technique_id=T1546.015,technique_name=Component Object Model Hijacking" condition="contains">software\classes\clsid\{083863f1-70de-11d0-bd40-00a0c911ce86}\instance</TargetObject>
        <TargetObject name="technique_id=T1546.015,technique_name=Component Object Model Hijacking" condition="contains">software\classes\clsid\{7ed96837-96f0-4812-b211-f13c24117ed3}\instance</TargetObject>
        <Rule groupRelation="and">
          <TargetObject name="technique_id=T1125,technique_name=Video Capture" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\webcam</TargetObject>
          <Image condition="excludes">Google\Chrome\Application\chrome.exe</Image>
          <Image condition="excludes">Zoom\bin\Zoom.exe</Image>
          <Image condition="excludes">slack\slack.exe</Image>
          <Image condition="excludes">Mozilla Firefox\firefox.exe</Image>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject name="technique_id=T1123,technique_name=Audio Capture" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\microphone</TargetObject>
          <Image condition="excludes">Google\Chrome\Application\chrome.exe</Image>
          <Image condition="excludes">Zoom\bin\Zoom.exe</Image>
          <Image condition="excludes">slack\slack.exe</Image>
          <Image condition="excludes">Mozilla Firefox\firefox.exe</Image>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject name="technique_id=T1123,technique_name=Audio Capture" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\bluetooth</TargetObject>
          <Image condition="excludes">Google\Chrome\Application\chrome.exe</Image>
          <Image condition="excludes">Zoom\bin\Zoom.exe</Image>
          <Image condition="excludes">slack\slack.exe</Image>
          <Image condition="excludes">Mozilla Firefox\firefox.exe</Image>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject name="technique_id=T1005,technique_name=Data from Local System" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\usb</TargetObject>
          <Image condition="excludes">Google\Chrome\Application\chrome.exe</Image>
          <Image condition="excludes">Zoom\bin\Zoom.exe</Image>
          <Image condition="excludes">slack\slack.exe</Image>
          <Image condition="excludes">Mozilla Firefox\firefox.exe</Image>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject name="technique_id=T1005,technique_name=Data from Local System" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\location</TargetObject>
          <Image condition="excludes">Google\Chrome\Application\chrome.exe</Image>
          <Image condition="excludes">Zoom\bin\Zoom.exe</Image>
          <Image condition="excludes">slack\slack.exe</Image>
          <Image condition="excludes">Mozilla Firefox\firefox.exe</Image>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject name="technique_id=T1005,technique_name=Data from Local System" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\contacts</TargetObject>
          <Image condition="excludes">Google\Chrome\Application\chrome.exe</Image>
          <Image condition="excludes">Zoom\bin\Zoom.exe</Image>
          <Image condition="excludes">slack\slack.exe</Image>
          <Image condition="excludes">Mozilla Firefox\firefox.exe</Image>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject name="technique_id=T1056.001,technique_name=Input Capture - Keylogging" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\humanInterfaceDevice</TargetObject>
          <Image condition="excludes">Google\Chrome\Application\chrome.exe</Image>
          <Image condition="excludes">Zoom\bin\Zoom.exe</Image>
          <Image condition="excludes">slack\slack.exe</Image>
          <Image condition="excludes">Mozilla Firefox\firefox.exe</Image>
        </Rule>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\Credential Provider</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\Plap Providers</TargetObject>
        <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa</TargetObject>
        <TargetObject name="technique_id=T1003,technique_name=Credential Dumping" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\</TargetObject>
        <TargetObject name="technique_id=T1003,technique_name=Credential Dumping" condition="contains">\Control\SecurityProviders\WDigest</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\AntiVirusDisableNotify</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\DisableAntiSpyware</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\DisableAntiVirus</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableBehaviorMonitoring</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableOnAccessProtection</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableScanOnRealtimeEnable</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableIOAVProtection</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableRealtimeMonitoring</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet\SpyNetReporting</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="contains all">HKLM\software\microsoft\microsoft antimalware\exclusions\</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\software\microsoft\Windows Advanced Threat Protection\TelLib</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\software\policies\microsoft\windows advanced threat protection\</TargetObject>
        <Rule groupRelation="and">
          <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\Sense</TargetObject>
          <Details condition="contains">DWORD (0x00000004)</Details>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\WinDefend</TargetObject>
          <Details condition="contains">DWORD (0x00000004)</Details>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\MsMpSvc</TargetObject>
          <Details condition="contains">DWORD (0x00000004)</Details>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\NisSrv</TargetObject>
          <Details condition="contains">DWORD (0x00000004)</Details>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\WdBoot</TargetObject>
          <Details condition="contains">DWORD (0x00000004)</Details>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\WdNisDrv</TargetObject>
          <Details condition="contains">DWORD (0x00000004)</Details>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\WdNisSvc</TargetObject>
          <Details condition="contains">DWORD (0x00000004)</Details>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\wscsvc</TargetObject>
          <Details condition="contains">DWORD (0x00000004)</Details>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\SecurityHealthService</TargetObject>
          <Details condition="contains">DWORD (0x00000004)</Details>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\wuauserv</TargetObject>
          <Details condition="contains">DWORD (0x00000004)</Details>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\UsoSvc</TargetObject>
          <Details condition="contains">DWORD (0x00000004)</Details>
        </Rule>
        <TargetObject condition="begin with">hklm\software\microsoft\windows script\settings\amsienable</TargetObject>
        <TargetObject condition="contains">\software\microsoft\windows script\settings\amsienable</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile\AuthorizedApplications\List</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\FirewallDisableNotify</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\FirewallOverride</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\software\policies\microsoft\windowsfirewall\;\authorizedapplications</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\software\policies\microsoft\windowsfirewall\;\authorizedapplications\list</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\software\policies\microsoft\windowsfirewall\;\globallyopenports</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT</TargetObject>
        <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Safeboot</TargetObject>
        <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\Winlogon</TargetObject>
        <TargetObject condition="end with">\FriendlyName</TargetObject>
        <TargetObject condition="is">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\InProgress\(Default)</TargetObject>
        <Rule groupRelation="and">
          <TargetObject name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System</TargetObject>
          <Image condition="is not">C:\Windows\System32\svchost.exe</Image>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="contains">\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System</TargetObject>
          <Image condition="is not">C:\Windows\System32\svchost.exe</Image>
        </Rule>
        <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Control\NetworkProvider\Order</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles</TargetObject>
        <TargetObject name="technique_id=T1547.010,technique_name=Boot or Logon Autostart Execution - Port Monitors" condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Ports</TargetObject>
        <TargetObject name="technique_id=T1547.010,technique_name=Boot or Logon Autostart Execution - Port Monitors" condition="contains">\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Ports</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ModuleLogging</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\Transcription</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="contains all">software\microsoft\powershell\;\shellids\microsoft.powershell\executionpolicy</TargetObject>
        <TargetObject name="technique_id=T1553.004,technique_name=Install Root Certificate" condition="begin with">HKLM\SOFTWARE\Microsoft\EnterpriseCertificates\Root\Certificates</TargetObject>
        <TargetObject name="technique_id=T1553.004,technique_name=Install Root Certificate" condition="contains">\Microsoft\SystemCertificates\Root\Certificates</TargetObject>
        <TargetObject name="technique_id=T1553.004,technique_name=Install Root Certificate" condition="contains">\Microsoft\SystemCertificates\CA\Certificates</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\AllAlertsDisabled</TargetObject>
        <TargetObject name="technique_id=T1562.001,technique_name=Disable or Modify Tools" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\DisableMonitoring</TargetObject>
        <TargetObject condition="contains">\Classes\AllFilesystemObjects</TargetObject>
        <TargetObject condition="contains">\Classes\Directory</TargetObject>
        <TargetObject condition="contains">\Classes\Drive</TargetObject>
        <TargetObject condition="contains">\Classes\Folder</TargetObject>
        <TargetObject condition="contains">\ShellEx\ContextMenuHandlers</TargetObject>
        <TargetObject condition="contains">\CurrentVersion\Shell</TargetObject>
        <TargetObject condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\explorer\ShellExecuteHooks</TargetObject>
        <TargetObject condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\explorer\ShellServiceObject</TargetObject>
        <TargetObject name="technique_id=T1210,technique_name=Exploitation of Remote Services" condition="contains all">HKLM\SOFTWARE\Microsoft\Windows;\CurrentVersion\Print\Connections</TargetObject>
        <TargetObject name="technique_id=T1210,technique_name=Exploitation of Remote Services" condition="contains all">HKLM\System;\control\print\monitors</TargetObject>
        <TargetObject name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="contains">\Software\Classes\AppX82a6gwre4fdg3bt635tn5ctqjf8msdd2\Shell\open\command</TargetObject>
        <TargetObject condition="contains">{AB8902B4-09CA-4bb6-B78D-A8F59079A8D5}</TargetObject>
        <TargetObject name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA</TargetObject>
        <TargetObject name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\LocalAccountTokenFilterPolicy</TargetObject>
        <TargetObject condition="begin with">HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\DontDisplayLastUsername</TargetObject>
        <TargetObject name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\UacDisableNotify</TargetObject>
        <TargetObject name="technique_id=T1548.002,technique_name=Bypass User Access Control" condition="begin with">HKLM\SOFTWARE\Microsoft\Security Center\UpdatesDisableNotify</TargetObject>
        <TargetObject name="UACMe Dir Prep" condition="contains all">HKU;Environment</TargetObject>
        <TargetObject name="UACMe Dir Prep" condition="contains all">HKLM;Environment</TargetObject>
        <TargetObject condition="is">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Setup\ServiceStartup</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Services\Pending\</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update\PostRebootReporting\</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update\RebootRequired\</TargetObject>
        <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services\WinSock</TargetObject>
        <TargetObject condition="end with">\ProxyServer</TargetObject>
        <TargetObject name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains">SYSTEM\CurrentControlSet\Control\CrashControl</TargetObject>
        <TargetObject name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains all">HKLM\SYSTEM\;Control\WMI\autologger\senseauditlogger</TargetObject>
        <TargetObject name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains all">HKLM\SYSTEM\;Control\WMI\autologger\senseeventlog</TargetObject>
        <TargetObject name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains all">HKLM\SYSTEM\;Control\WMI\EtwMaxLoggers</TargetObject>
        <TargetObject name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="contains all">HKLM\SYSTEM\;Control\WMI\Security</TargetObject>
      </RegistryEvent>
    </RuleGroup>
    <!-- Event ID 12,13,14 == RegObject added/deleted, RegValue Set, RegObject Renamed - Excludes -->
    <RuleGroup groupRelation="or">
      <RegistryEvent onmatch="exclude">
        <!-- NinjaRMM - Esclusione totale per tutte le modifiche al registro -->
        <Image condition="contains">\NinjaRMMAgent\</Image>
        <!-- ADSelfServicePlus - Esclusione totale per tutte le modifiche al registro -->
        <Image condition="contains">ADSelfServicePlus</Image>
        <!-- TeamViewer - Esclusione totale per tutte le modifiche al registro (software principale di gestione remota) -->
        <Image condition="contains">\TeamViewer\</Image>
        <!-- Veeam - Esclusione totale per tutte le modifiche al registro (software critico di backup) -->
        <Image condition="contains">\Veeam\</Image>
        
        <!-- Cisco Webex/Spark autostart registry entry via msiexec -->
        <Rule groupRelation="and">
          <Image condition="is">C:\WINDOWS\system32\msiexec.exe</Image>
          <TargetObject condition="contains all">Software\Microsoft\Windows\CurrentVersion\Run;CiscoSpark</TargetObject>
          <Details condition="contains">Webex.lnk</Details>
          <User condition="is">NT AUTHORITY\SYSTEM</User>
        </Rule>
        
        <!-- PsShutdown - Microsoft Sysinternals legitimate shutdown tool service registration -->
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\System32\services.exe</Image>
          <TargetObject condition="contains all">HKLM\System\CurrentControlSet\Services\PsShutdown</TargetObject>
        </Rule>
        <!-- PsShutdown service executable PSSDNSVC.EXE -->
        <Image condition="is">C:\Windows\PSSDNSVC.EXE</Image>
        <Image condition="is">C:\Program Files (x86)\Cisco\Cisco AnyConnect Secure Mobility Client\aciseposture.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Cisco\Cisco AnyConnect Secure Mobility Client\vpnagent.exe</Image>
        <Image condition="is">C:\Program Files\Cylance\Optics\CyOptics.exe</Image>
        <Image condition="is">C:\Program Files\Cylance\Desktop\CylanceSvc.exe</Image>
        <Rule groupRelation="and">
          <Image condition="contains">svchost.exe</Image>
          <TargetObject condition="begin with">HKLM\System\CurrentControlSet\Services\Tcpip\Parameters\DNSRegisteredAdapters</TargetObject>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains">svchost.exe</Image>
          <TargetObject condition="begin with">HKLM\System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces</TargetObject>
        </Rule>
        <TargetObject condition="end with">Toolbar\WebBrowser</TargetObject>
        <TargetObject condition="end with">Toolbar\WebBrowser\ITBar7Height</TargetObject>
        <TargetObject condition="end with">Toolbar\ShellBrowser\ITBar7Layout</TargetObject>
        <TargetObject condition="end with">Internet Explorer\Toolbar\Locked</TargetObject>
        <TargetObject condition="end with">ShellBrowser</TargetObject>
        <Image condition="is">C:\Program Files (x86)\Ivanti\Workspace Control\pfwsmgr.exe</Image>
        <Image condition="is">C:\Program Files\RES Software\Workspace Manager\pfwsmgr.exe</Image>
        <Image condition="begin with">C:\Program Files (x86)\Kaspersky Lab\Kaspersky Internet Security </Image>
        <Image condition="begin with">C:\Program Files\Kaspersky Lab\Kaspersky Internet Security </Image>
        <Image condition="is">C:\Program Files\McAfee\Endpoint Encryption Agent\MfeEpeHost.exe</Image>
        <Image condition="is">C:\Program Files\McAfee\Endpoint Security\Adaptive Threat Protection\mfeatp.exe</Image>
        <Image condition="is">C:\Program Files\McAfee\Endpoint Security\Endpoint Security Platform\mfeesp.exe</Image>
        <Image condition="is">C:\Program Files\Common Files\McAfee\Engine\AMCoreUpdater\amupdate.exe</Image>
        <Image condition="is">C:\Program Files\McAfee\Agent\masvc.exe</Image>
        <Image condition="is">C:\Program Files\McAfee\Agent\x86\mfemactl.exe</Image>
        <Image condition="is">C:\Program Files\McAfee\Agent\x86\McScript_InUse.exe</Image>
        <Image condition="is">C:\Program Files\McAfee\Agent\x86\macompatsvc.exe</Image>
        <Image condition="is">C:\Program Files\McAfee\Endpoint Security\Threat Prevention\mfeensppl.exe</Image>
        <Image condition="begin with">C:\Program Files\Common Files\McAfee\Engine\scanners</Image>
        <Image condition="is">C:\Program Files\Common Files\McAfee\AVSolution\mcshield.exe</Image>
        <Image condition="is">C:\Program Files\Windows Defender Advanced Threat Protection\MsSense.exe</Image>
        <Image condition="is">C:\Program Files\Windows Defender Advanced Threat Protection\SenseCncProxy.exe</Image>
        <Image condition="is">C:\Program Files\Windows Defender Advanced Threat Protection\SenseIR.exe</Image>
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files\Microsoft Monitoring Agent\Agent\HealthService.exe</Image>
          <TargetObject condition="begin with">HKLM\System\CurrentControlSet\Services\HealthService\Parameters\Management Groups</TargetObject>
        </Rule>
        <TargetObject condition="contains">\{CAFEEFAC-</TargetObject>
        <EventType condition="is">CreateKey</EventType>
        <TargetObject condition="begin with">HKLM\COMPONENTS</TargetObject>
        <Image condition="is">C:\Program Files\ownCloud\owncloud.exe</Image>
        <Image condition="is">C:\Program Files (x86)\ownCloud\owncloud.exe</Image>
        <Rule groupRelation="and">
          <Image condition="contains">svchost.exe</Image>
          <TargetObject condition="begin with">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks</TargetObject>
        </Rule>
        <Image condition="begin with">C:\Program Files\SentinelOne\Sentinel Agent</Image>
        <Image condition="is">System</Image>
        <Rule groupRelation="and">
          <Image condition="is">C:\Program Files\VMware\VMware Tools\vmtoolsd.exe</Image>
          <TargetObject condition="is">HKLM\System\CurrentControlSet\Services\Tcpip\Parameters</TargetObject>
        </Rule>
        <Image condition="is">C:\Program Files (x86)\Webroot\WRSA.exe</Image>
        <Image condition="is">C:\Program Files\WIDCOMM\Bluetooth Software\btwdins.exe</Image>
        <TargetObject condition="end with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Audit</TargetObject>
        <TargetObject condition="end with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Audit\AuditPolicy</TargetObject>
        <TargetObject condition="end with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Audit\PerUserAuditing\System</TargetObject>
        <TargetObject condition="end with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\SspiCache</TargetObject>
        <TargetObject condition="end with">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Kerberos\Domains</TargetObject>
        <TargetObject condition="end with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\Audit</TargetObject>
        <TargetObject condition="contains">\OpenWithProgids</TargetObject>
        <TargetObject condition="end with">\OpenWithList</TargetObject>
        <TargetObject condition="end with">\UserChoice</TargetObject>
        <TargetObject condition="end with">\UserChoice\ProgId</TargetObject>
        <TargetObject condition="end with">\UserChoice\Hash</TargetObject>
        <TargetObject condition="end with">\OpenWithList\MRUList</TargetObject>
        <TargetObject condition="end with">} 0xFFFF</TargetObject>
        <Image condition="end with">Office\root\integration\integrator.exe</Image>
        <Image condition="is">C:\WINDOWS\system32\backgroundTaskHost.exe</Image>
        <Image condition="is">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeClickToRun.exe</Image>
        <Image condition="is">C:\Program Files\Windows Defender\MsMpEng.exe</Image>
        <Image condition="is">C:\Windows\SystemApps\Microsoft.Windows.Cortana_cw5n1h2txyewy\SearchUI.exe</Image>
        <Image condition="is">C:\Program Files\Microsoft Application Virtualization\Client\AppVClient.exe</Image>
        <TargetObject condition="end with">\CurrentVersion\App Paths</TargetObject>
        <TargetObject condition="end with">\CurrentVersion\Image File Execution Options</TargetObject>
        <TargetObject condition="end with">\CurrentVersion\Shell Extensions\Cached</TargetObject>
        <TargetObject condition="end with">\CurrentVersion\Shell Extensions\Approved</TargetObject>
        <TargetObject condition="end with">}\PreviousPolicyAreas</TargetObject>
        <TargetObject condition="contains">\Control\WMI\Autologger\</TargetObject>
        <TargetObject condition="end with">HKLM\SYSTEM\CurrentControlSet\Services\UsoSvc\Start</TargetObject>
        <TargetObject condition="end with">\Lsa\OfflineJoin\CurrentValue</TargetObject>
        <TargetObject condition="end with">\Components\TrustedInstaller\Events</TargetObject>
        <TargetObject condition="end with">\Components\TrustedInstaller</TargetObject>
        <TargetObject condition="end with">\Components\Wlansvc</TargetObject>
        <TargetObject condition="end with">\Components\Wlansvc\Events</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\S-1-5-18\</TargetObject>
        <TargetObject condition="end with">\Directory\shellex</TargetObject>
        <TargetObject condition="end with">\Directory\shellex\DragDropHandlers</TargetObject>
        <TargetObject condition="end with">\Drive\shellex</TargetObject>
        <TargetObject condition="end with">\Drive\shellex\DragDropHandlers</TargetObject>
        <TargetObject condition="contains">_Classes\AppX</TargetObject>
        <TargetObject condition="begin with">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\</TargetObject>
        <TargetObject condition="contains all">SOFTWARE;\Microsoft\EnterpriseCertificates\Disallowed</TargetObject>
        <TargetObject condition="contains all">SOFTWARE;\Microsoft\SystemCertificates\Disallowed</TargetObject>
        <TargetObject condition="contains">Software\Microsoft\Windows\CurrentVersion\WinTrust\Trust Providers\Software Publishing</TargetObject>
        <TargetObject condition="is">HKLM\SOFTWARE\Policies\Microsoft\SystemCertificates\Root\Certificates</TargetObject>
        <Image condition="is">C:\Windows\SystemApps\Microsoft.Windows.Cortana_cw5n1h2txyewy\SearchUI.exe</Image>
        <Image condition="begin with">C:\$WINDOWS.~BT\</Image>
        <TargetObject condition="is">HKLM\System\CurrentControlSet\Services\Tcpip\Parameters</TargetObject>
        <Rule groupRelation="and">
          <Image condition="is">C:\Windows\system32\lsass.exe</Image>
          <TargetObject condition="contains">HKLM\System\CurrentControlSet\Services</TargetObject>
        </Rule>
        <Rule groupRelation="and">
          <TargetObject condition="contains">SOFTWARE\Microsoft\Windows\CurrentVersion\DeliveryOptimization</TargetObject>
          <Image condition="is">C:\Windows\System32\svchost.exe</Image>
        </Rule>
        <TargetObject condition="is">HKLM\System\CurrentControlSet\Services\W32Time\Config\LastKnownGoodTime</TargetObject>
        <TargetObject condition="is">HKLM\System\CurrentControlSet\Services\SmsRouter\State\Registration\Ids</TargetObject>
        <TargetObject condition="end with">\services\clr_optimization_v2.0.50727_32\Start</TargetObject>
        <TargetObject condition="end with">\services\clr_optimization_v2.0.50727_64\Start</TargetObject>
        <TargetObject condition="end with">\services\clr_optimization_v4.0.30319_32\Start</TargetObject>
        <TargetObject condition="end with">\services\clr_optimization_v4.0.30319_64\Start</TargetObject>
        <TargetObject condition="end with">\services\DeviceAssociationService\Start</TargetObject>
        <TargetObject condition="end with">\services\BITS\Start</TargetObject>
        <TargetObject condition="end with">\services\TrustedInstaller\Start</TargetObject>
        <TargetObject condition="end with">\services\tunnel\Start</TargetObject>
        <TargetObject condition="end with">\services\UsoSvc\Start</TargetObject>
      </RegistryEvent>
    </RuleGroup>
    <!-- Event ID 15 == FileStream Created - Includes -->
    <RuleGroup groupRelation="or">
      <FileCreateStreamHash onmatch="include">
        <TargetFilename condition="contains">Temp\7z</TargetFilename>
        <TargetFilename condition="end with">.bat</TargetFilename>
        <TargetFilename condition="end with">.cmd</TargetFilename>
        <TargetFilename condition="end with">Temp\debug.bin</TargetFilename>
        <TargetFilename condition="end with">.dll</TargetFilename>
        <TargetFilename condition="end with">.exe</TargetFilename>
        <TargetFilename condition="end with">.hta</TargetFilename>
        <Rule name="technique_id=T1189,technique_name=Drive-by Compromise" groupRelation="and">
          <TargetFilename condition="end with">:Zone.Identifier</TargetFilename>
          <Contents condition="contains any">blob:;about:internet</Contents>
        </Rule>
        <TargetFilename condition="end with">.lnk</TargetFilename>
        <TargetFilename condition="contains">Content.Outlook</TargetFilename>
        <TargetFilename name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">.ps1</TargetFilename>
        <TargetFilename name="technique_id=T1059.001,technique_name=PowerShell" condition="end with">.ps2</TargetFilename>
        <TargetFilename condition="end with">.reg</TargetFilename>
        <TargetFilename condition="contains">Downloads</TargetFilename>
        <TargetFilename condition="contains">AppData</TargetFilename>
        <TargetFilename condition="contains">Temp</TargetFilename>
        <TargetFilename condition="contains">ProgramData</TargetFilename>
        <TargetFilename condition="contains">Users</TargetFilename>
        <TargetFilename condition="end with">.vb</TargetFilename>
        <TargetFilename condition="end with">.vbe</TargetFilename>
        <TargetFilename condition="end with">.vbs</TargetFilename>
      </FileCreateStreamHash>
    </RuleGroup>
    <!-- Event ID 17,18 == PipeEvent. Log Named pipe created & Named pipe connected - Includes -->
    <RuleGroup groupRelation="or">
      <PipeEvent onmatch="include">
        <Rule groupRelation="and">
          <PipeName condition="begin with">\</PipeName>
          <EventType>CreatePipe</EventType>
        </Rule>
        <PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\atsvc</PipeName>
        <Rule groupRelation="and">
          <PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\msse-</PipeName>
          <PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="end with">-server</PipeName>
        </Rule>
        <PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\msagent_</PipeName>
        <PipeName name="technique_id=T1055; Possible Cobalt Strike post-exploitation jobs." condition="begin with">\postex_</PipeName>
        <PipeName name="technique_id=T1021.004,technique_name=Remote Services: SSH" condition="begin with">\postex_ssh_</PipeName>
        <PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\status_</PipeName>
        <PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\gruntsvc</PipeName>
        <PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\svcctl</PipeName>
        <PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\msf-pipe</PipeName>
        <Rule groupRelation="and">
          <PipeName name="technique_id=T1059.001,technique_name=PowerShell" condition="begin with">\PSHost</PipeName>
          <Image condition="is not">powershell.exe</Image>
        </Rule>
        <Rule groupRelation="and">
          <PipeName name="technique_id=T1059.001,technique_name=PowerShell" condition="begin with">\PSHost</PipeName>
          <Image condition="is not">powershell_ise.exe</Image>
        </Rule>
        <PipeName name="technique_id=T1021.002,technique_name=SMB/Windows Admin Shares" condition="begin with">\PSEXESVC</PipeName>
        <PipeName name="technique_id=T1049,technique_name=System Network Connections Discovery" condition="begin with">\srvsvc</PipeName>
        <Rule groupRelation="and">
          <PipeName condition="begin with">\TSVCPIPE</PipeName>
        </Rule>
        <PipeName name="technique_id=T1033,technique_name=System Owner/User Discovery" condition="begin with">\winreg</PipeName>
      </PipeEvent>
    </RuleGroup>
    <!-- Event ID 17,18 == PipeEvent. Log Named pipe created & Named pipe connected - Excludes -->
    <RuleGroup groupRelation="or">
      <PipeEvent onmatch="exclude">
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Common Files\Adobe\ARM\1.0\AdobeARM.exe</Image>
          <PipeName condition="begin with">\32B6B37A-4A7D-4e00-95F2-</PipeName>
          <PipeName condition="end with">thsnYaVieBoda</PipeName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Adobe\Acrobat Reader DC\Reader\AcroCEF\RdrCEF.exe</Image>
          <PipeName condition="begin with">\com.adobe.reader.rna.;\mojo</PipeName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Common Files\Adobe\AdobeGCClient\AGMService.exe</Image>
          <PipeName condition="begin with">\gc_pipe_</PipeName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Common Files\Adobe\Creative Cloud Libraries\libs\node.exe</Image>
          <PipeName condition="begin with">\uv\</PipeName>
        </Rule>
        <Image condition="is">"C:\Program Files\Microsoft Monitoring Agent\Agent\MonitoringHost.exe"</Image>
        <Rule groupRelation="and">
          <Image condition="contains all"> C:\Users\;\AppData\Local\Programs\Call Manager\Call Manager.exe</Image>
          <PipeName condition="begin with">\crashpad_;\mojo.;\uv\</PipeName>
        </Rule>
        <Image condition="contains all">C:\Program Files;\Citrix\ICA Client\SelfServicePlugin\SelfService.exe</Image>
        <Image condition="contains all">C:\Program Files;\Citrix\ICA Client\Receiver\Receiver.exe</Image>
        <Image condition="contains all">C:\Program Files;\Citrix\ICA Client\wfcrun32.exe</Image>
        <Image condition="contains all">C:\Program Files;\Citrix\ICA Client\concentr.exe</Image>
        <Image condition="contains all">C:\Users\;\AppData\Local\Citrix\ICA Client\receiver\Receiver.exe</Image>
        <Image condition="contains all">C:\Users\;\AppData\Local\Citrix\ICA Client\SelfServicePlugin\SelfService.exe</Image>
        <Image condition="contains all">C:\Program Files;\FireEye\xagt\xagt.exe</Image>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Google\Update\Install\;setup.exe</Image>
          <PipeName condition="begin with">\crashpad_</PipeName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Google\Chrome\Application\chrome.exe</Image>
          <PipeName condition="begin with">\mojo.</PipeName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Google\Chrome\Application\;\Installer\chrmstp.exe</Image>
          <PipeName condition="begin with">\crashpad_</PipeName>
        </Rule>
        <PipeName condition="begin with">\Vivisimo Velocity</PipeName>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Microsoft\Edge\Application\msedge.exe</Image>
          <PipeName condition="begin with">\LOCAL\mojo.</PipeName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Microsoft\Edge\Application\msedge.exe</Image>
          <PipeName condition="begin with">\LOCAL\chrome.sync.</PipeName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Microsoft\Edge\Application\msedge.exe</Image>
          <PipeName condition="begin with">\LOCAL\crashpad_</PipeName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office16\OUTLOOK.EXE</Image>
          <PipeName condition="is">\MsFteWds</PipeName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Users\;\AppData\Local\Microsoft\Teams\current\Teams.exe</Image>
          <PipeName condition="begin with">\mojo.</PipeName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Users\;\AppData\Local\Microsoft\Teams\current\Teams.exe</Image>
          <PipeName condition="begin with">\chrome.sync.</PipeName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Mozilla Firefox\firefox.exe</Image>
          <PipeName condition="begin with">\cubeb-pipe-</PipeName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Mozilla Firefox\firefox.exe</Image>
          <PipeName condition="begin with">\chrome.</PipeName>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains all">C:\Program Files;\Mozilla Firefox\firefox.exe</Image>
          <PipeName condition="begin with">\gecko-crash-server-pipe.</PipeName>
        </Rule>
        <PipeName condition="is">\SQLLocal\MSSQLSERVER</PipeName>
        <PipeName condition="is">\SQLLocal\INSTANCE01</PipeName>
        <PipeName condition="is">\SQLLocal\SQLEXPRESS</PipeName>
        <PipeName condition="is">\SQLLocal\COMMVAULT</PipeName>
        <PipeName condition="is">\SQLLocal\RTCLOCAL</PipeName>
        <PipeName condition="is">\SQLLocal\RTC</PipeName>
        <PipeName condition="is">\SQLLocal\TMSM</PipeName>
        <Image condition="is">Program Files (x86)\Microsoft SQL Server\110\DTS\binn\dtexec.exe</Image>
        <Image condition="end with">PostgreSQL\9.6\bin\postgres.exe</Image>
        <PipeName condition="contains">\pgsignal_</PipeName>
        <Image condition="is">Program Files\Qlik\Sense\Engine\Engine.exe</Image>
        <Image condition="contains all">C:\Program Files;\Qualys\QualysAgent\QualysAgent.exe</Image>
        <Image condition="end with">Program Files\SplunkUniversalForwarder\bin\splunkd.exe</Image>
        <Image condition="end with">Program Files\SplunkUniversalForwarder\bin\splunk.exe</Image>
        <Image condition="end with">Program Files\SplunkUniversalForwarder\bin\splunk-MonitorNoHandle.exe</Image>
        <Image condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\CMAgent\OfcCMAgent.exe</Image>
        <Image condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\web\service\ofcservice.exe</Image>
        <Image condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\Web\Service\DbServer.exe</Image>
        <Image condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\web\service\verconn.exe</Image>
        <Image condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\WEB_OSCE\WEB\CGI\cgiOnClose.exe</Image>
        <Image condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\WEB_OSCE\WEB\CGI\cgiRqHotFix.exe</Image>
        <Image condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\LWCS\LWCSService.exe</Image>
        <Image condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\WSS\iCRCService.exe</Image>
        <Image condition="end with">Program Files\Trend\SPROTECT\x64\tsc.exe</Image>
        <Image condition="end with">Program Files\Trend\SPROTECT\x64\tsc64.exe</Image>
        <Image condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\web\service\osceintegrationservice.exe</Image>
        <Image condition="end with">Program Files (x86)\Trend Micro\OfficeScan\PCCSRV\web\service\OfcLogReceiverSvc.exe</Image>
        <PipeName condition="is">\Trend Micro OSCE Command Handler Manager</PipeName>
        <PipeName condition="is">\Trend Micro OSCE Command Handler2 Manager</PipeName>
        <PipeName condition="is">\Trend Micro Endpoint Encryption ToolBox Command Handler Manager</PipeName>
        <PipeName condition="is">\OfcServerNamePipe</PipeName>
        <PipeName condition="is">\ntapvsrq</PipeName>
        <PipeName condition="is">\srvsvc</PipeName>
        <PipeName condition="is">\wkssvc</PipeName>
        <PipeName condition="is">\lsass</PipeName>
        <PipeName condition="is">\winreg</PipeName>
        <PipeName condition="is">\spoolss</PipeName>
        <PipeName condition="contains">Anonymous Pipe</PipeName>
        <Image condition="is">c:\windows\system32\inetsrv\w3wp.exe</Image>
      </PipeEvent>
    </RuleGroup>
    <!-- Event ID 19,20,21, == WmiEvent. Log all WmiEventFilter, WmiEventConsumer, WmiEventConsumerToFilter activity - Includes -->
    <RuleGroup groupRelation="or">
      <WmiEvent onmatch="include">
        <Operation name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="is">Created</Operation>
      </WmiEvent>
    </RuleGroup>
    <!-- Event ID 22 == DNS Queries and their results Excludes -->
    <RuleGroup groupRelation="or">
      <!--Default to log all and exclude a few common processes-->
      <DnsQuery onmatch="exclude">
        <QueryName condition="end with">.1rx.io</QueryName>
        <QueryName condition="end with">.2mdn.net</QueryName>
        <QueryName condition="end with">.adadvisor.net</QueryName>
        <QueryName condition="end with">.adap.tv</QueryName>
        <QueryName condition="end with">.addthis.com</QueryName>
        <QueryName condition="end with">.adform.net</QueryName>
        <QueryName condition="end with">.adnxs.com</QueryName>
        <QueryName condition="end with">.adroll.com</QueryName>
        <QueryName condition="end with">.adrta.com</QueryName>
        <QueryName condition="end with">.adsafeprotected.com</QueryName>
        <QueryName condition="end with">.adsrvr.org</QueryName>
        <QueryName condition="end with">.advertising.com</QueryName>
        <QueryName condition="end with">.amazon-adsystem.com</QueryName>
        <QueryName condition="end with">.analytics.yahoo.com</QueryName>
        <QueryName condition="end with">.aol.com</QueryName>
        <QueryName condition="end with">.betrad.com</QueryName>
        <QueryName condition="end with">.bidswitch.net</QueryName>
        <QueryName condition="end with">.casalemedia.com</QueryName>
        <QueryName condition="end with">.chartbeat.net</QueryName>
        <QueryName condition="end with">.cnn.com</QueryName>
        <QueryName condition="end with">.convertro.com</QueryName>
        <QueryName condition="end with">.criteo.com</QueryName>
        <QueryName condition="end with">.criteo.net</QueryName>
        <QueryName condition="end with">.crwdcntrl.net</QueryName>
        <QueryName condition="end with">.demdex.net</QueryName>
        <QueryName condition="end with">.domdex.com</QueryName>
        <QueryName condition="end with">.dotomi.com</QueryName>
        <QueryName condition="end with">.doubleclick.net</QueryName>
        <QueryName condition="end with">.doubleverify.com</QueryName>
        <QueryName condition="end with">.emxdgt.com</QueryName>
        <QueryName condition="end with">.exelator.com</QueryName>
        <QueryName condition="end with">.google-analytics.com</QueryName>
        <QueryName condition="end with">.googleadservices.com</QueryName>
        <QueryName condition="end with">.googlesyndication.com</QueryName>
        <QueryName condition="end with">.googletagmanager.com</QueryName>
        <QueryName condition="end with">.googlevideo.com</QueryName>
        <QueryName condition="end with">.gstatic.com</QueryName>
        <QueryName condition="end with">.gvt1.com</QueryName>
        <QueryName condition="end with">.gvt2.com</QueryName>
        <QueryName condition="end with">.ib-ibi.com</QueryName>
        <QueryName condition="end with">.jivox.com</QueryName>
        <QueryName condition="end with">.mathtag.com</QueryName>
        <QueryName condition="end with">.moatads.com</QueryName>
        <QueryName condition="end with">.moatpixel.com</QueryName>
        <QueryName condition="end with">.mookie1.com</QueryName>
        <QueryName condition="end with">.myvisualiq.net</QueryName>
        <QueryName condition="end with">.netmng.com</QueryName>
        <QueryName condition="end with">.nexac.com</QueryName>
        <QueryName condition="end with">.openx.net</QueryName>
        <QueryName condition="end with">.optimizely.com</QueryName>
        <QueryName condition="end with">.outbrain.com</QueryName>
        <QueryName condition="end with">.pardot.com</QueryName>
        <QueryName condition="end with">.phx.gbl</QueryName>
        <QueryName condition="end with">.pinterest.com</QueryName>
        <QueryName condition="end with">.pubmatic.com</QueryName>
        <QueryName condition="end with">.quantcount.com</QueryName>
        <QueryName condition="end with">.quantserve.com</QueryName>
        <QueryName condition="end with">.revsci.net</QueryName>
        <QueryName condition="end with">.rfihub.net</QueryName>
        <QueryName condition="end with">.rlcdn.com</QueryName>
        <QueryName condition="end with">.rubiconproject.com</QueryName>
        <QueryName condition="end with">.scdn.co</QueryName>
        <QueryName condition="end with">.scorecardresearch.com</QueryName>
        <QueryName condition="end with">.serving-sys.com</QueryName>
        <QueryName condition="end with">.sharethrough.com</QueryName>
        <QueryName condition="end with">.simpli.fi</QueryName>
        <QueryName condition="end with">.sitescout.com</QueryName>
        <QueryName condition="end with">.smartadserver.com</QueryName>
        <QueryName condition="end with">.snapads.com</QueryName>
        <QueryName condition="end with">.spotxchange.com</QueryName>
        <QueryName condition="end with">.taboola.com</QueryName>
        <QueryName condition="end with">.taboola.map.fastly.net</QueryName>
        <QueryName condition="end with">.tapad.com</QueryName>
        <QueryName condition="end with">.tidaltv.com</QueryName>
        <QueryName condition="end with">.trafficmanager.net</QueryName>
        <QueryName condition="end with">.tremorhub.com</QueryName>
        <QueryName condition="end with">.tribalfusion.com</QueryName>
        <QueryName condition="end with">.turn.com</QueryName>
        <QueryName condition="end with">.twimg.com</QueryName>
        <QueryName condition="end with">.tynt.com</QueryName>
        <QueryName condition="end with">.w55c.net</QueryName>
        <QueryName condition="end with">.ytimg.com</QueryName>
        <QueryName condition="end with">.zorosrv.com</QueryName>
        <QueryName condition="is">1rx.io</QueryName>
        <QueryName condition="is">adservice.google.com</QueryName>
        <QueryName condition="is">ampcid.google.com</QueryName>
        <QueryName condition="is">clientservices.googleapis.com</QueryName>
        <QueryName condition="is">googleadapis.l.google.com</QueryName>
        <QueryName condition="is">imasdk.googleapis.com</QueryName>
        <QueryName condition="is">l.google.com</QueryName>
        <QueryName condition="is">ml314.com</QueryName>
        <QueryName condition="is">mtalk.google.com</QueryName>
        <QueryName condition="is">update.googleapis.com</QueryName>
        <QueryName condition="is">www.googletagservices.com</QueryName>
        <QueryName condition="end with">.mozaws.net</QueryName>
        <QueryName condition="end with">.mozilla.com</QueryName>
        <QueryName condition="end with">.mozilla.net</QueryName>
        <QueryName condition="end with">.mozilla.org</QueryName>
        <QueryName condition="is">clients1.google.com</QueryName>
        <QueryName condition="is">clients2.google.com</QueryName>
        <QueryName condition="is">clients3.google.com</QueryName>
        <QueryName condition="is">clients4.google.com</QueryName>
        <QueryName condition="is">clients5.google.com</QueryName>
        <QueryName condition="is">clients6.google.com</QueryName>
        <QueryName condition="is">safebrowsing.googleapis.com</QueryName>
        <QueryName condition="end with">.akadns.net</QueryName>
        <QueryName condition="end with">.netflix.com</QueryName>
        <QueryName condition="end with">.aspnetcdn.com</QueryName>
        <QueryName condition="is">ajax.googleapis.com</QueryName>
        <QueryName condition="is">cdnjs.cloudflare.com</QueryName>
        <QueryName condition="is">fonts.googleapis.com</QueryName>
        <QueryName condition="end with">.typekit.net</QueryName>
        <QueryName condition="is">cdnjs.cloudflare.com</QueryName>
        <QueryName condition="end with">.stackassets.com</QueryName>
        <QueryName condition="end with">.steamcontent.com</QueryName>
        <QueryName condition="end with">.arpa.</QueryName>
        <QueryName condition="end with">.arpa</QueryName>
        <QueryName condition="end with">.msftncsi.com</QueryName>
        <QueryName condition="end with">.localmachine</QueryName>
        <QueryName condition="is">localhost</QueryName>
        <Rule groupRelation="and">
          <Image condition="is">C:\ProgramData\LogiShrd\LogiOptions\Software\Current\updater.exe</Image>
          <QueryName condition="end with">.logitech.com</QueryName>
        </Rule>
        <Image condition="is">C:\Program Files\Windows Defender Advanced Threat Protection\MsSense.exe</Image>
        <QueryName condition="end with">-pushp.svc.ms</QueryName>
        <QueryName condition="end with">.b-msedge.net</QueryName>
        <QueryName condition="end with">.bing.com</QueryName>
        <QueryName condition="end with">.hotmail.com</QueryName>
        <QueryName condition="end with">.live.com</QueryName>
        <QueryName condition="end with">.live.net</QueryName>
        <QueryName condition="end with">.s-microsoft.com</QueryName>
        <QueryName condition="end with">.microsoft.com</QueryName>
        <QueryName condition="end with">.microsoftonline.com</QueryName>
        <QueryName condition="end with">.microsoftstore.com</QueryName>
        <QueryName condition="end with">.ms-acdc.office.com</QueryName>
        <QueryName condition="end with">.msedge.net</QueryName>
        <QueryName condition="end with">.msn.com</QueryName>
        <QueryName condition="end with">.msocdn.com</QueryName>
        <QueryName condition="end with">.skype.com</QueryName>
        <QueryName condition="end with">.skype.net</QueryName>
        <QueryName condition="end with">.windows.com</QueryName>
        <QueryName condition="end with">.windows.net.nsatc.net</QueryName>
        <QueryName condition="end with">.windowsupdate.com</QueryName>
        <QueryName condition="end with">.xboxlive.com</QueryName>
        <QueryName condition="is">login.windows.net</QueryName>
        <QueryName condition="is">outlook.office.com</QueryName>
        <QueryName condition="is">statics.teams.cdn.office.net</QueryName>
        <QueryName condition="is">acdc-direct.office.com</QueryName>
        <QueryName condition="end with">.fp.measure.office.com</QueryName>
        <QueryName condition="end with">office365.com</QueryName>
        <QueryName condition="end with">.activedirectory.windowsazure.com</QueryName>
        <QueryName condition="end with">.aria.microsoft.com</QueryName>
        <QueryName condition="end with">.msauth.net</QueryName>
        <QueryName condition="end with">.msftauth.net</QueryName>
        <QueryName condition="end with">.opinsights.azure.com</QueryName>
        <QueryName condition="is">management.azure.com</QueryName>
        <QueryName condition="is">outlook.office365.com</QueryName>
        <QueryName condition="is">portal.azure.com</QueryName>
        <QueryName condition="is">substrate.office.com</QueryName>
        <QueryName condition="is">osi.office.net</QueryName>
        <QueryName condition="end with">.digicert.com</QueryName>
        <QueryName condition="end with">.globalsign.com</QueryName>
        <QueryName condition="end with">.globalsign.net</QueryName>
        <QueryName condition="is">msocsp.com</QueryName>
        <QueryName condition="is">ocsp.msocsp.com</QueryName>
        <QueryName condition="is">pki.goog</QueryName>
        <QueryName condition="end with">.pki.goog</QueryName>
        <QueryName condition="is">ocsp.godaddy.com</QueryName>
        <QueryName condition="is">amazontrust.com</QueryName>
        <QueryName condition="end with">.amazontrust.com</QueryName>
        <QueryName condition="is">ocsp.sectigo.com</QueryName>
        <QueryName condition="is">pki-goog.l.google.com</QueryName>
        <QueryName condition="end with">.usertrust.com</QueryName>
        <QueryName condition="is">ocsp.comodoca.com</QueryName>
        <QueryName condition="is">ocsp.verisign.com</QueryName>
        <QueryName condition="is">ocsp.entrust.net</QueryName>
        <QueryName condition="end with">ocsp.identrust.com</QueryName>
        <QueryName condition="is">status.rapidssl.com</QueryName>
        <QueryName condition="is">status.thawte.com</QueryName>
        <QueryName condition="is">ocsp.int-x3.letsencrypt.org</QueryName>
        <QueryName condition="is">subca.ocsp-certum.com</QueryName>
        <QueryName condition="is">cscasha2.ocsp-certum.com</QueryName>
        <QueryName condition="is">crl.verisign.com</QueryName>
        <Image condition="contains all">C:\Program Files\SentinelOne\Sentinel Agent;\SentinelAgent.exe</Image>
        <QueryName condition="end with">.spotify.com</QueryName>
        <QueryName condition="end with">.spotify.map.fastly.net</QueryName>
        <Image condition="contains all">C:\Windows\SystemApps\Microsoft.Windows.Search;SearchApp.exe</Image>
      </DnsQuery>
    </RuleGroup>
    <!-- Event ID 23 == File Delete and overwrite events which saves a copy to the archivedir - Includes -->
    <!-- Default set to disabled due to disk space implications, enable with care!-->
    <RuleGroup groupRelation="or">
      <FileDelete onmatch="include" />
    </RuleGroup>
    <!-- Event ID 24 == Clipboard change events, only captures text, not files - Includes -->
    <!-- Default set to disabled due to privacy implications and potential data you leave for attackers, enable with care!-->
    <RuleGroup groupRelation="or">
      <ClipboardChange onmatch="include" />
    </RuleGroup>
    <!-- Event ID 25 == Process tampering events - Excludes -->
    <RuleGroup groupRelation="or">
      <ProcessTampering onmatch="exclude">
        <Image condition="is">C:\Program Files\Mozilla Firefox\firefox.exe</Image>
        <Image condition="is">C:\Program Files\Mozilla Firefox\updater.exe</Image>
        <Image condition="is">C:\Program Files\Mozilla Firefox\default-browser-agent.exe</Image>
        <Image condition="is">C:\Program Files\Mozilla Firefox\pingsender.exe</Image>
        <Image condition="is">C:\Program Files\Git\cmd\git.exe</Image>
        <Image condition="is">C:\Program Files\Git\mingw64\bin\git.exe</Image>
        <Image condition="is">C:\Program Files\Git\mingw64\libexec\git-core\git.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe</Image>
        <Rule groupRelation="and">
          <Image condition="begin with">C:\Program Files (x86)\Microsoft\Edge\Application\</Image>
          <Image condition="end with">\BHO\ie_to_edge_stub.exe</Image>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="begin with">C:\Program Files (x86)\Microsoft\Edge\Application\</Image>
          <Image condition="end with">\identity_helper.exe</Image>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="begin with">C:\Program Files (x86)\Microsoft\EdgeUpdate\Install\</Image>
          <Image condition="contains">\MicrosoftEdge_X64_</Image>
        </Rule>
        <Image condition="is">C:\Program Files (x86)\Symantec\Symantec Endpoint Protection Manager\bin\XDelta64\xdelta3.exe</Image>
        <Image condition="contains">unknown process</Image>
        <Image condition="is">C:\Program Files\Microsoft VS Code\Code.exe</Image>
        <Image condition="is">C:\Windows\System32\wbem\WMIADAP.exe</Image>
      </ProcessTampering>
    </RuleGroup>
    <!-- Event ID 26 == File Delete and overwrite events, does NOT save the file - Includes -->
    <RuleGroup groupRelation="or">
      <FileDeleteDetected onmatch="include">
        <TargetFilename condition="contains all">C:\Program Files\Microsoft SQL Server;\Shared\ErrorDumps</TargetFilename>
        <TargetFilename condition="contains all">C:\Program Files\Microsoft SQL Server;\DataDumps</TargetFilename>
        <TargetFilename condition="contains all">C:\Program Files (X86)\Microsoft SQL Server\;Shared\ErrorDumps</TargetFilename>
        <Rule groupRelation="and">
          <TargetFilename condition="contains all">C:\PS-Transcripts\;PowerShell_transcript</TargetFilename>
          <TargetFilename condition="contains">.txt</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Program Files\Qualys\QualysAgent</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="contains">\Downloads\</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="contains">\Appdata\Local\Temp\</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="contains">\Appdata\Local\Microsoft\Windows\INetCache\Content.Outlook\</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\ProgramData\Intel</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\ProgramData\Mozilla</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\ProgramData\chocolatey\logs</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\ProgramData\Microsoft\DeviceSync</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\ProgramData\Microsoft\PlayReady</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\ProgramData\Microsoft\User Account Pictures</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\ProgramData\Microsoft\Crypto\DSS\MachineKeys</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\ProgramData\Microsoft\NetFramework\BreadcrumbStore</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\ProgramData\Microsoft\Office\Heartbeat</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\ProgramData\Microsoft\Windows\WER\ReportQueue</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\ProgramData\Microsoft\Windows\WER\Temp</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Users\All Users\Intel</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Users\All Users\Mozilla</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Users\All Users\chocolatey\logs</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Users\All Users\Microsoft\DeviceSync</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Users\All Users\Microsoft\PlayReady</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Users\All Users\Microsoft\User Account Pictures</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Users\All Users\Microsoft\Crypto\DSS\MachineKeys</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Users\All Users\Microsoft\Crypto\RSA\MachineKeys</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Users\All Users\Microsoft\NetFramework\BreadcrumbStore</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Users\All Users\Microsoft\Office\Heartbeat</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Users\All Users\Microsoft\Windows\WER\ReportArchive</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Users\All Users\Microsoft\Windows\WER\ReportQueue</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Users\All Users\Microsoft\Windows\WER\Temp</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Windows\Tasks</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Windows\tracing</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Windows\Registration\CRMLog</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Windows\System32\Tasks</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Windows\System32\Microsoft\Crypto\RSA\MachineKeys</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Windows\System32\spool\drivers\color</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">C:\Windows\SysWOW64\Tasks</TargetFilename>
          <TargetFilename condition="contains any">.com;.bat;.exe;.reg;.ps1;.vbs;.vba;.lnk;.doc;.xls;.hta;.bin;.7z;.dll;.xla;.cmd;.sh;.lnk;.pptm;.scr;.msi;.sct</TargetFilename>
        </Rule>
      </FileDeleteDetected>
    </RuleGroup>
    <!-- Event ID 27 == File Block Executable and overwrite events - Includes -->
    <!-- Default set to disabled due to potential unwanted blocks, enable with care!-->
    <RuleGroup groupRelation="or">
      <FileBlockExecutable onmatch="include" />
    </RuleGroup>
    <!-- Event ID 28 == Fileblock Shredding events - Includes -->
    <!-- Default set to disabled due to disk space implications, enable with care!-->
    <RuleGroup groupRelation="or">
      <FileBlockShredding onmatch="include" />
    </RuleGroup>
    <!-- Event ID 29 == File Executable Detected events - Excludes -->
    <RuleGroup groupRelation="or">
      <FileExecutableDetected onmatch="exclude" />
    </RuleGroup>
    <RuleGroup groupRelation="or">
      <CreateRemoteThread onmatch="include">
        <SourceImage name="technique_id=T1055,technique_name=Process Injection" condition="begin with">C:\</SourceImage>
        <SourceImage name="technique_id=T1055,technique_name=Process Injection" condition="begin with">\\</SourceImage>
      </CreateRemoteThread>
    </RuleGroup>
    <RuleGroup groupRelation="or">
      <WmiEvent onmatch="exclude" />
    </RuleGroup>
    <RuleGroup groupRelation="or">
      <FileDeleteDetected onmatch="exclude">
        <Image condition="contains all">C:\WindowsAzure\GuestAgent;\WindowsAzureGuestAgent.exe</Image>
        <Image condition="contains all">C:\Packages\Plugins\Microsoft.Azure.Monitor.AzureMonitorWindowsAgent\;\AMAExtHealthMonitor.exe</Image>
        <TargetFilename condition="begin with">C:\WindowsAzure\Logs\AggregateStatus\aggregatestatus</TargetFilename>
        <Image condition="contains all">\appdata\local\google\chrome\user data\swreporter\;software_reporter_tool.exe</Image>
        <Image condition="is">C:\Program Files (x86)\Google\Chrome\Application\chrome.exe</Image>
        <TargetFilename condition="contains all">C:\Windows\Prefetch;.pf</TargetFilename>
        <User condition="contains any">NETWORK SERVICE; LOCAL SERVICE</User>
      </FileDeleteDetected>
    </RuleGroup>
    <RuleGroup groupRelation="or">
      <FileExecutableDetected onmatch="include">
        <Image name="technique_id=T1546.008,technique_name=Windows Error Reporting" condition="contains">werfault.exe</Image>
        <Image name="technique_id=T1574.002,technique_name=DLL Side-Loading" condition="is">odbcconf.exe</Image>
        <Image name="technique_id=T1027.004,technique_name=Compile After Delivery" condition="is">csc.exe</Image>
        <Image name="technique_id=T1543.003,technique_name=Windows Service" condition="is">sc.exe</Image>
        <Image name="technique_id=T1489,technique_name=Service Stop" condition="is">taskkill.exe</Image>
        <Image name="technique_id=T1074,technique_name=Data Staged" condition="is">xcopy.exe</Image>
        <Image name="technique_id=T1074,technique_name=Data Staged" condition="is">robocopy.exe</Image>
        <Image name="technique_id=T,technique_name=" condition="is">makecab.exe</Image>
        <Image name="technique_id=T1105,technique_name=Remote File Copy" condition="is">GfxDownloadWrapper.exe</Image>
        <Image name="technique_id=T1105,technique_name=Remote File Copy" condition="is">expand.exe</Image>
        <Image name="technique_id=T1105,technique_name=Ingress Tool Transfer" condition="is">curl.exe</Image>
        <Image name="technique=T1105,technique_name=Ingress Tool Transfer" condition="is">ftp.exe</Image>
        <Image name="technique_id=T1564.004,technique_name=NTFS File Attributes" condition="is">extrac32.exe</Image>
        <Image name="technique_id=T1053.005,technique_name=Scheduled Task/Job" condition="contains any">schtasks.exe;sctasks.exe</Image>
        <Image name="technique=T1053.002,technique_name=At" condition="contains any">at.exe;At.exe</Image>
        <Image name="technique_id=T1053,technique_name=Scheduled Task/Job" condition="is">taskeng.exe</Image>
        <Image name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="begin with">C:\WINDOWS\system32\wbem\scrcons.exe</Image>
        <Image name="technique_id=T1047,technique_name=Windows Management Instrumentation" condition="is">wmiprvse.exe</Image>
        <Image condition="is">wevtutil.exe</Image>
        <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="contains">pcalua.exe</Image>
        <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">cscript.exe</Image>
        <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">wscript.exe</Image>
        <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">bash.exe</Image>
        <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">certutil.exe</Image>
        <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">winrs.exe</Image>
        <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="contains">control.exe</Image>
        <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">desktopimgdownldr.exe</Image>
        <Image name="technique_id=T1202,technique_name=Indirect Command Execution" condition="is">wsl.exe</Image>
        <Image name="technique_id=T1218.001,technique_name=Compiled HTML File" condition="is">hh.exe</Image>
        <Image name="technique_id=T1218.004,technique_name=InstallUtil" condition="is">installutil.exe</Image>
        <Image name="technique_id=T1218.005,technique_name=Mshta" condition="contains">mshta.exe</Image>
        <Image name="technique_id=T1218.005,technique_name=Mshta" condition="is">mshta.exe</Image>
        <Image name="technique_id=T1218.010,technique_name=Regsvr32" condition="is">regsvr32.exe</Image>
        <Image name="technique_id=T1218.011,technique_name=rundll32.exe" condition="contains">rundll32.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">InfDefaultInstall.EXE</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">extexport.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">msconfig.EXE</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">msiexec.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">odbcconf.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">PresentationHost.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">rasdlui.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">RegisterCimProvider2.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">RegisterCimProvider.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">ScriptRunner.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">verclsid.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">wab.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">wsreset.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">Appvlp.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">csi.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">devtoolslauncher.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">Scriptrunner.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">tttracer.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">msdt.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">rasautou.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">Register-cimprovider.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">diskshadow.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="is">replace.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">jjs.exe</Image>
        <Image name="technique_id=T1218,technique_name=System Binary Proxy Execution" condition="contains">appcmd.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="contains">vbc.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">csc.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">dfsvc.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">mftrace.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">dxcap.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">ilasm.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">jsc.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">vbc.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">Microsoft.Workflow.Compiler.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">vsjitdebugger.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">tracker.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">te.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">rcsi.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">Microsoft.Workflow.Compiler.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">jsc.exe</Image>
        <Image name="technique_id=T1127,technique_name=Trusted Developer Utilities Proxy Execution" condition="is">MSBuild.exe</Image>
        <Image name="technique_id=T1137,technique_name=Office Application Startup" condition="contains">excel.exe</Image>
        <Image name="technique_id=T1137,technique_name=Office Application Startup" condition="contains">winword.exe</Image>
        <Image name="technique_id=T1137,technique_name=Office Application Startup" condition="contains">powerpnt.exe</Image>
        <Image name="technique_id=T1137,technique_name=Office Application Startup" condition="contains">outlook.exe</Image>
        <Image name="technique_id=T1137,technique_name=Office Application Startup" condition="contains">msaccess.exe</Image>
        <Image name="technique_id=T1137,technique_name=Office Application Startup" condition="contains">mspub.exe</Image>
        <TargetFilename condition="begin with">C:\Program Files\Qualys\QualysAgent</TargetFilename>
        <Image name="technique_id=T1059.003,technique_name=Windows Command Shell" condition="is">cmd.exe</Image>
        <Image name="technique_id=T1059.001,technique_name=PowerShell" condition="contains">powershell.exe</Image>
        <Image name="technique_id=T1059.001,technique_name=PowerShell" condition="contains">pwsh.exe</Image>
        <Image name="technique_id=T1059.001,technique_name=PowerShell" condition="contains">powershell_ise.exe</Image>
        <Image name="technique_id=T1059.001,technique_name=PowerShell" condition="contains">Sqlps.exe</Image>
        <TargetFilename condition="contains">\Downloads\</TargetFilename>
        <TargetFilename condition="contains">\Appdata\Local\Temp\</TargetFilename>
        <TargetFilename condition="contains">\Appdata\Local\Microsoft\Windows\INetCache\Content.Outlook\</TargetFilename>
        <Image name="technique_id=T1021.006,technique_name=Windows Remote Management" condition="is">wsmprovhost.exe</Image>
        <Image name="technique_id=T1021.006,technique_name=Windows Remote Management" condition="is">winrshost.exe</Image>
        <Image name="technique_id=T1021.006,technique_name=Windows Remote Management" condition="contains">winrm.cmd</Image>
        <TargetFilename condition="begin with">C:\ProgramData\Intel</TargetFilename>
        <TargetFilename condition="begin with">C:\ProgramData\Mozilla</TargetFilename>
        <TargetFilename condition="begin with">C:\ProgramData\chocolatey\</TargetFilename>
        <TargetFilename condition="begin with">C:\ProgramData\Microsoft\DeviceSync</TargetFilename>
        <TargetFilename condition="begin with">C:\ProgramData\Microsoft\PlayReady</TargetFilename>
        <TargetFilename condition="begin with">C:\ProgramData\Microsoft\User Account Pictures</TargetFilename>
        <TargetFilename condition="begin with">C:\ProgramData\Microsoft\Office\Heartbeat</TargetFilename>
        <TargetFilename condition="begin with">C:\ProgramData\Microsoft\Windows\WER</TargetFilename>
        <TargetFilename condition="begin with">C:\Users\All Users\</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\Tasks</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\tracing</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\System32\Tasks</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\System32\spool\drivers\color</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\SysWOW64\Tasks</TargetFilename>
      </FileExecutableDetected>
    </RuleGroup>
    <!-- Event ID 10 == Process Access - Excludes -->
    <RuleGroup groupRelation="or">
      <ProcessAccess onmatch="exclude">
        <!-- VS Code installer accessing Explorer - installer legittimo -->
        <Rule groupRelation="and">
          <SourceImage condition="contains any">VSCodeSetup-x64;VSCodeUserSetup-x64;VSCodeSetup-ia32;VSCodeUserSetup-ia32</SourceImage>
          <SourceImage condition="contains">\AppData\Local\Temp\</SourceImage>
          <SourceImage condition="end with">.tmp</SourceImage>
          <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
          <GrantedAccess condition="is">0x40</GrantedAccess>
        </Rule>
        <!-- Altri installer VS Code con pattern diversi -->
        <Rule groupRelation="and">
          <SourceImage condition="contains all">is-;.tmp;VSCodeSetup</SourceImage>
          <TargetImage condition="contains">Explorer.EXE</TargetImage>
        </Rule>
        <!-- VS Code installer CodeSetup accessing Explorer - installer legittimo -->
        <Rule groupRelation="and">
          <SourceImage condition="contains all">\AppData\Local\Temp\;CodeSetup-stable;.tmp</SourceImage>
          <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
          <GrantedAccess condition="is">0x40</GrantedAccess>
        </Rule>
        <!-- VS Code stesso che accede a Explorer -->
        <Rule groupRelation="and">
          <SourceImage condition="contains">\Microsoft VS Code\Code.exe</SourceImage>
          <TargetImage condition="contains">Explorer.EXE</TargetImage>
        </Rule>
        
        <!-- Advanced Installer temporary setup accessing Explorer -->
        <Rule groupRelation="and">
          <SourceImage condition="contains all">\AppData\Local\Temp\_AI;.tmp\Setup.exe</SourceImage>
          <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
          <GrantedAccess condition="is">0x40</GrantedAccess>
        </Rule>
        <!-- Windsurf installer accessing Explorer - installer legittimo -->
        <Rule groupRelation="and">
          <SourceImage condition="contains all">\AppData\Local\Temp\;WindsurfSetup-stable;.tmp</SourceImage>
          <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
          <GrantedAccess condition="is">0x40</GrantedAccess>
        </Rule>
        
        <!-- Zoom accessing Explorer for UI operations -->
        <Rule groupRelation="and">
          <SourceImage condition="contains">\Zoom\bin\Zoom.exe</SourceImage>
          <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
          <GrantedAccess condition="is">0x40</GrantedAccess>
        </Rule>
        
        <!-- Windows AutoModeDetect accessing Explorer for display/quiet mode settings -->
        <Rule groupRelation="and">
          <SourceImage condition="is">C:\WINDOWS\system32\AutoModeDetect.exe</SourceImage>
          <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
          <GrantedAccess condition="is">0x1410</GrantedAccess>
        </Rule>
        <!-- Microsoft Bootstrapper accessing Explorer - installer legittimo -->
        <Rule groupRelation="and">
          <SourceImage condition="contains">\Windows\Temp\</SourceImage>
          <SourceImage condition="contains">\.be\Bootstrapper.exe</SourceImage>
          <TargetImage condition="is">C:\WINDOWS\Explorer.EXE</TargetImage>
          <GrantedAccess condition="is">0x40</GrantedAccess>
        </Rule>
        <!-- Bootstrapper generico da cartelle temporanee -->
        <Rule groupRelation="and">
          <SourceImage condition="end with">Bootstrapper.exe</SourceImage>
          <SourceImage condition="contains any">\.be\;\.ba\;\Temp\</SourceImage>
          <TargetImage condition="contains">Explorer.EXE</TargetImage>
          <CallTrace condition="contains">Msi.dll</CallTrace>
        </Rule>
      </ProcessAccess>
    </RuleGroup>
  </EventFiltering>
</Sysmon>




